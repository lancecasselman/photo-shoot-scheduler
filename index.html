<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Client Management Area - July 24 2025 - v3.0 - Deposit System</title>
    
    <!-- Confetti Animation Styles -->
    <style>
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }
        
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: confetti-fall 3s linear forwards;
        }
        
        .confetti-piece:nth-child(odd) {
            background: #4ecdc4;
            border-radius: 50%;
        }
        
        .confetti-piece:nth-child(3n) {
            background: #45b7d1;
            width: 8px;
            height: 8px;
        }
        
        .confetti-piece:nth-child(4n) {
            background: #96ceb4;
            border-radius: 2px;
        }
        
        .confetti-piece:nth-child(5n) {
            background: #feca57;
            width: 12px;
            height: 6px;
            border-radius: 6px;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .milestone-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            font-size: 1.2rem;
            font-weight: 600;
            z-index: 10000;
            animation: milestone-pop 2s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes milestone-pop {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
            40% {
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1);
            }
        }
    </style>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.85rem;
            transition: background-color 0.2s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .session-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }
        
        input, textarea, select {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #718096;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4a5568;
        }
        
        .btn-danger {
            background: #e53e3e;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c53030;
        }
        
        .btn-edit {
            background: #805ad5;
            color: white;
        }
        
        .btn-edit:hover {
            background: #6b46c1;
        }
        
        .btn-calendar {
            background: #38a169;
            color: white;
        }
        
        .btn-calendar:hover {
            background: #2f855a;
        }
        
        .btn-gallery-ready {
            background: #ed8936;
            color: white;
        }
        
        .btn-gallery-ready:hover {
            background: #dd6b20;
        }
        
        .btn-invoice {
            background: #00b5d8;
            color: white;
        }
        
        .btn-invoice:hover {
            background: #0987a0;
        }
        
        .btn-call {
            background: #38b2ac;
            color: white;
        }
        
        .btn-call:hover {
            background: #319795;
        }
        
        .btn-text {
            background: #d69e2e;
            color: white;
        }
        
        .btn-text:hover {
            background: #b7791f;
        }
        
        .btn-gallery {
            background: #9f7aea;
            color: white;
        }
        
        .btn-gallery:hover {
            background: #805ad5;
        }
        
        .sessions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .session-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .session-card:hover {
            transform: translateY(-5px);
        }
        
        .session-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .session-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2d3748;
        }
        
        .session-type {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .session-details {
            margin-bottom: 20px;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .detail-label {
            font-weight: 600;
            width: 80px;
            color: #4a5568;
        }
        
        .detail-value {
            color: #2d3748;
        }
        
        .session-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .session-actions {
                grid-template-columns: 1fr;
            }
        }
        
        .photo-gallery {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .photo-item {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .photo-item:hover {
            transform: scale(1.05);
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .upload-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .upload-modal.active {
            display: flex;
        }
        
        .upload-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .upload-area {
            border: 3px dashed #cbd5e0;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover, .upload-area.dragover {
            border-color: #667eea;
            background: #f7fafc;
        }
        
        .photo-count {
            background: #48bb78;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px;
            color: #718096;
        }
        
        .progress-bar-container {
            background: #e2e8f0;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #48bb78, #38a169);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .upload-status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .file-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .file-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
        }
        
        .file-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .file-preview-remove {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .file-progress-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            padding: 8px;
            background: #f7fafc;
            border-radius: 6px;
        }
        
        .file-progress-name {
            flex: 1;
            font-size: 0.9em;
            color: #4a5568;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .file-progress-bar {
            background: #e2e8f0;
            border-radius: 6px;
            height: 6px;
            width: 100px;
            overflow: hidden;
        }
        
        .file-progress-fill {
            background: #48bb78;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .file-progress-status {
            font-size: 0.8em;
            color: #48bb78;
            font-weight: 600;
            min-width: 60px;
            text-align: right;
        }
        
        .admin-checkboxes {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .admin-checkboxes h3 {
            margin: 0 0 15px 0;
            color: #2d3748;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
            cursor: pointer;
        }
        
        .checkbox-group label {
            cursor: pointer;
        }
        
        .upload-limits-info {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #234e52;
        }
        
        .upload-limits-info h4 {
            margin: 0 0 8px 0;
            color: #065f46;
        }
        
        .upload-limits-info ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .batch-upload-info {
            background: #fef7e0;
            border: 1px solid #f6cc73;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            color: #744210;
            font-size: 0.9rem;
        }
        
        /* Payment Plan Styles */
        .payment-plan-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .payment-plan-modal.active {
            display: flex;
        }
        
        .payment-plan-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .payment-plan-form {
            display: grid;
            gap: 20px;
        }
        
        .payment-plan-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .payment-plan-summary {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .payment-plan-summary h4 {
            margin: 0 0 15px 0;
            color: #2d3748;
        }
        
        .payment-schedule {
            margin: 15px 0;
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin: 5px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .payment-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .payment-status.pending {
            background: #fef7e0;
            color: #744210;
        }
        
        .payment-status.paid {
            background: #dcfce7;
            color: #166534;
        }
        
        .payment-status.overdue {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .payment-plan-info {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #234e52;
        }
        
        .payment-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            gap: 8px;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: #666;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            background: #f8fafc;
            color: #333;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* Tab Content Areas */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Website Builder Styles */
        .website-builder-container {
            max-width: 100%;
            margin: 0;
        }

        .builder-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .builder-header h2 {
            color: #2d3748;
            margin-bottom: 8px;
        }

        .builder-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .website-toolbar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .builder-interface {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            min-height: 800px;
            background: #f8fafc;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        /* Left Sidebar - Components */
        .builder-sidebar {
            background: white;
            padding: 20px;
            border-right: 1px solid #e2e8f0;
            overflow-y: auto;
        }

        .builder-sidebar h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .component-category {
            margin-bottom: 25px;
        }

        .component-category h4 {
            color: #4a5568;
            font-size: 0.9rem;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .component-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .component-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            cursor: grab;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .component-item:hover {
            background: #e6fffa;
            border-color: #81e6d9;
            transform: translateX(5px);
        }

        .component-item:active {
            cursor: grabbing;
        }

        .component-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .component-item span {
            font-weight: 500;
            color: #2d3748;
        }

        /* Center Canvas */
        .builder-canvas {
            background: white;
            display: flex;
            flex-direction: column;
        }

        .canvas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
        }

        .canvas-header h3 {
            color: #2d3748;
            margin: 0;
        }

        .canvas-controls {
            display: flex;
            gap: 8px;
        }

        .canvas-control {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .canvas-control:hover,
        .canvas-control.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .canvas-viewport {
            flex: 1;
            padding: 20px;
            background: #e2e8f0;
            overflow: auto;
        }

        .website-canvas {
            background: white;
            min-height: 600px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        .website-canvas.desktop {
            max-width: 1200px;
        }

        .website-canvas.tablet {
            max-width: 768px;
        }

        .website-canvas.mobile {
            max-width: 375px;
        }

        .drop-zone {
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px dashed #cbd5e0;
            border-radius: 8px;
            margin: 20px;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .drop-zone-message {
            text-align: center;
            color: #666;
        }

        .drop-zone-message h3 {
            margin-bottom: 12px;
            color: #2d3748;
        }

        .drop-zone-message p {
            margin-bottom: 25px;
            font-size: 1.1rem;
        }

        .quick-start-templates {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .template-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .template-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .template-btn.legacy-style {
            background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
            border: 2px solid #d4af37;
        }

        .template-btn.modern-style {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .template-btn.elegant-style {
            background: linear-gradient(135deg, #2c1810 0%, #8b4513 100%);
            border: 2px solid #ddd6c1;
        }

        /* Right Sidebar - Properties */
        .builder-properties {
            background: white;
            padding: 20px;
            border-left: 1px solid #e2e8f0;
            overflow-y: auto;
        }

        .builder-properties h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .no-selection {
            text-align: center;
            color: #666;
            padding: 40px 20px;
        }

        /* Website List */
        .websites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .website-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .website-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .website-preview {
            width: 100%;
            height: 200px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 2rem;
        }

        .website-info h4 {
            margin: 0 0 8px 0;
            color: #2d3748;
        }

        .website-info p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .website-actions {
            display: flex;
            gap: 10px;
        }

        .website-actions .btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        /* Component Wrapper Styles */
        .component-wrapper {
            position: relative;
            margin-bottom: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .component-wrapper:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Gallery hover effects */
        .component-wrapper:hover [style*="aspect-ratio"] > [style*="position: absolute"] {
            transform: translateY(0) !important;
        }

        .component-wrapper:hover [style*="aspect-ratio"]:hover {
            transform: scale(1.05);
        }

        .component-wrapper:hover [style*="opacity: 0"]:hover {
            opacity: 1 !important;
        }

        /* Properties Panel Styles */
        .property-section {
            padding: 15px 0;
        }

        .property-section h4 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.1rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-group label {
            display: block;
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .property-group input[type="color"] {
            width: 100%;
            height: 40px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
        }

        .property-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            cursor: pointer;
        }

        .property-group input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .property-group input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .property-actions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        .property-actions .btn {
            width: 100%;
            justify-content: center;
        }

        /* Template Loading Animation */
        .template-loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            z-index: 1000;
            text-align: center;
        }

        .template-loading h3 {
            margin-bottom: 15px;
            color: #2d3748;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-left: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .builder-interface {
                grid-template-columns: 200px 1fr 250px;
            }
        }

        @media (max-width: 768px) {
            .builder-interface {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr auto;
                height: auto;
                min-height: 100vh;
            }
            
            .builder-sidebar,
            .builder-properties {
                max-height: 250px;
                overflow-y: auto;
                position: relative;
                z-index: 10;
            }
            
            .builder-sidebar {
                order: 1;
                background: #f8fafc;
                border-bottom: 1px solid #e2e8f0;
                padding: 15px;
            }
            
            .builder-canvas {
                order: 2;
                padding: 10px;
                min-height: 400px;
            }
            
            .builder-properties {
                order: 3;
                background: #f8fafc;
                border-top: 1px solid #e2e8f0;
                padding: 15px;
            }
            
            .website-toolbar {
                justify-content: center;
                flex-wrap: wrap;
                gap: 10px;
                padding: 10px;
            }
            
            .canvas-controls {
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }
            
            .canvas-control {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            .quick-start-templates {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .template-btn {
                width: 200px;
                padding: 12px 20px;
                font-size: 0.9rem;
            }
            
            .component-library h4,
            .builder-properties h3 {
                font-size: 1.1rem;
                margin-bottom: 15px;
            }
            
            .component-category {
                margin-bottom: 20px;
            }
            
            .component-item {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .website-canvas {
                min-height: 300px;
                border-radius: 8px;
            }
            
            .website-canvas.mobile {
                max-width: 375px;
                margin: 0 auto;
            }
            
            .website-canvas.tablet {
                max-width: 768px;
                margin: 0 auto;
            }
            
            .drop-zone {
                min-height: 300px;
            }
            
            .drop-zone-message h3 {
                font-size: 1.5rem;
            }
            
            .drop-zone-message p {
                font-size: 1rem;
            }
            
            /* Mobile-friendly component editing */
            .component-wrapper {
                outline: none !important;
                border: 2px solid transparent;
                margin-bottom: 1px;
                position: relative;
            }
            
            .component-wrapper.selected {
                border-color: #667eea !important;
                background: rgba(102, 126, 234, 0.05);
            }
            
            .component-wrapper::after {
                content: '✎ Tap to Edit';
                position: absolute;
                top: 5px;
                right: 5px;
                background: rgba(102, 126, 234, 0.9);
                color: white;
                padding: 2px 6px;
                border-radius: 4px;
                font-size: 0.7rem;
                opacity: 0;
                transition: opacity 0.3s;
                pointer-events: none;
            }
            
            .component-wrapper:hover::after,
            .component-wrapper.selected::after {
                opacity: 1;
            }
        }
        
        @media (max-width: 480px) {
            .builder-sidebar,
            .builder-properties {
                max-height: 200px;
            }
            
            .website-toolbar {
                padding: 8px;
            }
            
            .canvas-control {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .template-btn {
                width: 180px;
                padding: 10px 15px;
                font-size: 0.8rem;
            }
            
            .component-item {
                padding: 10px;
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .sessions-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .session-actions { flex-direction: column; }
            .btn { width: 100%; margin: 2px 0; }
            .checkbox-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>📸 The Legacy Photography Management</h1>
                <p>Complete business management platform for photographers</p>
            </div>
            <div id="userInfo" class="user-info" style="display: none;">
                <img id="userAvatar" class="user-avatar" src="" alt="User Avatar">
                <span id="userName"></span>
                <a href="/api/logout" class="logout-btn">Sign Out</a>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('clients')">
                📅 Client Management
            </button>
            <button class="nav-tab" onclick="switchTab('websites')">
                🌐 Website Builder
            </button>
        </div>

        <!-- Client Management Tab Content -->
        <div id="clientsTab" class="tab-content active">
        <!-- Session Form -->
        <div class="session-form">
            <h2>Add New Session</h2>
            <form id="sessionForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="clientName">Client Name</label>
                        <input type="text" id="clientName" name="clientName" required placeholder="Enter client name">
                    </div>
                    <div class="form-group">
                        <label for="sessionType">Session Type</label>
                        <input type="text" id="sessionType" name="sessionType" required placeholder="Wedding, Portrait, etc.">
                    </div>
                    <div class="form-group">
                        <label for="dateTime">Date & Time</label>
                        <input type="datetime-local" id="dateTime" name="dateTime" required min="2025-01-01T00:00">
                    </div>
                    <div class="form-group">
                        <label for="location">Location</label>
                        <input type="text" id="location" name="location" required placeholder="Session location">
                    </div>
                    <div class="form-group">
                        <label for="phoneNumber">Phone</label>
                        <input type="tel" id="phoneNumber" name="phoneNumber" required placeholder="+1 (555) 123-4567">
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required placeholder="client@example.com">
                    </div>
                    <div class="form-group">
                        <label for="price">Price</label>
                        <input type="number" id="price" name="price" step="0.01" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="duration">Duration (minutes)</label>
                        <input type="number" id="duration" name="duration" required placeholder="60">
                    </div>
                </div>
                
                <!-- Admin Workflow Checkboxes -->
                <div class="admin-checkboxes">
                    <h3>Admin Workflow Status</h3>
                    <div class="checkbox-grid">
                        <div class="checkbox-group">
                            <input type="checkbox" id="contractSigned" name="contractSigned">
                            <label for="contractSigned">📝 Contract Signed</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="paid" name="paid">
                            <label for="paid">💵 Paid</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="edited" name="edited">
                            <label for="edited">✂️ Edited</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="delivered" name="delivered">
                            <label for="delivered">📦 Delivered</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="sendReminder" name="sendReminder">
                            <label for="sendReminder">🔔 Send session reminder 24 hours before</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="notifyGalleryReady" name="notifyGalleryReady">
                            <label for="notifyGalleryReady">🖼️ Notify when gallery is ready</label>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">Add Session</button>
                <button type="button" class="btn btn-secondary" onclick="celebrateMilestone('session_created', 'Test Client')" style="margin-left: 10px;">🎉 Test Confetti</button>
            </form>
        </div>

        <!-- Sessions Display -->
        <div id="sessionsContainer" class="sessions-grid">
            <div class="empty-state">
                <h3>No sessions yet</h3>
                <p>Add your first photography session above!</p>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="upload-modal">
        <div class="upload-content">
            <h3>Upload Photos</h3>
            
            <div class="upload-limits-info">
                <h4>📈 Enhanced Upload Capacity</h4>
                <ul>
                    <li><strong>Unlimited file size</strong> - Upload RAW photos, high-res images</li>
                    <li><strong>Unlimited quantity</strong> - Upload entire photo shoots at once</li>
                    <li><strong>Batch processing</strong> - Large uploads handled automatically</li>
                    <li><strong>Progress tracking</strong> - Monitor individual file uploads</li>
                </ul>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <p>📸 Click here or drag photos to upload</p>
                <p style="font-size: 0.9em; color: #718096; margin-top: 10px;">Supports unlimited photos of any size - JPG, PNG, RAW files welcome!</p>
            </div>
            <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
            <div id="uploadProgress" style="margin: 20px 0;">
                <div id="filePreview" style="margin-bottom: 15px;"></div>
                <div id="uploadStatus" style="display: none;">
                    <div class="upload-status-header">
                        <span id="uploadStatusText">Preparing upload...</span>
                        <span id="uploadCounter">0/0</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="overallProgress"></div>
                    </div>
                    <div id="fileProgressList" style="margin-top: 15px;"></div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" id="uploadBtn" onclick="startUpload()" style="display: none;">Upload Selected Photos</button>
                <button class="btn btn-secondary" onclick="closeUploadModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Payment Plan Modal -->
    <div id="paymentPlanModal" class="payment-plan-modal">
        <div class="payment-plan-content">
            <h3>💳 Create Payment Plan</h3>
            
            <div class="payment-plan-form">
                <div class="payment-plan-grid">
                    <div class="form-group">
                        <label for="planTotalAmount">Total Amount ($)</label>
                        <input type="number" id="planTotalAmount" step="0.01" placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label for="planStartDate">Start Date</label>
                        <input type="date" id="planStartDate" required>
                    </div>
                    <div class="form-group">
                        <label for="planEndDate">End Date</label>
                        <input type="date" id="planEndDate" required>
                    </div>
                    <div class="form-group">
                        <label for="planReminderDays">Reminder Days Before</label>
                        <select id="planReminderDays">
                            <option value="1">1 day</option>
                            <option value="3" selected>3 days</option>
                            <option value="7">1 week</option>
                        </select>
                    </div>
                </div>
                
                <div class="payment-plan-summary" id="paymentPlanSummary" style="display: none;">
                    <h4>📋 Payment Plan Summary</h4>
                    <div id="paymentSummaryDetails"></div>
                    <div class="payment-schedule" id="paymentSchedulePreview"></div>
                </div>
                
                <div class="payment-plan-info">
                    <h4>ℹ️ How Payment Plans Work</h4>
                    <ul>
                        <li>Automatically calculates equal monthly payments</li>
                        <li>Sends Stripe invoices each month via email</li>
                        <li>Tracks payments and sends reminders</li>
                        <li>Updates session status when fully paid</li>
                    </ul>
                </div>
                
                <div class="payment-actions">
                    <button class="btn btn-primary" id="createPaymentPlanBtn" onclick="createPaymentPlan()">Create Payment Plan</button>
                    <button class="btn btn-secondary" onclick="calculatePaymentPreview()">Preview Payments</button>
                    <button class="btn btn-secondary" onclick="closePaymentPlanModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Plan View Modal -->
    <div id="paymentPlanViewModal" class="payment-plan-modal">
        <div class="payment-plan-content">
            <h3 id="paymentPlanViewTitle">💳 Payment Plan Details</h3>
            
            <div id="paymentPlanViewContent">
                <!-- Payment plan details will be loaded here -->
            </div>
            
            <div class="payment-actions">
                <button class="btn btn-primary" onclick="processAutomatedPayments()">Process All Due Payments</button>
                <button class="btn btn-secondary" onclick="closePaymentPlanViewModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        let sessions = [];
        let currentUploadSessionId = null;
        let currentPaymentPlanSessionId = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSessions();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('sessionForm').addEventListener('submit', addSession);
            
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleDrop);
            fileInput.addEventListener('change', handleFileSelect);
        }

        async function addSession(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const sessionData = {
                clientName: formData.get('clientName'),
                sessionType: formData.get('sessionType'),
                dateTime: formData.get('dateTime'),
                location: formData.get('location'),
                phoneNumber: formData.get('phoneNumber'),
                email: formData.get('email'),
                price: parseFloat(formData.get('price')),
                duration: parseInt(formData.get('duration')),
                contractSigned: formData.get('contractSigned') === 'on',
                paid: formData.get('paid') === 'on',
                edited: formData.get('edited') === 'on',
                delivered: formData.get('delivered') === 'on',
                sendReminder: formData.get('sendReminder') === 'on',
                notifyGalleryReady: formData.get('notifyGalleryReady') === 'on',
                photos: []
            };

            try {
                if (editingSessionId) {
                    // Update existing session
                    const response = await fetch(`/api/sessions/${editingSessionId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(sessionData)
                    });
                    
                    if (response.ok) {
                        const updatedSession = await response.json();
                        const sessionIndex = sessions.findIndex(s => s.id === editingSessionId);
                        if (sessionIndex !== -1) {
                            sessions[sessionIndex] = updatedSession;
                        }
                        renderSessions();
                        resetForm(e.target);
                        showMessage('Session updated successfully!', 'success');
                    } else {
                        showMessage('Failed to update session', 'error');
                    }
                } else {
                    // Create new session
                    const response = await fetch('/api/sessions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(sessionData)
                    });
                    
                    if (response.ok) {
                        const newSession = await response.json();
                        sessions.unshift(newSession);
                        renderSessions();
                        resetForm(e.target);
                        showMessage('Session added successfully!', 'success');
                        
                        // Trigger milestone celebration for new session
                        celebrateMilestone('session_created', newSession.clientName);
                    } else {
                        showMessage('Failed to add session', 'error');
                    }
                }
            } catch (error) {
                console.error('Error processing session:', error);
                showMessage('Error processing session', 'error');
            }
        }

        function resetForm(form) {
            form.reset();
            editingSessionId = null;
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.textContent = 'Add Session';
        }

        async function loadSessions() {
            try {
                const response = await fetch('/api/sessions');
                if (response.ok) {
                    sessions = await response.json();
                    renderSessions();
                }
            } catch (error) {
                console.error('Error loading sessions:', error);
            }
        }

        function renderSessions() {
            const container = document.getElementById('sessionsContainer');
            
            if (sessions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No sessions yet</h3>
                        <p>Add your first photography session above!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = sessions.map(session => `
                <div class="session-card">
                    <div class="session-header">
                        <div class="session-title">${session.clientName}</div>
                        <div class="session-type">${session.sessionType}</div>
                    </div>
                    
                    <div class="session-details">
                        <div class="detail-row">
                            <span class="detail-label">Date:</span>
                            <span class="detail-value">${formatDateTime(session.dateTime)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Location:</span>
                            <span class="detail-value">${session.location}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Phone:</span>
                            <span class="detail-value">${session.phoneNumber}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Price:</span>
                            <span class="detail-value">$${session.price}</span>
                        </div>
                        ${session.hasPaymentPlan ? `
                            <div class="detail-row">
                                <span class="detail-label">Payment Plan:</span>
                                <span class="detail-value">$${session.monthlyPayment}/month (${session.paymentsRemaining || 0} remaining)</span>
                            </div>
                        ` : ''}
                    </div>

                    <div class="session-actions">
                        <button class="btn btn-edit" onclick="editSession('${session.id}')">
                            ✏️ Edit
                        </button>
                        <button class="btn btn-secondary" onclick="openUploadModal('${session.id}')">
                            📸 Upload Photos${session.photos && session.photos.length ? ` (${session.photos.length})` : ''}
                        </button>
                        <button class="btn btn-calendar" onclick="addToCalendar('${session.id}')">
                            📅 Add to Calendar
                        </button>
                        <button class="btn btn-primary" onclick="openEmailClient('${session.id}')">
                            📧 Email Client
                        </button>
                        <button class="btn btn-warning" onclick="copyGalleryUrl('${session.id}')">
                            📸 Copy Gallery URL
                        </button>
                        <button class="btn btn-contract" onclick="openContractModal('${session.id}')">
                            📝 Send Contract
                        </button>
                        ${session.hasPaymentPlan ? `
                            <button class="btn btn-success" onclick="viewPaymentPlan('${session.id}')">
                                💳 View Payment Plan
                            </button>
                        ` : `
                            <button class="btn btn-invoice" onclick="sendInvoice('${session.id}')">
                                💰 Send Invoice
                            </button>
                            <button class="btn" style="background: #fd7e14; color: white;" onclick="sendDepositInvoice('${session.id}')">
                                💳 Send Deposit
                            </button>
                            <button class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;" onclick="openPaymentPlanModal('${session.id}')">
                                💳 Create Payment Plan
                            </button>
                        `}
                        <button class="btn btn-call" onclick="callClient('${session.phoneNumber}')">
                            📞 Call Client
                        </button>
                        <button class="btn btn-text" onclick="textClient('${session.phoneNumber}', '${session.clientName}', '${session.id}')">
                            💬 Text Client
                        </button>
                        <button class="btn btn-danger" onclick="deleteSession('${session.id}')">
                            🗑️ Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function openUploadModal(sessionId) {
            currentUploadSessionId = sessionId;
            document.getElementById('uploadModal').classList.add('active');
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').classList.remove('active');
            currentUploadSessionId = null;
            selectedFiles = [];
            
            // Reset all upload interface elements
            document.getElementById('filePreview').innerHTML = '';
            document.getElementById('uploadStatus').style.display = 'none';
            document.getElementById('uploadBtn').style.display = 'none';
            document.getElementById('fileInput').value = '';
            
            // Clear any existing progress intervals
            if (window.uploadProgressIntervals) {
                window.uploadProgressIntervals.forEach(interval => clearInterval(interval));
                window.uploadProgressIntervals = [];
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            if (files.length > 0) {
                selectedFiles = files;
                showFilePreview(files);
                document.getElementById('fileInput').files = e.dataTransfer.files;
            }
        }

        let selectedFiles = [];

        function handleFileSelect(e) {
            const files = Array.from(e.target.files).filter(file => file.type.startsWith('image/'));
            if (files.length > 0) {
                selectedFiles = files;
                showFilePreview(files);
            }
        }

        function showFilePreview(files) {
            const filePreview = document.getElementById('filePreview');
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (files.length === 0) {
                filePreview.innerHTML = '';
                uploadBtn.style.display = 'none';
                return;
            }

            const totalSize = files.reduce((sum, file) => sum + file.size, 0);
            const totalSizeMB = (totalSize / (1024 * 1024)).toFixed(1);
            
            filePreview.innerHTML = `
                <h4>Selected Photos (${files.length}) - ${totalSizeMB}MB Total</h4>
                <div class="file-preview-grid">
                    ${files.map((file, index) => {
                        const fileSizeMB = (file.size / (1024 * 1024)).toFixed(1);
                        return `
                            <div class="file-preview-item">
                                <img src="${URL.createObjectURL(file)}" alt="Preview">
                                <button class="file-preview-remove" onclick="removeFile(${index})">&times;</button>
                                <div style="font-size: 0.7em; color: #666; margin-top: 2px;">${fileSizeMB}MB</div>
                            </div>
                        `;
                    }).join('')}
                </div>
                ${files.length > 20 ? '<div class="batch-upload-info">Large batch detected - will process in optimized chunks</div>' : ''}
            `;
            
            uploadBtn.style.display = 'inline-block';
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            showFilePreview(selectedFiles);
        }

        function startUpload() {
            if (selectedFiles.length === 0) {
                showMessage('No files selected for upload', 'error');
                return;
            }
            uploadFiles(selectedFiles);
        }

        async function uploadFiles(files) {
            if (!currentUploadSessionId) {
                showMessage('No session selected for upload', 'error');
                return;
            }

            try {
                const formData = new FormData();
                files.forEach(file => {
                    formData.append('photos', file);
                });

                const response = await fetch(`/api/sessions/${currentUploadSessionId}/upload-photos`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(`Successfully uploaded ${result.uploaded} photos!`, 'success');
                    closeUploadModal();
                    loadSessions(); // Refresh to show new photos
                    
                    // Trigger milestone celebration for photo upload
                    celebrateMilestone('photos_uploaded');
                } else {
                    throw new Error(result.error || 'Upload failed');
                }
            } catch (error) {
                console.error('Upload error:', error);
                showMessage('Upload failed: ' + error.message, 'error');
            }
        }

        async function deleteSession(sessionId) {
            if (!confirm('Are you sure you want to delete this session?')) return;

            try {
                const response = await fetch(`/api/sessions/${sessionId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    sessions = sessions.filter(s => s.id !== sessionId);
                    renderSessions();
                    showMessage('Session deleted successfully!', 'success');
                } else {
                    showMessage('Failed to delete session', 'error');
                }
            } catch (error) {
                console.error('Error deleting session:', error);
                showMessage('Error deleting session', 'error');
            }
        }

        function viewPhoto(url) {
            window.open(url, '_blank');
        }

        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showMessage(text, type) {
            const message = document.createElement('div');
            message.textContent = text;
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                background: ${type === 'success' ? '#48bb78' : '#e53e3e'};
            `;
            
            document.body.appendChild(message);
            setTimeout(() => message.remove(), 3000);
        }

        // Admin-only button functions
        let editingSessionId = null;

        function editSession(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;
            
            editingSessionId = sessionId;
            
            // Populate the form with existing data for editing
            document.getElementById('clientName').value = session.clientName;
            document.getElementById('sessionType').value = session.sessionType;
            document.getElementById('dateTime').value = session.dateTime;
            document.getElementById('location').value = session.location;
            document.getElementById('phoneNumber').value = session.phoneNumber;
            document.getElementById('email').value = session.email;
            document.getElementById('price').value = session.price;
            document.getElementById('duration').value = session.duration;
            
            // Set checkbox states
            document.getElementById('contractSigned').checked = session.contractSigned || false;
            document.getElementById('paid').checked = session.paid || false;
            document.getElementById('edited').checked = session.edited || false;
            document.getElementById('delivered').checked = session.delivered || false;
            document.getElementById('sendReminder').checked = session.sendReminder || false;
            document.getElementById('notifyGalleryReady').checked = session.notifyGalleryReady || false;
            
            // Update form UI for editing
            const form = document.getElementById('sessionForm');
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.textContent = 'Update Session';
            
            // Scroll to form
            form.scrollIntoView({ behavior: 'smooth' });
            
            showMessage('Form populated for editing. Update and save changes.', 'success');
        }

        // Open email client with session details  
        function openEmailClient(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;
            
            const subject = `Photography Session - ${session.sessionType} with ${session.clientName}`;
            const body = `Hi ${session.clientName},

I hope this email finds you well! I'm writing regarding your upcoming ${session.sessionType} photography session.

Session Details:
📅 Date: ${new Date(session.dateTime).toLocaleDateString()}
🕐 Time: ${new Date(session.dateTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
📍 Location: ${session.location}
💰 Investment: $${session.price}
📞 Contact: ${session.phoneNumber}

I'm excited to capture these special moments for you! If you have any questions or need to make any changes, please don't hesitate to reach out.

Best regards,
Lance - The Legacy Photography
Professional Photography Services
lance@thelegacyphotography.com`;

            const mailtoUrl = `mailto:${session.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoUrl;
        }

        // Copy gallery URL to clipboard
        async function copyGalleryUrl(sessionId) {
            try {
                showMessage('Generating gallery URL...', 'info');
                
                // Generate gallery access if not exists
                const response = await fetch(`/api/sessions/${sessionId}/generate-gallery-access`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to generate gallery access');
                }
                
                const data = await response.json();
                const session = sessions.find(s => s.id === sessionId);
                
                console.log('Generated gallery URL:', data.galleryUrl);
                
                // Try multiple methods to copy URL with enhanced mobile support
                let copySuccess = false;
                let method = '';
                
                // Method 1: Modern clipboard API (works on HTTPS and secure contexts)
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    try {
                        await navigator.clipboard.writeText(data.galleryUrl);
                        copySuccess = true;
                        method = 'clipboard API';
                        console.log('Clipboard API copy successful');
                        
                        // Trigger milestone celebration for gallery sharing
                        celebrateMilestone('gallery_shared');
                    } catch (clipboardError) {
                        console.log('Clipboard API failed:', clipboardError.message);
                    }
                }
                
                // Method 2: Enhanced textarea fallback with mobile optimization
                if (!copySuccess) {
                    try {
                        const textarea = document.createElement('textarea');
                        textarea.value = data.galleryUrl;
                        
                        // Enhanced styles for mobile compatibility
                        textarea.style.position = 'fixed';
                        textarea.style.top = '0';
                        textarea.style.left = '0';
                        textarea.style.width = '2em';
                        textarea.style.height = '2em';
                        textarea.style.padding = '0';
                        textarea.style.border = 'none';
                        textarea.style.outline = 'none';
                        textarea.style.boxShadow = 'none';
                        textarea.style.background = 'transparent';
                        textarea.style.opacity = '0';
                        textarea.style.zIndex = '-1';
                        
                        document.body.appendChild(textarea);
                        
                        // Enhanced selection for mobile devices
                        textarea.focus();
                        textarea.setSelectionRange(0, 99999);
                        textarea.select();
                        
                        // Try execCommand
                        const successful = document.execCommand('copy');
                        document.body.removeChild(textarea);
                        
                        if (successful) {
                            copySuccess = true;
                            method = 'execCommand';
                            console.log('execCommand copy successful');
                        }
                    } catch (fallbackError) {
                        console.log('Fallback copy failed:', fallbackError.message);
                    }
                }
                
                // Method 3: Share API for mobile devices (if available)
                if (!copySuccess && navigator.share) {
                    try {
                        await navigator.share({
                            title: `Gallery for ${session.clientName}`,
                            text: `View your ${session.sessionType} photos:`,
                            url: data.galleryUrl
                        });
                        method = 'share API';
                        showMessage('Gallery shared successfully!', 'success');
                        return; // Exit early since sharing was successful
                    } catch (shareError) {
                        console.log('Share API failed:', shareError.message);
                    }
                }
                
                // Always show the URL in a prompt dialog for copying
                if (copySuccess) {
                    showMessage(`Gallery URL copied successfully! (${method})`, 'success');
                    // Show confirmation with the URL
                    alert(`✅ Gallery URL copied for ${session.clientName}!\n\nURL: ${data.galleryUrl}\n\nYou can now paste this into your email or text message.`);
                } else {
                    showMessage('Copy the URL from the dialog below', 'info');
                    // Show URL in a prompt for manual copying
                    const userAction = prompt(`Copy this gallery URL for ${session.clientName}:`, data.galleryUrl);
                    if (userAction !== null) {
                        showMessage('Gallery URL provided for copying', 'success');
                    }
                }
                
            } catch (error) {
                console.error('Error copying gallery URL:', error);
                showMessage('Failed to generate gallery URL: ' + error.message, 'error');
            }
        }

        function addToCalendar(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;
            
            // For iPhone, use the server endpoint
            if (/iPhone|iPad/.test(navigator.userAgent)) {
                window.location.href = `/api/sessions/${sessionId}/calendar.ics`;
                showMessage('Opening iPhone Calendar...', 'success');
                return;
            }
            
            const startDate = new Date(session.dateTime);
            const endDate = new Date(startDate.getTime() + (session.duration * 60000));
            
            const formatDate = (date) => {
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };
            
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Photography Scheduler//EN
BEGIN:VEVENT
UID:${session.id}@photographyschedule.com
DTSTAMP:${formatDate(new Date())}
DTSTART:${formatDate(startDate)}
DTEND:${formatDate(endDate)}
SUMMARY:Photography Session - ${session.clientName}
DESCRIPTION:Session Type: ${session.sessionType}\\nLocation: ${session.location}\\nClient: ${session.clientName}\\nPhone: ${session.phoneNumber}\\nEmail: ${session.email}\\nPrice: $${session.price}
LOCATION:${session.location}
END:VEVENT
END:VCALENDAR`;
            
            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${session.clientName.replace(/\s+/g, '_')}_photography_session.ics`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('Calendar event downloaded!', 'success');
        }

        async function sendGalleryReady(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;
            
            try {
                // First, generate gallery access token
                const generateResponse = await fetch(`/api/sessions/${sessionId}/generate-gallery-access`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!generateResponse.ok) {
                    throw new Error('Failed to generate gallery access');
                }
                
                const galleryData = await generateResponse.json();
                
                // Then send notification
                const notifyResponse = await fetch(`/api/sessions/${sessionId}/send-gallery-notification`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!notifyResponse.ok) {
                    throw new Error('Failed to send gallery notification');
                }
                
                const notifyData = await notifyResponse.json();
                
                // Show success message with gallery URL
                showMessage(`Gallery ready! Secure link sent to ${session.clientName}`, 'success');
                
                // Optional: Show the gallery URL in a popup for copying
                const showUrlConfirm = confirm(`Gallery notification sent to ${session.clientName}!\n\nGallery URL (for your reference):\n${galleryData.galleryUrl}\n\nClick OK to copy link to clipboard.`);
                
                if (showUrlConfirm) {
                    navigator.clipboard.writeText(galleryData.galleryUrl).then(() => {
                        showMessage('Gallery URL copied to clipboard!', 'success');
                    }).catch(() => {
                        // Fallback for browsers that don't support clipboard API
                        prompt('Copy this gallery URL:', galleryData.galleryUrl);
                    });
                }
                
            } catch (error) {
                console.error('Error sending gallery ready notification:', error);
                showMessage('Failed to send gallery notification: ' + error.message, 'error');
            }
        }

        async function sendInvoice(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;
            
            try {
                const response = await fetch(`/api/sessions/${sessionId}/send-invoice`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to send invoice');
                }
                
                const result = await response.json();
                
                if (result.fallbackMode) {
                    // Handle simulation mode
                    showMessage(`Invoice simulation completed for ${session.clientName}`, 'info');
                    alert(`Invoice Simulation Mode\n\nClient: ${result.clientName}\nAmount: $${result.amount}\nSession: ${result.sessionType}\n\n${result.details}`);
                } else {
                    // Handle real Stripe invoice
                    showMessage(`Invoice sent to ${session.clientName} for $${session.price}!`, 'success');
                    
                    // Trigger milestone celebration for invoice sent
                    celebrateMilestone('invoice_sent');
                    
                    // Show invoice URL
                    const showUrlConfirm = confirm(`Invoice sent successfully to ${session.clientName}!\n\nInvoice Amount: $${session.price}\nStatus: ${result.invoice ? result.invoice.status : 'sent'}\n\nClick OK to view the invoice.`);
                    
                    if (showUrlConfirm && result.invoice && result.invoice.hostedInvoiceUrl) {
                        window.open(result.invoice.hostedInvoiceUrl, '_blank');
                    }
                }
                
            } catch (error) {
                console.error('Error sending invoice:', error);
                showMessage('Failed to send invoice: ' + error.message, 'error');
            }
        }

        function callClient(phoneNumber) {
            window.location.href = `tel:${phoneNumber}`;
        }

        function textClient(phoneNumber, clientName, sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (session && session.galleryAccessToken) {
                const galleryUrl = `${window.location.origin}/gallery/${sessionId}?access=${session.galleryAccessToken}`;
                const message = `📸 ${clientName}, your ${session.sessionType} photos are ready! View gallery: ${galleryUrl}`;
                window.location.href = `sms:${phoneNumber}?body=${encodeURIComponent(message)}`;
            } else {
                const message = `Hi ${clientName}, your photos will be ready soon! We'll send you the gallery link when they're available.`;
                window.location.href = `sms:${phoneNumber}?body=${encodeURIComponent(message)}`;
            }
        }

        async function viewGallery(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;
            
            // Check if gallery access exists
            if (session.galleryAccessToken) {
                // Open existing gallery
                window.open(`/gallery/${sessionId}?access=${session.galleryAccessToken}`, '_blank');
            } else {
                // Generate gallery access first
                try {
                    const response = await fetch(`/api/sessions/${sessionId}/generate-gallery-access`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to generate gallery access');
                    }
                    
                    const galleryData = await response.json();
                    
                    // Update local session data
                    session.galleryAccessToken = galleryData.accessToken;
                    
                    // Open gallery
                    window.open(galleryData.galleryUrl, '_blank');
                    
                } catch (error) {
                    console.error('Error generating gallery access:', error);
                    showMessage('Failed to generate gallery access: ' + error.message, 'error');
                }
            }
        }
    </script>

    <!-- Confetti Container for Milestone Celebrations -->
    <div id="confettiContainer" class="confetti-container"></div>

    <script>
        // Confetti Animation System for Milestone Celebrations
        function createConfetti(x, y, count = 50) {
            const container = document.getElementById('confettiContainer');
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'];
            
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                
                // Random positioning and styling
                const startX = x || Math.random() * window.innerWidth;
                const startY = y || -20;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = Math.random() * 8 + 6;
                const duration = Math.random() * 2 + 2;
                
                confetti.style.left = startX + 'px';
                confetti.style.top = startY + 'px';
                confetti.style.backgroundColor = color;
                confetti.style.width = size + 'px';
                confetti.style.height = size + 'px';
                confetti.style.animationDuration = duration + 's';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                
                container.appendChild(confetti);
                
                // Clean up after animation
                setTimeout(() => {
                    if (confetti && confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, (duration + 0.5) * 1000);
            }
        }
        
        function showMilestoneToast(message, emoji = '🎉') {
            const toast = document.createElement('div');
            toast.className = 'milestone-toast';
            toast.innerHTML = `${emoji} ${message}`;
            
            document.body.appendChild(toast);
            
            // Remove toast after animation
            setTimeout(() => {
                if (toast && toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 2000);
        }
        
        function celebrateMilestone(type, sessionName = '') {
            const celebrations = {
                'session_created': {
                    message: `New Session Created: ${sessionName}`,
                    emoji: '📅',
                    confetti: 30
                },
                'contract_signed': {
                    message: 'Contract Signed!',
                    emoji: '📝',
                    confetti: 25
                },
                'payment_received': {
                    message: 'Payment Received!',
                    emoji: '💰',
                    confetti: 40
                },
                'photos_uploaded': {
                    message: 'Photos Uploaded Successfully!',
                    emoji: '📸',
                    confetti: 35
                },
                'session_delivered': {
                    message: 'Session Delivered!',
                    emoji: '📦',
                    confetti: 45
                },
                'gallery_shared': {
                    message: 'Gallery Shared with Client!',
                    emoji: '🖼️',
                    confetti: 30
                },
                'invoice_sent': {
                    message: 'Invoice Sent Successfully!',
                    emoji: '💳',
                    confetti: 25
                },
                'payment_plan_created': {
                    message: 'Payment Plan Created!',
                    emoji: '💳',
                    confetti: 30
                }
            };
            
            const celebration = celebrations[type];
            if (!celebration) return;
            
            // Show toast message
            showMilestoneToast(celebration.message, celebration.emoji);
            
            // Trigger confetti from multiple points
            setTimeout(() => {
                createConfetti(window.innerWidth * 0.25, -20, celebration.confetti / 2);
                createConfetti(window.innerWidth * 0.75, -20, celebration.confetti / 2);
            }, 200);
        }
        
        // Global function to trigger celebrations
        window.celebrateMilestone = celebrateMilestone;

        // Payment Plan Functions
        function openPaymentPlanModal(sessionId) {
            currentPaymentPlanSessionId = sessionId;
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;
            
            // Pre-fill with session price
            document.getElementById('planTotalAmount').value = session.price;
            
            // Set default start date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('planStartDate').value = today;
            
            // Set default end date to 6 months from now
            const sixMonthsLater = new Date();
            sixMonthsLater.setMonth(sixMonthsLater.getMonth() + 6);
            document.getElementById('planEndDate').value = sixMonthsLater.toISOString().split('T')[0];
            
            document.getElementById('paymentPlanModal').classList.add('active');
        }
        
        function closePaymentPlanModal() {
            document.getElementById('paymentPlanModal').classList.remove('active');
            document.getElementById('paymentPlanSummary').style.display = 'none';
            currentPaymentPlanSessionId = null;
        }
        
        function calculatePaymentPreview() {
            const totalAmount = parseFloat(document.getElementById('planTotalAmount').value);
            const startDate = new Date(document.getElementById('planStartDate').value);
            const endDate = new Date(document.getElementById('planEndDate').value);
            
            if (!totalAmount || !startDate || !endDate) {
                showMessage('Please fill in all fields', 'error');
                return;
            }
            
            if (startDate >= endDate) {
                showMessage('End date must be after start date', 'error');
                return;
            }
            
            // Calculate months between dates
            const monthsDiff = Math.max(1, (endDate.getFullYear() - startDate.getFullYear()) * 12 + (endDate.getMonth() - startDate.getMonth()));
            const monthlyPayment = (totalAmount / monthsDiff).toFixed(2);
            
            // Show summary
            const summaryElement = document.getElementById('paymentPlanSummary');
            const detailsElement = document.getElementById('paymentSummaryDetails');
            const scheduleElement = document.getElementById('paymentSchedulePreview');
            
            detailsElement.innerHTML = `
                <p><strong>Total Amount:</strong> $${totalAmount.toFixed(2)}</p>
                <p><strong>Number of Payments:</strong> ${monthsDiff}</p>
                <p><strong>Monthly Payment:</strong> $${monthlyPayment}</p>
                <p><strong>Period:</strong> ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}</p>
            `;
            
            // Generate payment schedule preview
            let scheduleHTML = '<h5>Payment Schedule:</h5>';
            for (let i = 0; i < Math.min(monthsDiff, 6); i++) { // Show first 6 payments
                const paymentDate = new Date(startDate);
                paymentDate.setMonth(paymentDate.getMonth() + i);
                
                scheduleHTML += `
                    <div class="payment-item">
                        <div>
                            <strong>Payment ${i + 1}</strong><br>
                            <small>${paymentDate.toLocaleDateString()}</small>
                        </div>
                        <div>$${monthlyPayment}</div>
                        <div class="payment-status pending">Pending</div>
                    </div>
                `;
            }
            
            if (monthsDiff > 6) {
                scheduleHTML += `<p><small>... and ${monthsDiff - 6} more payments</small></p>`;
            }
            
            scheduleElement.innerHTML = scheduleHTML;
            summaryElement.style.display = 'block';
        }
        
        async function createPaymentPlan() {
            const totalAmount = parseFloat(document.getElementById('planTotalAmount').value);
            const startDate = document.getElementById('planStartDate').value;
            const endDate = document.getElementById('planEndDate').value;
            const reminderDays = parseInt(document.getElementById('planReminderDays').value);
            
            if (!totalAmount || !startDate || !endDate || !currentPaymentPlanSessionId) {
                showMessage('Please fill in all fields', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/sessions/${currentPaymentPlanSessionId}/payment-plan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        totalAmount,
                        startDate,
                        endDate,
                        reminderDays
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to create payment plan');
                }
                
                const result = await response.json();
                
                closePaymentPlanModal();
                showMessage(`Payment plan created! ${result.payments.length} monthly payments of $${result.plan.monthlyPayment}`, 'success');
                
                // Refresh sessions to show updated data
                loadSessions();
                
                // Celebrate milestone
                celebrateMilestone('payment_plan_created', sessions.find(s => s.id === currentPaymentPlanSessionId)?.clientName || 'Client');
                
            } catch (error) {
                console.error('Error creating payment plan:', error);
                showMessage('Failed to create payment plan: ' + error.message, 'error');
            }
        }
        
        async function viewPaymentPlan(sessionId) {
            try {
                const response = await fetch(`/api/sessions/${sessionId}/payment-plan`);
                
                if (!response.ok) {
                    throw new Error('Payment plan not found');
                }
                
                const paymentPlan = await response.json();
                const session = sessions.find(s => s.id === sessionId);
                
                // Update modal title
                document.getElementById('paymentPlanViewTitle').textContent = `💳 Payment Plan - ${session?.clientName || 'Client'}`;
                
                // Generate payment plan view
                let contentHTML = `
                    <div class="payment-plan-summary">
                        <h4>📋 Plan Overview</h4>
                        <p><strong>Total Amount:</strong> $${parseFloat(paymentPlan.totalAmount).toFixed(2)}</p>
                        <p><strong>Monthly Payment:</strong> $${parseFloat(paymentPlan.monthlyPayment).toFixed(2)}</p>
                        <p><strong>Payments Completed:</strong> ${paymentPlan.paymentsCompleted} of ${paymentPlan.totalPayments}</p>
                        <p><strong>Amount Paid:</strong> $${parseFloat(paymentPlan.amountPaid).toFixed(2)}</p>
                        <p><strong>Remaining Balance:</strong> $${parseFloat(paymentPlan.remainingBalance).toFixed(2)}</p>
                        <p><strong>Status:</strong> <span class="payment-status ${paymentPlan.status}">${paymentPlan.status.toUpperCase()}</span></p>
                    </div>
                    
                    <div class="payment-schedule">
                        <h4>📅 Payment Schedule</h4>
                `;
                
                for (const payment of paymentPlan.payments) {
                    const dueDate = new Date(payment.dueDate);
                    const isOverdue = dueDate < new Date() && payment.status === 'pending';
                    const statusClass = isOverdue ? 'overdue' : payment.status;
                    
                    contentHTML += `
                        <div class="payment-item">
                            <div>
                                <strong>Payment ${payment.paymentNumber}</strong><br>
                                <small>Due: ${dueDate.toLocaleDateString()}</small>
                                ${payment.paidDate ? `<br><small>Paid: ${new Date(payment.paidDate).toLocaleDateString()}</small>` : ''}
                            </div>
                            <div>$${parseFloat(payment.amount).toFixed(2)}</div>
                            <div>
                                <div class="payment-status ${statusClass}">${payment.status.toUpperCase()}</div>
                                ${payment.status === 'pending' ? `
                                    <button class="btn btn-sm" onclick="markPaymentPaid('${payment.id}')" style="margin-top: 5px;">Mark Paid</button>
                                    <button class="btn btn-sm" onclick="sendPaymentInvoice('${payment.id}')" style="margin-top: 5px;">Send Invoice</button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
                
                contentHTML += '</div>';
                
                document.getElementById('paymentPlanViewContent').innerHTML = contentHTML;
                document.getElementById('paymentPlanViewModal').classList.add('active');
                
            } catch (error) {
                console.error('Error viewing payment plan:', error);
                showMessage('Failed to load payment plan: ' + error.message, 'error');
            }
        }
        
        function closePaymentPlanViewModal() {
            document.getElementById('paymentPlanViewModal').classList.remove('active');
        }
        
        async function markPaymentPaid(paymentId) {
            try {
                const response = await fetch(`/api/payments/${paymentId}/mark-paid`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        paymentMethod: 'manual',
                        notes: 'Marked as paid by admin'
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to mark payment as paid');
                }
                
                showMessage('Payment marked as paid!', 'success');
                loadSessions(); // Refresh session data
                // Re-open the payment plan view to show updated status
                setTimeout(() => {
                    if (currentPaymentPlanSessionId) {
                        viewPaymentPlan(currentPaymentPlanSessionId);
                    }
                }, 500);
                
            } catch (error) {
                console.error('Error marking payment paid:', error);
                showMessage('Failed to mark payment as paid: ' + error.message, 'error');
            }
        }
        
        async function sendPaymentInvoice(paymentId) {
            try {
                const response = await fetch(`/api/payments/${paymentId}/send-invoice`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to send invoice');
                }
                
                showMessage('Payment invoice sent successfully!', 'success');
                celebrateMilestone('invoice_sent');
                
            } catch (error) {
                console.error('Error sending payment invoice:', error);
                showMessage('Failed to send invoice: ' + error.message, 'error');
            }
        }
        
        async function processAutomatedPayments() {
            try {
                const response = await fetch('/api/payments/process-automated', {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    throw new Error('Failed to process payments');
                }
                
                const result = await response.json();
                
                showMessage(`Processing complete! ${result.results.invoicesSent} invoices sent, ${result.results.remindersSent} reminders sent`, 'success');
                
                // Refresh data
                loadSessions();
                
            } catch (error) {
                console.error('Error processing automated payments:', error);
                showMessage('Failed to process payments: ' + error.message, 'error');
            }
        }

        // Contract Management Functions
        let currentContractSessionId = null;

        async function openContractModal(sessionId) {
            currentContractSessionId = sessionId;
            const session = sessions.find(s => s.id === sessionId);
            if (!session) return;

            // Load existing contracts for this session
            await loadExistingContracts(sessionId);
            
            document.getElementById('contractModal').classList.add('active');
        }

        function closeContractModal() {
            document.getElementById('contractModal').classList.remove('active');
            currentContractSessionId = null;
        }

        async function loadExistingContracts(sessionId) {
            try {
                const response = await fetch(`/api/sessions/${sessionId}/contracts`);
                if (!response.ok) {
                    throw new Error('Failed to load contracts');
                }

                const contracts = await response.json();
                const existingContractsDiv = document.getElementById('existingContracts');
                
                if (contracts.length === 0) {
                    existingContractsDiv.innerHTML = '';
                    return;
                }

                existingContractsDiv.innerHTML = `
                    <h4>Existing Contracts:</h4>
                    <div class="existing-contracts-list">
                        ${contracts.map(contract => `
                            <div class="contract-item ${contract.status}">
                                <div class="contract-item-info">
                                    <h5>${contract.contract_title}</h5>
                                    <p>Status: ${contract.status.charAt(0).toUpperCase() + contract.status.slice(1)}</p>
                                    <p>Created: ${new Date(contract.created_at).toLocaleDateString()}</p>
                                    ${contract.signed_date ? `<p>Signed: ${new Date(contract.signed_date).toLocaleDateString()}</p>` : ''}
                                </div>
                                <div class="contract-item-actions">
                                    ${contract.status === 'pending' ? `
                                        <button class="btn btn-primary btn-sm" onclick="sendContract('${contract.id}')">
                                            📧 Send Contract
                                        </button>
                                    ` : contract.status === 'sent' ? `
                                        <span class="contract-status-badge sent">📤 Sent</span>
                                    ` : contract.status === 'signed' ? `
                                        <span class="contract-status-badge signed">✅ Signed</span>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                console.error('Error loading contracts:', error);
                showMessage('Failed to load existing contracts', 'error');
            }
        }

        async function createContract(sessionId, contractType) {
            try {
                showMessage('Creating contract...', 'info');
                
                const response = await fetch(`/api/sessions/${sessionId}/contracts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contractType: contractType
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to create contract');
                }

                const result = await response.json();
                
                showMessage('Contract created successfully!', 'success');
                
                // Reload the existing contracts to show the new one
                await loadExistingContracts(sessionId);
                
                // Trigger milestone celebration
                celebrateMilestone('contract_signed');
                
            } catch (error) {
                console.error('Error creating contract:', error);
                showMessage('Failed to create contract: ' + error.message, 'error');
            }
        }

        async function sendContract(contractId) {
            try {
                showMessage('Sending contract to client...', 'info');
                
                const response = await fetch(`/api/contracts/${contractId}/send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to send contract');
                }

                const result = await response.json();
                
                showMessage('Contract sent successfully!', 'success');
                
                // Show the signing URL for reference
                alert(`Contract sent to client!\n\nSigning URL: ${result.signingUrl}\n\nThe client will receive an email with the signing link.`);
                
                // Reload existing contracts to update status
                await loadExistingContracts(currentContractSessionId);
                
            } catch (error) {
                console.error('Error sending contract:', error);
                showMessage('Failed to send contract: ' + error.message, 'error');
            }
        }

        // Send deposit invoice with custom amount
        async function sendDepositInvoice(sessionId) {
            try {
                const session = sessions.find(s => s.id === sessionId);
                if (!session) {
                    showMessage('Session not found', 'error');
                    return;
                }

                // Prompt user for deposit amount
                const depositAmountInput = prompt(
                    `Enter deposit/retainer amount for ${session.clientName}:\n\nSession Total: $${session.price}\nSuggested 50%: $${(session.price * 0.5).toFixed(2)}`,
                    (session.price * 0.5).toFixed(2)
                );
                
                if (!depositAmountInput) {
                    return; // User cancelled
                }
                
                const depositAmount = parseFloat(depositAmountInput);
                
                if (isNaN(depositAmount) || depositAmount <= 0) {
                    showMessage('Please enter a valid amount greater than $0', 'error');
                    return;
                }
                
                if (depositAmount > session.price) {
                    const confirmOverage = confirm(
                        `Deposit amount ($${depositAmount}) is more than the session total ($${session.price}).\n\nDo you want to continue?`
                    );
                    if (!confirmOverage) {
                        return;
                    }
                }
                
                console.log('Creating deposit invoice for session:', session);
                showMessage('Creating deposit invoice...', 'info');
                
                const authToken = await getAuthToken();
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                }
                
                const response = await fetch('/api/create-invoice', {
                    method: 'POST',
                    headers,
                    body: JSON.stringify({
                        sessionId: session.id,
                        clientName: session.clientName,
                        email: session.email,
                        amount: depositAmount,
                        description: `Retainer for ${session.sessionType} Photography Session (Total: $${session.price})`,
                        dueDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString(), // 14 days for deposit
                        isDeposit: true,
                        depositAmount: depositAmount,
                        totalAmount: session.price
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Failed to create deposit invoice: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('Deposit invoice creation result:', result);
                
                if (result.success && result.invoice_url) {
                    showMessage('Deposit invoice created successfully!', 'success');
                    
                    // Trigger celebration confetti
                    celebrateMilestone('invoice_sent', session.clientName);
                    
                    // Open the invoice URL in a new tab
                    window.open(result.invoice_url, '_blank');
                    
                    // Show a dialog with invoice details
                    const remainingBalance = session.price - depositAmount;
                    const message = `Deposit invoice created successfully!\n\nRetainer: $${depositAmount}\nRemaining Balance: $${remainingBalance.toFixed(2)}\n\nInvoice URL: ${result.invoice_url}\n\nThe invoice has been sent to ${session.email}`;
                    alert(message);
                } else {
                    throw new Error(result.error || 'Unknown error creating deposit invoice');
                }
                
            } catch (error) {
                console.error('Error creating deposit invoice:', error);
                showMessage('Error creating deposit invoice: ' + error.message, 'error');
            }
        }

        // Get authentication token helper function
        async function getAuthToken() {
            try {
                const response = await fetch('/api/auth/user');
                if (response.ok) {
                    return 'authenticated'; // Simplified token for authenticated requests
                }
                return null;
            } catch (error) {
                console.error('Error getting auth token:', error);
                return null;
            }
        }

        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Set active nav tab
            event.target.classList.add('active');
            
            // Initialize website builder if switching to websites tab
            if (tabName === 'websites') {
                initializeWebsiteBuilder();
            }
        }

        // Website Builder Functionality
        let currentWebsite = null;
        let websiteComponents = [];
        let selectedComponent = null;
        let draggedComponent = null;

        function initializeWebsiteBuilder() {
            console.log('Initializing website builder...');
            setupDragAndDrop();
            toggleDevice('desktop'); // Default to desktop view
        }

        function createNewWebsite() {
            const websiteName = prompt('Enter website name:', 'My Photography Website');
            if (!websiteName) return;
            
            currentWebsite = {
                id: Date.now().toString(),
                name: websiteName,
                components: [],
                settings: {
                    theme: 'modern',
                    colors: {
                        primary: '#667eea',
                        secondary: '#764ba2',
                        accent: '#81e6d9'
                    }
                },
                createdAt: new Date().toISOString()
            };
            
            document.getElementById('websiteName').textContent = websiteName;
            document.getElementById('builderInterface').style.display = 'grid';
            document.getElementById('websiteList').style.display = 'none';
            document.getElementById('previewBtn').disabled = false;
            document.getElementById('publishBtn').disabled = false;
            
            showMessage('New website created: ' + websiteName, 'success');
            celebrateMilestone('session_created', websiteName);
        }

        function loadWebsites() {
            document.getElementById('builderInterface').style.display = 'none';
            document.getElementById('websiteList').style.display = 'block';
            
            // Load existing websites (mock data for now)
            const mockWebsites = [
                {
                    id: '1',
                    name: 'Portfolio Website',
                    preview: '📸',
                    description: 'Professional photography portfolio',
                    lastModified: '2 days ago'
                },
                {
                    id: '2',
                    name: 'Wedding Photography',
                    preview: '💒',
                    description: 'Specialized wedding photography site',
                    lastModified: '1 week ago'
                },
                {
                    id: '3',
                    name: 'Studio Gallery',
                    preview: '🏢',
                    description: 'Commercial studio showcase',
                    lastModified: '3 days ago'
                }
            ];
            
            const websitesGrid = document.getElementById('websitesGrid');
            websitesGrid.innerHTML = mockWebsites.map(website => `
                <div class="website-card">
                    <div class="website-preview">${website.preview}</div>
                    <div class="website-info">
                        <h4>${website.name}</h4>
                        <p>${website.description}</p>
                        <small>Last modified: ${website.lastModified}</small>
                    </div>
                    <div class="website-actions">
                        <button class="btn btn-primary" onclick="editWebsite('${website.id}')">
                            ✏️ Edit
                        </button>
                        <button class="btn btn-success" onclick="previewWebsite('${website.id}')">
                            👁️ View
                        </button>
                        <button class="btn btn-danger" onclick="deleteWebsite('${website.id}')">
                            🗑️ Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function editWebsite(websiteId) {
            showMessage('Loading website editor...', 'info');
            // Switch to builder interface
            document.getElementById('websiteList').style.display = 'none';
            document.getElementById('builderInterface').style.display = 'grid';
            document.getElementById('previewBtn').disabled = false;
            document.getElementById('publishBtn').disabled = false;
        }

        function previewWebsite(websiteId) {
            if (!currentWebsite && !websiteId) {
                showMessage('No website selected', 'error');
                return;
            }
            
            showMessage('Generating website preview...', 'info');
            
            // Get the current website content
            const dropZone = document.getElementById('dropZone');
            const websiteContent = dropZone.innerHTML;
            
            if (!websiteContent || websiteContent.includes('drop-zone-message')) {
                showMessage('Please add some components to preview the website', 'error');
                return;
            }
            
            // Create a complete HTML page for preview
            const previewHTML = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${currentWebsite ? currentWebsite.name : 'Website Preview'} - Legacy Photography</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; }
                        .component-wrapper { margin: 0; }
                        .component-wrapper:hover { transform: none; box-shadow: none; }
                        
                        /* Mobile responsive styles */
                        @media (max-width: 768px) {
                            [style*="grid-template-columns"] { grid-template-columns: 1fr !important; }
                            [style*="font-size: 4rem"], [style*="font-size: 4.5rem"], [style*="font-size: 5rem"] { font-size: 2.5rem !important; }
                            [style*="font-size: 3.5rem"] { font-size: 2rem !important; }
                            [style*="font-size: 3rem"] { font-size: 1.8rem !important; }
                            [style*="padding: 100px"] { padding: 50px 20px !important; }
                            [style*="padding: 80px"] { padding: 40px 20px !important; }
                            [style*="padding: 60px"] { padding: 30px 20px !important; }
                            [style*="gap: 80px"] { gap: 40px !important; }
                            [style*="gap: 40px"] { gap: 20px !important; }
                            [style*="height: 100vh"] { height: 70vh !important; }
                            [style*="height: 90vh"] { height: 60vh !important; }
                            [style*="height: 85vh"] { height: 50vh !important; }
                        }
                    </style>
                </head>
                <body>
                    ${websiteContent}
                </body>
                </html>
            `;
            
            // Create a new window with the preview
            const previewWindow = window.open('', '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
            
            showMessage('Website preview opened in new tab!', 'success');
            celebrateMilestone('gallery_shared', 'Website Preview');
        }

        function publishWebsite() {
            if (!currentWebsite) {
                showMessage('No website to publish', 'error');
                return;
            }
            
            showMessage('Publishing website...', 'info');
            
            setTimeout(() => {
                const publishedUrl = `https://${currentWebsite.name.toLowerCase().replace(/\s+/g, '-')}.legacyphotography.com`;
                showMessage('Website published successfully!', 'success');
                celebrateMilestone('session_delivered', currentWebsite.name);
                
                alert(`Website published!\n\nLive URL: ${publishedUrl}\n\nYour photography website is now live and accessible to clients.`);
            }, 2000);
        }

        function deleteWebsite(websiteId) {
            if (confirm('Are you sure you want to delete this website? This action cannot be undone.')) {
                showMessage('Website deleted', 'success');
                loadWebsites(); // Refresh the list
            }
        }

        // Device toggle functionality
        function toggleDevice(device) {
            const canvas = document.getElementById('websiteCanvas');
            const controls = document.querySelectorAll('.canvas-control');
            
            // Remove active class from all controls
            controls.forEach(control => control.classList.remove('active'));
            
            // Add active class to selected control
            document.getElementById(device + 'View').classList.add('active');
            
            // Update canvas class
            canvas.className = 'website-canvas ' + device;
        }

        // Drag and Drop functionality
        function setupDragAndDrop() {
            const dropZone = document.getElementById('dropZone');
            const componentItems = document.querySelectorAll('.component-item');
            
            // Add drag event listeners to components
            componentItems.forEach(item => {
                // Desktop drag and drop
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                
                // Mobile tap to add
                item.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768) {
                        e.preventDefault();
                        const componentType = this.dataset.component;
                        addComponentToCanvas(componentType);
                        
                        // Show feedback for mobile users
                        this.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            this.style.transform = 'scale(1)';
                        }, 150);
                    }
                });
                
                // Add touch feedback
                item.addEventListener('touchstart', function() {
                    this.style.backgroundColor = 'rgba(102, 126, 234, 0.1)';
                }, { passive: true });
                
                item.addEventListener('touchend', function() {
                    setTimeout(() => {
                        this.style.backgroundColor = '';
                    }, 200);
                }, { passive: true });
            });
            
            // Add drop event listeners to drop zone
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('drop', handleDrop);
            dropZone.addEventListener('dragenter', handleDragEnter);
            dropZone.addEventListener('dragleave', handleDragLeave);
        }

        function handleDragStart(e) {
            draggedComponent = e.target.dataset.component;
            e.target.style.opacity = '0.5';
        }

        function handleDragEnd(e) {
            e.target.style.opacity = '1';
            draggedComponent = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            e.preventDefault();
            document.getElementById('dropZone').classList.add('drag-over');
        }

        function handleDragLeave(e) {
            if (!e.relatedTarget || !document.getElementById('dropZone').contains(e.relatedTarget)) {
                document.getElementById('dropZone').classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            document.getElementById('dropZone').classList.remove('drag-over');
            
            if (draggedComponent) {
                addComponentToCanvas(draggedComponent);
            }
        }

        function addComponentToCanvas(componentType) {
            const componentHtml = generateComponentHtml(componentType);
            const dropZone = document.getElementById('dropZone');
            
            // If this is the first component, clear the drop zone message
            if (dropZone.querySelector('.drop-zone-message')) {
                dropZone.innerHTML = '';
                dropZone.style.border = 'none';
                dropZone.style.minHeight = 'auto';
                dropZone.style.display = 'block';
                dropZone.style.alignItems = 'stretch';
                dropZone.style.justifyContent = 'stretch';
            }
            
            // Create component wrapper
            const componentWrapper = document.createElement('div');
            componentWrapper.className = 'component-wrapper';
            componentWrapper.dataset.componentType = componentType;
            componentWrapper.innerHTML = componentHtml;
            
            // Add click handler for component selection
            componentWrapper.addEventListener('click', () => selectComponent(componentWrapper));
            
            dropZone.appendChild(componentWrapper);
            
            // Auto-select the new component
            selectComponent(componentWrapper);
            
            showMessage(`${componentType.charAt(0).toUpperCase() + componentType.slice(1)} component added`, 'success');
        }

        function generateComponentHtml(componentType) {
            const componentTemplates = {
                header: `
                    <header style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center;">
                        <h1 style="margin: 0; font-size: 2.5rem;">The Legacy Photography</h1>
                        <nav style="margin-top: 15px;">
                            <a href="#" style="color: white; margin: 0 15px; text-decoration: none;">Home</a>
                            <a href="#" style="color: white; margin: 0 15px; text-decoration: none;">Portfolio</a>
                            <a href="#" style="color: white; margin: 0 15px; text-decoration: none;">About</a>
                            <a href="#" style="color: white; margin: 0 15px; text-decoration: none;">Contact</a>
                        </nav>
                    </header>
                `,
                hero: `
                    <section style="background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600"><rect fill="%23f8fafc" width="1200" height="600"/><text x="50%" y="50%" text-anchor="middle" fill="%23666" font-size="24">Hero Background Image</text></svg>') center/cover; height: 500px; display: flex; align-items: center; justify-content: center; color: white; text-align: center;">
                        <div style="background: rgba(0,0,0,0.5); padding: 40px; border-radius: 12px;">
                            <h2 style="font-size: 3rem; margin-bottom: 20px;">Capturing Life's Beautiful Moments</h2>
                            <p style="font-size: 1.3rem; margin-bottom: 30px;">Professional photography services for weddings, portraits, and special events</p>
                            <button style="background: #667eea; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1rem; cursor: pointer;">View Portfolio</button>
                        </div>
                    </section>
                `,
                gallery: `
                    <section style="padding: 60px 20px; background: #f8fafc;">
                        <h2 style="text-align: center; margin-bottom: 40px; color: #2d3748;">Photo Gallery</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto;">
                            <div style="aspect-ratio: 1; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><rect fill="%23e2e8f0" width="300" height="300"/><text x="50%" y="50%" text-anchor="middle" fill="%23666" font-size="16">Photo 1</text></svg>') center/cover; border-radius: 8px;"></div>
                            <div style="aspect-ratio: 1; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><rect fill="%23e2e8f0" width="300" height="300"/><text x="50%" y="50%" text-anchor="middle" fill="%23666" font-size="16">Photo 2</text></svg>') center/cover; border-radius: 8px;"></div>
                            <div style="aspect-ratio: 1; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><rect fill="%23e2e8f0" width="300" height="300"/><text x="50%" y="50%" text-anchor="middle" fill="%23666" font-size="16">Photo 3</text></svg>') center/cover; border-radius: 8px;"></div>
                            <div style="aspect-ratio: 1; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><rect fill="%23e2e8f0" width="300" height="300"/><text x="50%" y="50%" text-anchor="middle" fill="%23666" font-size="16">Photo 4</text></svg>') center/cover; border-radius: 8px;"></div>
                        </div>
                    </section>
                `,
                about: `
                    <section style="padding: 60px 20px; background: white;">
                        <div style="max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: center;">
                            <div>
                                <h2 style="color: #2d3748; margin-bottom: 20px;">About The Legacy Photography</h2>
                                <p style="color: #666; line-height: 1.6; margin-bottom: 20px;">With over 10 years of experience in capturing life's most precious moments, we specialize in creating timeless memories that you'll treasure forever.</p>
                                <p style="color: #666; line-height: 1.6;">Our passion for photography drives us to deliver exceptional quality and personalized service for every client.</p>
                            </div>
                            <div style="background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><rect fill="%23e2e8f0" width="400" height="300"/><text x="50%" y="50%" text-anchor="middle" fill="%23666" font-size="18">Photographer Portrait</text></svg>') center/cover; height: 300px; border-radius: 12px;"></div>
                        </div>
                    </section>
                `,
                services: `
                    <section style="padding: 60px 20px; background: #f8fafc;">
                        <div style="max-width: 1200px; margin: 0 auto;">
                            <h2 style="text-align: center; margin-bottom: 40px; color: #2d3748;">Our Services</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                                <div style="background: white; padding: 30px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                    <div style="font-size: 3rem; margin-bottom: 20px;">💒</div>
                                    <h3 style="color: #2d3748; margin-bottom: 15px;">Weddings</h3>
                                    <p style="color: #666; line-height: 1.6;">Complete wedding photography packages to capture your special day</p>
                                </div>
                                <div style="background: white; padding: 30px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                    <div style="font-size: 3rem; margin-bottom: 20px;">👨‍👩‍👧‍👦</div>
                                    <h3 style="color: #2d3748; margin-bottom: 15px;">Portraits</h3>
                                    <p style="color: #666; line-height: 1.6;">Professional family and individual portrait sessions</p>
                                </div>
                                <div style="background: white; padding: 30px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                    <div style="font-size: 3rem; margin-bottom: 20px;">🎉</div>
                                    <h3 style="color: #2d3748; margin-bottom: 15px;">Events</h3>
                                    <p style="color: #666; line-height: 1.6;">Special event photography for celebrations and milestones</p>
                                </div>
                            </div>
                        </div>
                    </section>
                `,
                contact: `
                    <section style="padding: 60px 20px; background: white;">
                        <div style="max-width: 800px; margin: 0 auto;">
                            <h2 style="text-align: center; margin-bottom: 40px; color: #2d3748;">Get In Touch</h2>
                            <form style="display: grid; gap: 20px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                    <input type="text" placeholder="Your Name" style="padding: 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;">
                                    <input type="email" placeholder="Your Email" style="padding: 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <input type="text" placeholder="Subject" style="padding: 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;">
                                <textarea placeholder="Your Message" rows="5" style="padding: 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem; resize: vertical;"></textarea>
                                <button type="submit" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1rem; cursor: pointer;">Send Message</button>
                            </form>
                        </div>
                    </section>
                `,
                footer: `
                    <footer style="background: #2d3748; color: white; padding: 40px 20px; text-align: center;">
                        <div style="max-width: 1200px; margin: 0 auto;">
                            <h3 style="margin-bottom: 20px;">The Legacy Photography</h3>
                            <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; flex-wrap: wrap;">
                                <a href="#" style="color: white; text-decoration: none;">Home</a>
                                <a href="#" style="color: white; text-decoration: none;">Portfolio</a>
                                <a href="#" style="color: white; text-decoration: none;">About</a>
                                <a href="#" style="color: white; text-decoration: none;">Contact</a>
                            </div>
                            <p style="margin: 0; color: #a0aec0;">© 2025 The Legacy Photography. All rights reserved.</p>
                        </div>
                    </footer>
                `,
                text: `
                    <div style="padding: 40px 20px;">
                        <div style="max-width: 800px; margin: 0 auto;">
                            <h2 style="color: #2d3748; margin-bottom: 20px;">Your Heading Here</h2>
                            <p style="color: #666; line-height: 1.6; font-size: 1.1rem;">Add your text content here. You can edit this text by selecting this component and using the properties panel on the right.</p>
                        </div>
                    </div>
                `,
                image: `
                    <div style="padding: 20px;">
                        <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'><rect fill='%23e2e8f0' width='600' height='400'/><text x='50%' y='50%' text-anchor='middle' fill='%23666' font-size='24'>Your Image Here</text></svg>" alt="Image" style="width: 100%; height: auto; border-radius: 8px;">
                    </div>
                `,
                button: `
                    <div style="padding: 20px; text-align: center;">
                        <button style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.1rem; cursor: pointer;">Click Me</button>
                    </div>
                `
            };
            
            // Legacy Photography inspired templates based on actual website
            const legacyTemplates = {
                legacy_header: `
                    <header style="background: #1a1a1a; color: white; padding: 15px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
                        <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px;">
                            <div style="font-size: 1.8rem; font-weight: bold; color: #d4af37;">Legacy Photography</div>
                            <nav style="display: flex; gap: 30px;">
                                <a href="#" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.3s;">Home</a>
                                <a href="#" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.3s;">About</a>
                                <a href="#" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.3s;">Portfolio</a>
                                <a href="#" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.3s;">Client Galleries</a>
                                <a href="#" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.3s;">Contact</a>
                            </nav>
                        </div>
                    </header>
                `,
                legacy_hero: `
                    <section style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.4)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><linearGradient id="sunset" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23ff7f50;stop-opacity:1" /><stop offset="50%" style="stop-color:%23ff6347;stop-opacity:1" /><stop offset="100%" style="stop-color:%23ff4500;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23sunset)" width="1200" height="800"/><text x="50%" y="45%" text-anchor="middle" fill="white" font-size="48" font-weight="bold" opacity="0.3">Beautiful Sunset Beach</text></svg>') center/cover; height: 100vh; display: flex; align-items: center; justify-content: center; color: white; text-align: center; position: relative;">
                        <div style="max-width: 800px; padding: 60px 40px; background: rgba(0,0,0,0.3); border-radius: 20px; backdrop-filter: blur(10px);">
                            <h1 style="font-size: 4rem; margin-bottom: 20px; font-style: italic; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">Your Life, Your Legacy, Perfectly Captured!</h1>
                            <p style="font-size: 1.5rem; margin-bottom: 40px; line-height: 1.6; opacity: 0.95;">Premier photographer serving Myrtle Beach, Charleston, and the beautiful South Carolina coast. Specializing in stunning family portraits, beach sessions, weddings, and senior photos.</p>
                            <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                                <button style="background: #d4af37; color: #1a1a1a; border: none; padding: 18px 35px; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s; text-transform: uppercase;">View Portfolio</button>
                                <button style="background: transparent; color: white; border: 2px solid white; padding: 18px 35px; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s; text-transform: uppercase;">Book Session</button>
                            </div>
                        </div>
                    </section>
                `,
                legacy_services: `
                    <section style="padding: 100px 20px; background: #f8f6f0;">
                        <div style="max-width: 1200px; margin: 0 auto; text-align: center;">
                            <h2 style="font-size: 3.5rem; margin-bottom: 20px; color: #1a1a1a; font-style: italic;">Beach Photography That Celebrates Your Life and Legacy</h2>
                            <p style="font-size: 1.3rem; color: #666; margin-bottom: 60px; max-width: 800px; margin-left: auto; margin-right: auto; line-height: 1.8;">Time doesn't wait... We blink and the kids are grown... We laugh and the moment slips away... But through photography, we get to hold on.</p>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 40px; margin-top: 60px;">
                                <div style="text-align: center; padding: 40px 30px; background: white; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); transition: transform 0.3s;">
                                    <div style="font-size: 4rem; margin-bottom: 25px;">🏖️</div>
                                    <h3 style="color: #1a1a1a; margin-bottom: 20px; font-size: 1.8rem;">Beach Photography</h3>
                                    <p style="color: #666; line-height: 1.7;">Stunning coastal sessions along Myrtle Beach and Charleston shores, capturing your family against breathtaking ocean backdrops.</p>
                                </div>
                                
                                <div style="text-align: center; padding: 40px 30px; background: white; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); transition: transform 0.3s;">
                                    <div style="font-size: 4rem; margin-bottom: 25px;">💒</div>
                                    <h3 style="color: #1a1a1a; margin-bottom: 20px; font-size: 1.8rem;">Wedding Photography</h3>
                                    <p style="color: #666; line-height: 1.7;">Complete wedding packages capturing your special day with creative lighting and personalized touches throughout South Carolina.</p>
                                </div>
                                
                                <div style="text-align: center; padding: 40px 30px; background: white; border-radius: 15px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); transition: transform 0.3s;">
                                    <div style="font-size: 4rem; margin-bottom: 25px;">👨‍👩‍👧‍👦</div>
                                    <h3 style="color: #1a1a1a; margin-bottom: 20px; font-size: 1.8rem;">Family Portraits</h3>
                                    <p style="color: #666; line-height: 1.7;">Heartfelt family sessions that preserve precious memories, celebrating your unique story with timeless, artistic photography.</p>
                                </div>
                            </div>
                        </div>
                    </section>
                `,
                legacy_gallery: `
                    <section style="padding: 100px 20px; background: #1a1a1a;">
                        <div style="max-width: 1400px; margin: 0 auto;">
                            <h2 style="text-align: center; font-size: 3.5rem; margin-bottom: 60px; color: white; font-style: italic;">Portfolio Highlights</h2>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                                <div style="aspect-ratio: 4/5; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 500"><defs><linearGradient id="beach1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23ff7f50;stop-opacity:1" /><stop offset="100%" style="stop-color:%23ff4500;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23beach1)" width="400" height="500"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="16" opacity="0.8">Beach Portrait</text></svg>') center/cover; border-radius: 10px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.3s;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; padding: 20px; transform: translateY(100%); transition: transform 0.3s;">
                                        <h4 style="margin: 0 0 5px 0;">Beach Family Session</h4>
                                        <p style="margin: 0; opacity: 0.8; font-size: 0.9rem;">Myrtle Beach, SC</p>
                                    </div>
                                </div>
                                
                                <div style="aspect-ratio: 3/4; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 400"><defs><linearGradient id="wedding1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23ddd6c1;stop-opacity:1" /><stop offset="100%" style="stop-color:%238b4513;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23wedding1)" width="300" height="400"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="14" opacity="0.8">Wedding Portrait</text></svg>') center/cover; border-radius: 10px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.3s;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; padding: 20px; transform: translateY(100%); transition: transform 0.3s;">
                                        <h4 style="margin: 0 0 5px 0;">Charleston Wedding</h4>
                                        <p style="margin: 0; opacity: 0.8; font-size: 0.9rem;">Historic Downtown</p>
                                    </div>
                                </div>
                                
                                <div style="aspect-ratio: 1/1; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400"><defs><linearGradient id="sunset1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23ff6347;stop-opacity:1" /><stop offset="100%" style="stop-color:%23ff7f50;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23sunset1)" width="400" height="400"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="16" opacity="0.8">Sunset Session</text></svg>') center/cover; border-radius: 10px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.3s;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; padding: 20px; transform: translateY(100%); transition: transform 0.3s;">
                                        <h4 style="margin: 0 0 5px 0;">Senior Portrait</h4>
                                        <p style="margin: 0; opacity: 0.8; font-size: 0.9rem;">Golden Hour Magic</p>
                                    </div>
                                </div>
                                
                                <div style="aspect-ratio: 5/4; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 400"><defs><linearGradient id="family1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%234682b4;stop-opacity:1" /><stop offset="100%" style="stop-color:%23006994;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23family1)" width="500" height="400"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="16" opacity="0.8">Family Session</text></svg>') center/cover; border-radius: 10px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.3s;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; padding: 20px; transform: translateY(100%); transition: transform 0.3s;">
                                        <h4 style="margin: 0 0 5px 0;">Family Legacy</h4>
                                        <p style="margin: 0; opacity: 0.8; font-size: 0.9rem;">Generational Love</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 50px;">
                                <button style="background: #d4af37; color: #1a1a1a; border: none; padding: 18px 35px; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s; text-transform: uppercase;">See More Galleries</button>
                            </div>
                        </div>
                    </section>
                `,
                legacy_about: `
                    <section style="padding: 100px 20px; background: white;">
                        <div style="max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 80px; align-items: center;">
                            <div>
                                <h2 style="font-size: 3.5rem; margin-bottom: 30px; color: #1a1a1a; font-style: italic; line-height: 1.2;">My Goal For You.</h2>
                                <p style="color: #666; line-height: 1.8; margin-bottom: 25px; font-size: 1.2rem;">My goal for you is more than just taking pictures — it's to create something that moves you every single time you look back.</p>
                                <p style="color: #666; line-height: 1.8; margin-bottom: 25px; font-size: 1.1rem;">I want you to feel proud, radiant, and seen. I want your photos to transport you back to those moments — the laughter, the love, the light in your eyes — with all the depth and emotion still intact.</p>
                                <p style="color: #666; line-height: 1.8; margin-bottom: 35px; font-size: 1.1rem;">These aren't meant to be snapshots. My goal is to create art — bold, beautiful, and timeless — pieces that you'll hang on your walls, share with your family, and treasure for generations.</p>
                                <p style="color: #1a1a1a; font-weight: bold; font-size: 1.2rem; font-style: italic;">Because your story matters. And it deserves to be captured in a way that feels just as unforgettable as the moments themselves.</p>
                            </div>
                            <div style="background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 600"><defs><linearGradient id="portrait" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23ddd6c1;stop-opacity:1" /><stop offset="100%" style="stop-color:%23a0956b;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23portrait)" width="500" height="600"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="20" opacity="0.7">Photographer Portrait</text></svg>') center/cover; height: 500px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);"></div>
                        </div>
                    </section>
                `,
                legacy_contact: `
                    <section style="padding: 100px 20px; background: #f8f6f0;">
                        <div style="max-width: 1000px; margin: 0 auto; text-align: center;">
                            <h2 style="font-size: 3.5rem; margin-bottom: 30px; color: #1a1a1a; font-style: italic;">Ready to Create Your Legacy?</h2>
                            <p style="font-size: 1.3rem; color: #666; margin-bottom: 50px; line-height: 1.6;">Let's capture your story with the beauty and artistry it deserves. Contact me today to book your session.</p>
                            
                            <div style="background: white; padding: 60px 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 40px;">
                                <form style="display: grid; gap: 25px; max-width: 600px; margin: 0 auto;">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                                        <input type="text" placeholder="Your Name" style="padding: 18px 20px; border: 2px solid #e8e8e8; border-radius: 10px; font-size: 1.1rem; transition: border-color 0.3s;">
                                        <input type="email" placeholder="Your Email" style="padding: 18px 20px; border: 2px solid #e8e8e8; border-radius: 10px; font-size: 1.1rem; transition: border-color 0.3s;">
                                    </div>
                                    <input type="tel" placeholder="Phone Number" style="padding: 18px 20px; border: 2px solid #e8e8e8; border-radius: 10px; font-size: 1.1rem; transition: border-color 0.3s;">
                                    <select style="padding: 18px 20px; border: 2px solid #e8e8e8; border-radius: 10px; font-size: 1.1rem; transition: border-color 0.3s;">
                                        <option>Select Session Type</option>
                                        <option>Beach Family Portrait</option>
                                        <option>Wedding Photography</option>
                                        <option>Senior Portraits</option>
                                        <option>Engagement Session</option>
                                        <option>Other</option>
                                    </select>
                                    <textarea placeholder="Tell me about your vision and any specific requests..." rows="5" style="padding: 18px 20px; border: 2px solid #e8e8e8; border-radius: 10px; font-size: 1.1rem; resize: vertical; transition: border-color 0.3s;"></textarea>
                                    <button type="submit" style="background: #d4af37; color: #1a1a1a; border: none; padding: 20px 40px; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s; text-transform: uppercase;">Send Message</button>
                                </form>
                            </div>
                            
                            <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;">
                                <div style="text-align: center;">
                                    <h4 style="color: #1a1a1a; margin-bottom: 10px;">Call or Text</h4>
                                    <a href="tel:8434851315" style="color: #d4af37; font-size: 1.2rem; font-weight: bold; text-decoration: none;">843-485-1315</a>
                                </div>
                                <div style="text-align: center;">
                                    <h4 style="color: #1a1a1a; margin-bottom: 10px;">Quick Text</h4>
                                    <a href="sms:8434851315?&body=Hi! I'm interested in booking a photo session with Legacy Photography" style="background: #d4af37; color: #1a1a1a; padding: 12px 25px; border-radius: 6px; text-decoration: none; font-weight: bold; transition: all 0.3s;">📱 Text Now</a>
                                </div>
                            </div>
                        </div>
                    </section>
                `,
                legacy_footer: `
                    <footer style="background: #1a1a1a; color: white; padding: 60px 20px 40px;">
                        <div style="max-width: 1200px; margin: 0 auto;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; margin-bottom: 40px;">
                                <div>
                                    <h3 style="color: #d4af37; margin-bottom: 20px; font-size: 1.8rem;">Legacy Photography</h3>
                                    <p style="color: #ccc; line-height: 1.6; margin-bottom: 20px;">Premier photographer serving Myrtle Beach, Charleston, and the beautiful South Carolina coast. Creating timeless memories for families, couples, and individuals.</p>
                                    <div style="display: flex; gap: 15px;">
                                        <a href="#" style="color: #d4af37; font-size: 1.5rem; transition: color 0.3s;">📘</a>
                                        <a href="#" style="color: #d4af37; font-size: 1.5rem; transition: color 0.3s;">📷</a>
                                        <a href="#" style="color: #d4af37; font-size: 1.5rem; transition: color 0.3s;">📧</a>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 style="color: white; margin-bottom: 20px;">Services</h4>
                                    <div style="display: flex; flex-direction: column; gap: 8px;">
                                        <a href="#" style="color: #ccc; text-decoration: none; transition: color 0.3s;">Beach Photography</a>
                                        <a href="#" style="color: #ccc; text-decoration: none; transition: color 0.3s;">Wedding Photography</a>
                                        <a href="#" style="color: #ccc; text-decoration: none; transition: color 0.3s;">Family Portraits</a>
                                        <a href="#" style="color: #ccc; text-decoration: none; transition: color 0.3s;">Senior Portraits</a>
                                        <a href="#" style="color: #ccc; text-decoration: none; transition: color 0.3s;">Engagement Sessions</a>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 style="color: white; margin-bottom: 20px;">Contact Info</h4>
                                    <div style="display: flex; flex-direction: column; gap: 12px;">
                                        <div style="color: #ccc;">📍 Serving Myrtle Beach & Charleston, SC</div>
                                        <div style="color: #ccc;">📞 <a href="tel:8434851315" style="color: #d4af37; text-decoration: none;">843-485-1315</a></div>
                                        <div style="color: #ccc;">✉️ lance@thelegacyphotography.com</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="border-top: 1px solid #333; padding-top: 30px; text-align: center;">
                                <p style="color: #888; margin: 0;">© 2025 Legacy Photography. All rights reserved. | Your Life, Your Legacy, Perfectly Captured!</p>
                            </div>
                        </div>
                    </footer>
                `,
                
                // Modern Portfolio Templates
                modern_header: `
                    <header style="background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); color: #2d3748; padding: 20px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 20px rgba(0,0,0,0.1);">
                        <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px;">
                            <div style="font-size: 2rem; font-weight: 300; color: #667eea;">LEGACY</div>
                            <nav style="display: flex; gap: 40px;">
                                <a href="#" style="color: #2d3748; text-decoration: none; font-weight: 400; position: relative; transition: color 0.3s;">Work</a>
                                <a href="#" style="color: #2d3748; text-decoration: none; font-weight: 400; position: relative; transition: color 0.3s;">About</a>
                                <a href="#" style="color: #2d3748; text-decoration: none; font-weight: 400; position: relative; transition: color 0.3s;">Process</a>
                                <a href="#" style="color: #2d3748; text-decoration: none; font-weight: 400; position: relative; transition: color 0.3s;">Contact</a>
                            </nav>
                        </div>
                    </header>
                `,
                modern_hero: `
                    <section style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 90vh; display: flex; align-items: center; justify-content: center; color: white; text-align: center; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="1" fill="white" opacity="0.1"/><circle cx="80" cy="40" r="1" fill="white" opacity="0.1"/><circle cx="60" cy="80" r="1" fill="white" opacity="0.1"/></svg>'); animation: float 20s infinite linear;"></div>
                        <div style="max-width: 900px; z-index: 1; position: relative;">
                            <h1 style="font-size: 5rem; margin-bottom: 30px; font-weight: 100; letter-spacing: -2px; line-height: 1.1;">Modern Photography</h1>
                            <p style="font-size: 1.4rem; margin-bottom: 50px; opacity: 0.9; font-weight: 300; max-width: 600px; margin-left: auto; margin-right: auto;">Creating contemporary visual stories that capture authentic moments with a fresh, artistic perspective.</p>
                            <div style="display: flex; gap: 25px; justify-content: center; flex-wrap: wrap;">
                                <button style="background: white; color: #667eea; border: none; padding: 18px 40px; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; letter-spacing: 1px;">EXPLORE WORK</button>
                                <button style="background: transparent; color: white; border: 2px solid white; padding: 18px 40px; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; letter-spacing: 1px;">GET IN TOUCH</button>
                            </div>
                        </div>
                    </section>
                `,
                modern_portfolio: `
                    <section style="padding: 120px 20px; background: #f8fafc;">
                        <div style="max-width: 1400px; margin: 0 auto;">
                            <h2 style="text-align: center; font-size: 3rem; margin-bottom: 20px; color: #2d3748; font-weight: 300; letter-spacing: -1px;">Selected Work</h2>
                            <p style="text-align: center; font-size: 1.1rem; color: #666; margin-bottom: 80px; max-width: 600px; margin-left: auto; margin-right: auto;">A curated collection of contemporary photography showcasing diverse styles and creative vision.</p>
                            
                            <div style="display: grid; grid-template-columns: repeat(12, 1fr); gap: 20px; grid-auto-rows: 300px;">
                                <div style="grid-column: span 6; grid-row: span 2; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 600"><defs><linearGradient id="mod1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23667eea;stop-opacity:1" /><stop offset="100%" style="stop-color:%23764ba2;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23mod1)" width="600" height="600"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="18" opacity="0.7">Portfolio Image 1</text></svg>') center/cover; border-radius: 12px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.3s;">
                                    <div style="position: absolute; inset: 0; background: linear-gradient(45deg, rgba(102,126,234,0.8), rgba(118,75,162,0.8)); opacity: 0; transition: opacity 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; font-weight: 600;">Modern Portrait Series</div>
                                </div>
                                
                                <div style="grid-column: span 3; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><defs><linearGradient id="mod2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23ff6b6b;stop-opacity:1" /><stop offset="100%" style="stop-color:%23ee5a24;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23mod2)" width="300" height="300"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="14" opacity="0.7">Urban</text></svg>') center/cover; border-radius: 12px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.3s;">
                                    <div style="position: absolute; inset: 0; background: rgba(255,107,107,0.8); opacity: 0; transition: opacity 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">Urban Sessions</div>
                                </div>
                                
                                <div style="grid-column: span 3; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><defs><linearGradient id="mod3" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%2355a3ff;stop-opacity:1" /><stop offset="100%" style="stop-color:%232d3561;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23mod3)" width="300" height="300"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="14" opacity="0.7">Creative</text></svg>') center/cover; border-radius: 12px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.3s;">
                                    <div style="position: absolute; inset: 0; background: rgba(85,163,255,0.8); opacity: 0; transition: opacity 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">Creative Work</div>
                                </div>
                                
                                <div style="grid-column: span 4; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"><defs><linearGradient id="mod4" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%2300d2d3;stop-opacity:1" /><stop offset="100%" style="stop-color:%2300a085;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23mod4)" width="400" height="300"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="16" opacity="0.7">Nature</text></svg>') center/cover; border-radius: 12px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.3s;">
                                    <div style="position: absolute; inset: 0; background: rgba(0,210,211,0.8); opacity: 0; transition: opacity 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">Natural Light</div>
                                </div>
                                
                                <div style="grid-column: span 2; background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 300"><defs><linearGradient id="mod5" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23a55eea;stop-opacity:1" /><stop offset="100%" style="stop-color:%238854d0;stop-opacity:1" /></linearGradient></defs><rect fill="url(%23mod5)" width="200" height="300"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="12" opacity="0.7">Art</text></svg>') center/cover; border-radius: 12px; position: relative; overflow: hidden; cursor: pointer; transition: transform 0.3s;">
                                    <div style="position: absolute; inset: 0; background: rgba(165,94,234,0.8); opacity: 0; transition: opacity 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">Artistic</div>
                                </div>
                            </div>
                        </div>
                    </section>
                `,
                
                // Elegant Gallery Templates
                elegant_header: `
                    <header style="background: #2c1810; color: #ddd6c1; padding: 25px 0; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #8b4513;">
                        <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px;">
                            <div style="font-size: 2.2rem; font-weight: 400; font-family: serif; color: #ddd6c1;">𝒢𝒶𝓁𝓁𝑒𝓇𝓎 𝐿𝑒𝑔𝒶𝒸𝓎</div>
                            <nav style="display: flex; gap: 35px;">
                                <a href="#" style="color: #ddd6c1; text-decoration: none; font-weight: 400; font-size: 1.1rem; transition: color 0.3s;">Collections</a>
                                <a href="#" style="color: #ddd6c1; text-decoration: none; font-weight: 400; font-size: 1.1rem; transition: color 0.3s;">Artist</a>
                                <a href="#" style="color: #ddd6c1; text-decoration: none; font-weight: 400; font-size: 1.1rem; transition: color 0.3s;">Gallery</a>
                                <a href="#" style="color: #ddd6c1; text-decoration: none; font-weight: 400; font-size: 1.1rem; transition: color 0.3s;">Inquire</a>
                            </nav>
                        </div>
                    </header>
                `,
                elegant_hero: `
                    <section style="background: linear-gradient(rgba(44,24,16,0.7), rgba(139,69,19,0.7)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><pattern id="texture" patternUnits="userSpaceOnUse" width="40" height="40"><rect width="40" height="40" fill="%23ddd6c1" opacity="0.1"/><circle cx="20" cy="20" r="15" fill="none" stroke="%23ddd6c1" stroke-width="0.5" opacity="0.2"/></pattern></defs><rect fill="url(%23texture)" width="1200" height="800"/><text x="50%" y="45%" text-anchor="middle" fill="%23ddd6c1" font-size="36" opacity="0.3">Elegant Gallery Space</text></svg>') center/cover; height: 85vh; display: flex; align-items: center; justify-content: center; color: #ddd6c1; text-align: center; position: relative;">
                        <div style="max-width: 900px; padding: 80px 60px; background: rgba(44,24,16,0.8); border: 2px solid #ddd6c1; border-radius: 5px; backdrop-filter: blur(5px);">
                            <h1 style="font-size: 4.5rem; margin-bottom: 25px; font-family: serif; font-weight: 300; letter-spacing: 2px; line-height: 1.2;">Timeless Elegance</h1>
                            <div style="width: 100px; height: 2px; background: #ddd6c1; margin: 30px auto;"></div>
                            <p style="font-size: 1.3rem; margin-bottom: 45px; line-height: 1.7; font-style: italic; opacity: 0.9;">Fine art photography capturing the essence of beauty, grace, and sophistication in every frame.</p>
                            <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                                <button style="background: transparent; color: #ddd6c1; border: 2px solid #ddd6c1; padding: 15px 35px; border-radius: 0; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s; letter-spacing: 1px; text-transform: uppercase;">View Collections</button>
                                <button style="background: #ddd6c1; color: #2c1810; border: none; padding: 15px 35px; border-radius: 0; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s; letter-spacing: 1px; text-transform: uppercase;">Commission Work</button>
                            </div>
                        </div>
                    </section>
                `
            };

            // Merge with existing templates
            const allTemplates = { ...componentTemplates, ...legacyTemplates };
            
            return allTemplates[componentType] || '<div>Component not found</div>';
        }

        function selectComponent(componentWrapper) {
            // Remove selection from other components
            document.querySelectorAll('.component-wrapper').forEach(wrapper => {
                wrapper.style.outline = 'none';
                wrapper.classList.remove('selected');
            });
            
            // Select current component
            componentWrapper.style.outline = '2px solid #667eea';
            componentWrapper.classList.add('selected');
            selectedComponent = componentWrapper;
            
            // Update properties panel
            updatePropertiesPanel(componentWrapper);
            
            // Scroll properties panel into view on mobile
            if (window.innerWidth <= 768) {
                const propertiesPanel = document.getElementById('propertiesContent');
                if (propertiesPanel) {
                    propertiesPanel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        function updatePropertiesPanel(componentWrapper) {
            const componentType = componentWrapper.dataset.componentType;
            const propertiesContent = document.getElementById('propertiesContent');
            
            // Get current styles from the component
            const currentBgColor = getComputedStyle(componentWrapper).backgroundColor || '#ffffff';
            const currentTextColor = getComputedStyle(componentWrapper).color || '#2d3748';
            
            propertiesContent.innerHTML = `
                <div class="property-section">
                    <h4>${componentType.charAt(0).toUpperCase() + componentType.slice(1)} Properties</h4>
                    
                    <div class="property-group">
                        <label>Background Color:</label>
                        <input type="color" value="#ffffff" onchange="updateComponentStyle('backgroundColor', this.value)">
                        <small style="color: #666; font-size: 0.8rem;">Changes the background color</small>
                    </div>
                    
                    <div class="property-group">
                        <label>Text Color:</label>
                        <input type="color" value="#2d3748" onchange="updateComponentStyle('color', this.value)">
                        <small style="color: #666; font-size: 0.8rem;">Changes the text color</small>
                    </div>
                    
                    <div class="property-group">
                        <label>Padding: <span id="paddingValue">20px</span></label>
                        <input type="range" min="0" max="100" value="20" onchange="updateComponentStyle('padding', this.value + 'px'); document.getElementById('paddingValue').textContent = this.value + 'px'">
                        <small style="color: #666; font-size: 0.8rem;">Adjusts inner spacing</small>
                    </div>
                    
                    <div class="property-group">
                        <label>Border Radius: <span id="radiusValue">0px</span></label>
                        <input type="range" min="0" max="50" value="0" onchange="updateComponentStyle('borderRadius', this.value + 'px'); document.getElementById('radiusValue').textContent = this.value + 'px'">
                        <small style="color: #666; font-size: 0.8rem;">Rounds the corners</small>
                    </div>
                    
                    <div class="property-group">
                        <label>Margin: <span id="marginValue">0px</span></label>
                        <input type="range" min="0" max="50" value="0" onchange="updateComponentStyle('margin', this.value + 'px'); document.getElementById('marginValue').textContent = this.value + 'px'">
                        <small style="color: #666; font-size: 0.8rem;">Adjusts outer spacing</small>
                    </div>
                    
                    <div class="property-actions">
                        <button class="btn btn-primary" onclick="duplicateSelectedComponent()" style="margin-bottom: 10px; width: 100%;">
                            📋 Duplicate Component
                        </button>
                        <button class="btn btn-danger" onclick="deleteSelectedComponent()" style="width: 100%;">
                            🗑️ Delete Component
                        </button>
                    </div>
                </div>
            `;
        }

        function updateComponentStyle(property, value) {
            if (selectedComponent) {
                selectedComponent.style[property] = value;
            }
        }

        function deleteSelectedComponent() {
            if (selectedComponent && confirm('Delete this component?')) {
                selectedComponent.remove();
                selectedComponent = null;
                document.getElementById('propertiesContent').innerHTML = '<div class="no-selection"><p>Select a component to edit its properties</p></div>';
                showMessage('Component deleted', 'success');
            }
        }

        function duplicateSelectedComponent() {
            if (!selectedComponent) {
                showMessage('No component selected', 'error');
                return;
            }
            
            const clone = selectedComponent.cloneNode(true);
            const dropZone = document.getElementById('dropZone');
            
            // Insert the clone after the selected component
            selectedComponent.parentNode.insertBefore(clone, selectedComponent.nextSibling);
            
            // Add click handler to the clone
            clone.addEventListener('click', () => selectComponent(clone));
            
            showMessage('Component duplicated', 'success');
        }

        // Add mobile-friendly touch events
        function addMobileSupport() {
            let touchStartY = 0;
            let touchEndY = 0;
            
            // Add touch support for component selection
            document.addEventListener('touchstart', function(e) {
                touchStartY = e.changedTouches[0].screenY;
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                touchEndY = e.changedTouches[0].screenY;
                
                // If it's a tap (not a scroll), handle component selection
                if (Math.abs(touchEndY - touchStartY) < 10) {
                    const target = e.target.closest('.component-wrapper');
                    if (target) {
                        selectComponent(target);
                        e.preventDefault();
                    }
                }
            }, { passive: false });
            
            // Prevent default drag behavior on mobile
            document.addEventListener('touchmove', function(e) {
                if (e.target.closest('.component-item')) {
                    e.preventDefault();
                }
            }, { passive: false });
        }

        // Initialize mobile support when website builder loads
        document.addEventListener('DOMContentLoaded', function() {
            addMobileSupport();
        });

        // Template loading functionality
        function loadTemplate(templateType) {
            const templates = {
                portfolio: ['header', 'hero', 'gallery', 'about', 'services', 'contact', 'footer'],
                wedding: ['header', 'hero', 'gallery', 'services', 'testimonials', 'contact', 'footer'],
                studio: ['header', 'hero', 'about', 'services', 'gallery', 'pricing', 'contact', 'footer'],
                legacy: ['legacy_header', 'legacy_hero', 'legacy_services', 'legacy_gallery', 'legacy_about', 'legacy_contact', 'legacy_footer'],
                modern: ['modern_header', 'modern_hero', 'modern_portfolio', 'modern_services', 'modern_testimonials', 'modern_contact', 'modern_footer'],
                elegant: ['elegant_header', 'elegant_hero', 'elegant_gallery', 'elegant_story', 'elegant_services', 'elegant_contact', 'elegant_footer']
            };
            
            const templateComponents = templates[templateType];
            if (!templateComponents) return;
            
            // Show loading animation
            showTemplateLoading();
            
            // Clear existing components
            const dropZone = document.getElementById('dropZone');
            dropZone.innerHTML = '';
            dropZone.style.border = 'none';
            dropZone.style.minHeight = 'auto';
            dropZone.style.display = 'block';
            
            // Add template components with staggered timing
            templateComponents.forEach((componentType, index) => {
                setTimeout(() => {
                    addComponentToCanvas(componentType);
                    if (index === templateComponents.length - 1) {
                        hideTemplateLoading();
                    }
                }, 300 * (index + 1));
            });
            
            showMessage(`${templateType.charAt(0).toUpperCase() + templateType.slice(1)} template loaded!`, 'success');
            celebrateMilestone('photos_uploaded', `${templateType} template`);
        }

        function showTemplateLoading() {
            const loader = document.createElement('div');
            loader.id = 'templateLoader';
            loader.className = 'template-loading';
            loader.innerHTML = `
                <h3>Loading Template...</h3>
                <div class="loading-spinner"></div>
                <p>Building your professional website</p>
            `;
            document.body.appendChild(loader);
        }

        function hideTemplateLoading() {
            const loader = document.getElementById('templateLoader');
            if (loader) {
                loader.remove();
            }
        }
    </script>

        </div> <!-- End Client Management Tab -->

        <!-- Website Builder Tab Content -->
        <div id="websitesTab" class="tab-content">
            <div class="website-builder-container">
                <div class="builder-header">
                    <h2>🌐 Professional Website Builder</h2>
                    <p>Create stunning photography websites with drag-and-drop simplicity</p>
                </div>

                <!-- Website Management Toolbar -->
                <div class="website-toolbar">
                    <button class="btn btn-primary" onclick="createNewWebsite()">
                        ➕ New Website
                    </button>
                    <button class="btn btn-secondary" onclick="loadWebsites()">
                        📁 My Websites
                    </button>
                    <button class="btn btn-success" onclick="previewWebsite()" id="previewBtn" disabled>
                        👁️ Preview
                    </button>
                    <button class="btn btn-warning" onclick="publishWebsite()" id="publishBtn" disabled>
                        🚀 Publish
                    </button>
                </div>

                <!-- Website Builder Interface -->
                <div class="builder-interface" id="builderInterface" style="display: none;">
                    
                    <!-- Left Sidebar - Components -->
                    <div class="builder-sidebar">
                        <h3>📦 Components</h3>
                        <div class="component-categories">
                            
                            <!-- Layout Components -->
                            <div class="component-category">
                                <h4>🏗️ Layout</h4>
                                <div class="component-list">
                                    <div class="component-item" draggable="true" data-component="header">
                                        <div class="component-icon">📄</div>
                                        <span>Header</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="hero">
                                        <div class="component-icon">🎭</div>
                                        <span>Hero Section</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="gallery">
                                        <div class="component-icon">🖼️</div>
                                        <span>Photo Gallery</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="about">
                                        <div class="component-icon">👤</div>
                                        <span>About Section</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="services">
                                        <div class="component-icon">⚡</div>
                                        <span>Services</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="contact">
                                        <div class="component-icon">📧</div>
                                        <span>Contact Form</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="testimonials">
                                        <div class="component-icon">⭐</div>
                                        <span>Testimonials</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="pricing">
                                        <div class="component-icon">💰</div>
                                        <span>Pricing</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="footer">
                                        <div class="component-icon">📝</div>
                                        <span>Footer</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Content Components -->
                            <div class="component-category">
                                <h4>📝 Content</h4>
                                <div class="component-list">
                                    <div class="component-item" draggable="true" data-component="text">
                                        <div class="component-icon">📄</div>
                                        <span>Text Block</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="image">
                                        <div class="component-icon">🖼️</div>
                                        <span>Image</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="button">
                                        <div class="component-icon">🔘</div>
                                        <span>Button</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="divider">
                                        <div class="component-icon">➖</div>
                                        <span>Divider</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="spacer">
                                        <div class="component-icon">📏</div>
                                        <span>Spacer</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Media Components -->
                            <div class="component-category">
                                <h4>🎬 Media</h4>
                                <div class="component-list">
                                    <div class="component-item" draggable="true" data-component="video">
                                        <div class="component-icon">🎥</div>
                                        <span>Video</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="slideshow">
                                        <div class="component-icon">🎠</div>
                                        <span>Slideshow</span>
                                    </div>
                                    <div class="component-item" draggable="true" data-component="instagram">
                                        <div class="component-icon">📷</div>
                                        <span>Instagram Feed</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Center Canvas - Website Preview -->
                    <div class="builder-canvas">
                        <div class="canvas-header">
                            <h3 id="websiteName">My Photography Website</h3>
                            <div class="canvas-controls">
                                <button class="canvas-control" onclick="toggleDevice('desktop')" id="desktopView">
                                    🖥️ Desktop
                                </button>
                                <button class="canvas-control" onclick="toggleDevice('tablet')" id="tabletView">
                                    📱 Tablet
                                </button>
                                <button class="canvas-control" onclick="toggleDevice('mobile')" id="mobileView">
                                    📱 Mobile
                                </button>
                            </div>
                        </div>
                        
                        <div class="canvas-viewport" id="canvasViewport">
                            <div class="website-canvas" id="websiteCanvas">
                                <div class="drop-zone" id="dropZone">
                                    <div class="drop-zone-message">
                                        <h3>🎨 Start Building Your Website</h3>
                                        <p>Drag components from the left sidebar to start building your photography website</p>
                                        <div class="quick-start-templates">
                                            <button class="template-btn legacy-style" onclick="loadTemplate('legacy')">
                                                ✨ Legacy Style Template
                                            </button>
                                            <button class="template-btn modern-style" onclick="loadTemplate('modern')">
                                                🎯 Modern Portfolio Template
                                            </button>
                                            <button class="template-btn elegant-style" onclick="loadTemplate('elegant')">
                                                💎 Elegant Gallery Template
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Sidebar - Properties -->
                    <div class="builder-properties">
                        <h3>⚙️ Properties</h3>
                        <div class="properties-content" id="propertiesContent">
                            <div class="no-selection">
                                <p>Select a component to edit its properties</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Website List -->
                <div class="website-list" id="websiteList" style="display: none;">
                    <div class="websites-grid" id="websitesGrid">
                        <!-- Websites will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

    <!-- Contract Selection Modal -->
    <div id="contractModal" class="payment-plan-modal">
        <div class="payment-plan-content">
            <h3>📝 Send Contract</h3>
            
            <div class="contract-selection">
                <h4>Select Contract Type:</h4>
                
                <div class="contract-options">
                    <div class="contract-option" onclick="createContract(currentContractSessionId, 'photo_release')">
                        <div class="contract-icon">📷</div>
                        <div class="contract-info">
                            <h5>Photo Print Release</h5>
                            <p>Grants clients permission to print and share photos for personal use</p>
                        </div>
                    </div>
                    
                    <div class="contract-option" onclick="createContract(currentContractSessionId, 'wedding_contract')">
                        <div class="contract-icon">💒</div>
                        <div class="contract-info">
                            <h5>Wedding Photography Contract</h5>
                            <p>Comprehensive contract for wedding photography services</p>
                        </div>
                    </div>
                    
                    <div class="contract-option" onclick="createContract(currentContractSessionId, 'general_contract')">
                        <div class="contract-icon">📸</div>
                        <div class="contract-info">
                            <h5>General Photography Contract</h5>
                            <p>Standard contract for portrait sessions and general photography services</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="existing-contracts" id="existingContracts">
                <!-- Existing contracts will be loaded here -->
            </div>
            
            <div class="payment-actions">
                <button class="btn btn-secondary" onclick="closeContractModal()">Cancel</button>
            </div>
        </div>
    </div>

</body>
</html>