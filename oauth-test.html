<!DOCTYPE html>
<html>
<head>
    <title>Google OAuth Test - photomanagementsystem.com</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>
    <h2>Google OAuth Configuration Test</h2>
    <p>Domain: photomanagementsystem.com</p>
    <button id="testGoogle">Test Google Sign-in</button>
    <div id="result"></div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDbtboh1bW6xu9Tz9FILkx_0lzGwXQHjyM",
            authDomain: "photoshcheduleapp.firebaseapp.com",
            projectId: "photoshcheduleapp",
            storageBucket: "photoshcheduleapp.appspot.com",
            messagingSenderId: "1080892259604",
            appId: "1:1080892259604:web:8198de9d7da81c684c1601"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        document.getElementById('testGoogle').addEventListener('click', async () => {
            const result = document.getElementById('result');
            result.innerHTML = 'Testing Google OAuth...';
            
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                
                const authResult = await auth.signInWithPopup(provider);
                result.innerHTML = `✅ Success! Google OAuth is working.<br>User: ${authResult.user.email}`;
                result.style.color = 'green';
                
                // Sign out immediately for testing
                setTimeout(() => auth.signOut(), 2000);
                
            } catch (error) {
                if (error.code === 'auth/unauthorized-domain') {
                    result.innerHTML = '⏳ Still updating... Google API needs more time to propagate domain authorization.';
                    result.style.color = 'orange';
                } else if (error.code === 'auth/popup-blocked') {
                    result.innerHTML = '🔄 Popup blocked. Trying redirect method...';
                    result.style.color = 'blue';
                    
                    try {
                        await auth.signInWithRedirect(provider);
                    } catch (redirectError) {
                        result.innerHTML = `❌ Redirect failed: ${redirectError.message}`;
                        result.style.color = 'red';
                    }
                } else {
                    result.innerHTML = `❌ Error: ${error.code} - ${error.message}`;
                    result.style.color = 'red';
                }
            }
        });

        // Handle redirect result
        auth.getRedirectResult().then((result) => {
            if (result.user) {
                document.getElementById('result').innerHTML = `✅ Redirect Success! User: ${result.user.email}`;
                document.getElementById('result').style.color = 'green';
                setTimeout(() => auth.signOut(), 2000);
            }
        });
    </script>
</body>
</html>