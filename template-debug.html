
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Debug - Photography Scheduler</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .summary {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .template-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #f9f9f9;
        }
        .template-card.valid {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        .template-card.invalid {
            border-color: #f44336;
            background: #ffebee;
        }
        .page-info {
            margin: 10px 0;
            padding: 10px;
            background: #ffffff;
            border-radius: 4px;
            border-left: 4px solid #2196f3;
        }
        .page-info.empty {
            border-left-color: #ff9800;
        }
        .page-info.error {
            border-left-color: #f44336;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2196f3;
        }
        .refresh-btn, .test-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .refresh-btn:hover, .test-btn:hover {
            background: #1976d2;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>📊 Template System Debug</h1>
        
        <div class="summary" id="summary">
            Loading template system...
        </div>
        
        <div class="stats" id="stats">
            <!-- Stats will be populated by JavaScript -->
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button class="refresh-btn" onclick="debugAllTemplates()">🔄 Refresh Debug</button>
            <button class="test-btn" onclick="runTemplateTests()">🧪 Run Tests</button>
            <button class="test-btn" onclick="validateAllPages()">✅ Validate Pages</button>
        </div>
        
        <div class="test-results" id="test-results" style="display: none;">
            <!-- Test results will appear here -->
        </div>
        
        <h2>📋 Template Details</h2>
        <div id="template-debug-results">
            <!-- Debug results will be populated here -->
        </div>
    </div>

    <!-- Load template components -->
    <script type="text/babel" src="components/PresetTemplates.jsx"></script>
    
    <script>
        // Wait for templates to load
        setTimeout(() => {
            debugAllTemplates();
        }, 1000);
        
        function debugAllTemplates() {
            const templates = window.PresetTemplates || {};
            const templateKeys = Object.keys(templates);
            
            if (templateKeys.length === 0) {
                document.getElementById('summary').innerHTML = '❌ No templates found! Check if components/PresetTemplates.jsx is loading properly.';
                return;
            }
            
            let totalPages = 0;
            let validPages = 0;
            let invalidPages = 0;
            let totalBlocks = 0;
            let validTemplates = 0;
            let invalidTemplates = 0;
            
            const resultsContainer = document.getElementById('template-debug-results');
            resultsContainer.innerHTML = '';
            
            templateKeys.forEach(templateKey => {
                const template = templates[templateKey];
                const isValidTemplate = validateTemplate(template);
                
                if (isValidTemplate) {
                    validTemplates++;
                } else {
                    invalidTemplates++;
                }
                
                const templateCard = createTemplateDebugCard(template, templateKey, isValidTemplate);
                resultsContainer.appendChild(templateCard);
                
                // Count pages and blocks
                const pages = Object.keys(template.pages || {});
                totalPages += pages.length;
                
                pages.forEach(pageId => {
                    const pageContent = template.pages[pageId];
                    if (validatePageContent(pageContent, pageId)) {
                        validPages++;
                        if (Array.isArray(pageContent)) {
                            totalBlocks += pageContent.length;
                        }
                    } else {
                        invalidPages++;
                    }
                });
            });
            
            // Update summary
            const summaryHtml = `
                <h3>🎯 Template System Status</h3>
                <p><strong>Total Templates:</strong> ${templateKeys.length}</p>
                <p><strong>✅ Valid Templates:</strong> ${validTemplates}</p>
                <p><strong>❌ Invalid Templates:</strong> ${invalidTemplates}</p>
                <p><strong>📄 Total Pages:</strong> ${totalPages}</p>
                <p><strong>🧱 Total Blocks:</strong> ${totalBlocks}</p>
                <p><strong>System Status:</strong> ${invalidTemplates === 0 ? '🟢 All Good!' : '🟡 Issues Found'}</p>
            `;
            document.getElementById('summary').innerHTML = summaryHtml;
            
            // Update stats
            updateStats({
                templates: templateKeys.length,
                validTemplates,
                invalidTemplates,
                pages: totalPages,
                blocks: totalBlocks,
                validPages,
                invalidPages
            });
        }
        
        function validateTemplate(template) {
            if (!template) return false;
            if (!template.name) return false;
            if (!template.category) return false;
            if (!template.pages || typeof template.pages !== 'object') return false;
            if (Object.keys(template.pages).length === 0) return false;
            
            // Check if at least one page has valid content
            const pages = Object.keys(template.pages);
            return pages.some(pageId => validatePageContent(template.pages[pageId], pageId));
        }
        
        function validatePageContent(pageContent, pageId) {
            if (!Array.isArray(pageContent)) {
                console.warn(`Page ${pageId} content is not an array:`, pageContent);
                return false;
            }
            if (pageContent.length === 0) {
                console.warn(`Page ${pageId} has no content blocks`);
                return false;
            }
            
            // Validate each block
            return pageContent.every(block => {
                if (!block || typeof block !== 'object') return false;
                if (!block.type) return false;
                if (block.content === undefined || block.content === null) return false;
                return true;
            });
        }
        
        function createTemplateDebugCard(template, templateKey, isValid) {
            const card = document.createElement('div');
            card.className = `template-card ${isValid ? 'valid' : 'invalid'}`;
            
            const pages = Object.keys(template.pages || {});
            let pageInfoHtml = '';
            
            pages.forEach(pageId => {
                const pageContent = template.pages[pageId];
                const isValidPage = validatePageContent(pageContent, pageId);
                const blockCount = Array.isArray(pageContent) ? pageContent.length : 0;
                
                pageInfoHtml += `
                    <div class="page-info ${isValidPage ? '' : 'error'}">
                        <strong>${pageId}:</strong> 
                        ${isValidPage ? '✅' : '❌'} 
                        ${blockCount} blocks
                        ${!isValidPage ? ' (Invalid structure)' : ''}
                    </div>
                `;
            });
            
            card.innerHTML = `
                <h3>${isValid ? '✅' : '❌'} ${template.name || templateKey}</h3>
                <p><strong>Key:</strong> ${templateKey}</p>
                <p><strong>Category:</strong> ${template.category || 'None'}</p>
                <p><strong>Description:</strong> ${template.description || 'No description'}</p>
                <p><strong>Pages:</strong> ${pages.length}</p>
                <div style="margin-top: 10px;">
                    ${pageInfoHtml}
                </div>
                ${!isValid ? '<p style="color: red;"><strong>Issues:</strong> This template has structural problems and may not load correctly.</p>' : ''}
            `;
            
            return card;
        }
        
        function updateStats(stats) {
            const statsContainer = document.getElementById('stats');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.templates}</div>
                    <div>Total Templates</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.validTemplates}</div>
                    <div>Valid Templates</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.pages}</div>
                    <div>Total Pages</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.blocks}</div>
                    <div>Total Blocks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round((stats.validTemplates / stats.templates) * 100)}%</div>
                    <div>Template Health</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round((stats.validPages / stats.pages) * 100)}%</div>
                    <div>Page Health</div>
                </div>
            `;
        }
        
        function runTemplateTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<h3>🧪 Running Template Tests...</h3>';
            
            const templates = window.PresetTemplates || {};
            let testResults = [];
            
            // Test 1: Template loading
            testResults.push({
                name: 'Template Loading',
                passed: Object.keys(templates).length > 0,
                details: `Found ${Object.keys(templates).length} templates`
            });
            
            // Test 2: Template structure validation
            let structureValid = 0;
            Object.keys(templates).forEach(key => {
                if (validateTemplate(templates[key])) structureValid++;
            });
            testResults.push({
                name: 'Template Structure',
                passed: structureValid === Object.keys(templates).length,
                details: `${structureValid}/${Object.keys(templates).length} templates have valid structure`
            });
            
            // Test 3: Page content validation  
            let validPageCount = 0;
            let totalPageCount = 0;
            Object.keys(templates).forEach(key => {
                const pages = Object.keys(templates[key].pages || {});
                totalPageCount += pages.length;
                pages.forEach(pageId => {
                    if (validatePageContent(templates[key].pages[pageId], pageId)) {
                        validPageCount++;
                    }
                });
            });
            testResults.push({
                name: 'Page Content',
                passed: validPageCount === totalPageCount,
                details: `${validPageCount}/${totalPageCount} pages have valid content`
            });
            
            // Display results
            let resultsHtml = '<h3>🧪 Test Results</h3>';
            testResults.forEach(test => {
                resultsHtml += `
                    <div style="padding: 10px; margin: 5px 0; border-radius: 5px; background: ${test.passed ? '#e8f5e8' : '#ffeaea'};">
                        ${test.passed ? '✅' : '❌'} <strong>${test.name}:</strong> ${test.details}
                    </div>
                `;
            });
            
            const passedTests = testResults.filter(t => t.passed).length;
            resultsHtml += `<p><strong>Overall:</strong> ${passedTests}/${testResults.length} tests passed</p>`;
            
            resultsDiv.innerHTML = resultsHtml;
        }
        
        function validateAllPages() {
            const templates = window.PresetTemplates || {};
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<h3>✅ Page Validation Results</h3>';
            
            let validationResults = [];
            
            Object.keys(templates).forEach(templateKey => {
                const template = templates[templateKey];
                const pages = Object.keys(template.pages || {});
                
                pages.forEach(pageId => {
                    const pageContent = template.pages[pageId];
                    const isValid = validatePageContent(pageContent, pageId);
                    const blockCount = Array.isArray(pageContent) ? pageContent.length : 0;
                    
                    validationResults.push({
                        template: template.name || templateKey,
                        page: pageId,
                        valid: isValid,
                        blocks: blockCount,
                        issues: !isValid ? getValidationIssues(pageContent) : []
                    });
                });
            });
            
            let validationHtml = '';
            validationResults.forEach(result => {
                validationHtml += `
                    <div style="padding: 10px; margin: 5px 0; border-radius: 5px; background: ${result.valid ? '#e8f5e8' : '#ffeaea'};">
                        ${result.valid ? '✅' : '❌'} 
                        <strong>${result.template}</strong> → ${result.page} (${result.blocks} blocks)
                        ${result.issues.length > 0 ? `<br><small>Issues: ${result.issues.join(', ')}</small>` : ''}
                    </div>
                `;
            });
            
            const validPages = validationResults.filter(r => r.valid).length;
            validationHtml = `<p><strong>Summary:</strong> ${validPages}/${validationResults.length} pages are valid</p>` + validationHtml;
            
            resultsDiv.innerHTML = '<h3>✅ Page Validation Results</h3>' + validationHtml;
        }
        
        function getValidationIssues(pageContent) {
            const issues = [];
            
            if (!Array.isArray(pageContent)) {
                issues.push('Content is not an array');
                return issues;
            }
            
            if (pageContent.length === 0) {
                issues.push('No content blocks');
                return issues;
            }
            
            pageContent.forEach((block, index) => {
                if (!block || typeof block !== 'object') {
                    issues.push(`Block ${index} is not an object`);
                } else {
                    if (!block.type) issues.push(`Block ${index} missing type`);
                    if (block.content === undefined) issues.push(`Block ${index} missing content`);
                    if (!block.id) issues.push(`Block ${index} missing ID`);
                }
            });
            
            return issues;
        }
        
        // Auto-refresh every 30 seconds to catch dynamic changes
        setInterval(() => {
            debugAllTemplates();
        }, 30000);
    </script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>
