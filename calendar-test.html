<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Integration Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-button { background: #d4af37; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-button:hover { background: #b8941f; }
        .result { margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 3px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ“… Calendar Integration Test Suite</h1>
        
        <div class="test-section">
            <h3>Device Detection Test</h3>
            <div id="deviceInfo" class="result"></div>
            <button class="test-button" onclick="testDeviceDetection()">Test Device Detection</button>
        </div>
        
        <div class="test-section">
            <h3>Calendar URL Generation Test</h3>
            <div id="urlTest" class="result"></div>
            <button class="test-button" onclick="testCalendarUrls()">Test Calendar URLs</button>
        </div>
        
        <div class="test-section">
            <h3>Live Calendar Integration Test</h3>
            <div id="liveTest" class="result"></div>
            <button class="test-button" onclick="testLiveCalendar()">Test with Real Session</button>
        </div>
        
        <div class="test-section">
            <h3>Cross-Platform Test</h3>
            <div id="platformTest" class="result"></div>
            <button class="test-button" onclick="testMultiplePlatforms()">Simulate Different Devices</button>
        </div>
    </div>

    <script>
        function testDeviceDetection() {
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isMac = /Macintosh|MacIntel|MacPPC|Mac68K/i.test(navigator.userAgent);
            const isAndroid = /Android/i.test(navigator.userAgent);
            const isWindows = /Windows|Win32|Win64|WOW64/i.test(navigator.userAgent);
            
            document.getElementById('deviceInfo').innerHTML = `
                <div class="info">
                    <strong>Current Device Detection:</strong><br>
                    iOS: ${isIOS}<br>
                    Mac: ${isMac}<br>
                    Android: ${isAndroid}<br>
                    Windows: ${isWindows}<br>
                    User Agent: ${navigator.userAgent}
                </div>
            `;
        }
        
        function testCalendarUrls() {
            const testSession = {
                id: '12345',
                sessionType: 'Wedding Photography',
                clientName: 'Test Client',
                location: 'Central Park',
                phoneNumber: '555-0123',
                email: 'test@example.com',
                price: 500,
                duration: 120,
                dateTime: '2025-08-15T14:00:00'
            };
            
            const startDate = new Date(testSession.dateTime);
            const formatICSDate = (date) => date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            
            const serverUrl = `/api/sessions/${testSession.id}/calendar.ics`;
            const googleUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(testSession.sessionType + ' - ' + testSession.clientName)}&dates=${formatICSDate(startDate)}/${formatICSDate(new Date(startDate.getTime() + testSession.duration * 60000))}`;
            
            document.getElementById('urlTest').innerHTML = `
                <div class="success">
                    <strong>URL Generation Test:</strong><br>
                    Server URL: <a href="${serverUrl}" target="_blank">${serverUrl}</a><br>
                    Google Calendar: <a href="${googleUrl}" target="_blank">Open in Google Calendar</a><br>
                    âœ… URLs generated successfully
                </div>
            `;
        }
        
        function testLiveCalendar() {
            // Test with actual session from server
            fetch('/api/sessions')
                .then(response => response.json())
                .then(data => {
                    if (data.sessions && data.sessions.length > 0) {
                        const session = data.sessions[0];
                        const calendarUrl = `/api/sessions/${session.id}/calendar.ics`;
                        
                        document.getElementById('liveTest').innerHTML = `
                            <div class="success">
                                <strong>Live Session Test:</strong><br>
                                Session: ${session.clientName} - ${session.sessionType}<br>
                                Calendar URL: <a href="${calendarUrl}" target="_blank">${calendarUrl}</a><br>
                                <button class="test-button" onclick="window.open('${calendarUrl}', '_blank')">Open Calendar File</button>
                                âœ… Live calendar integration ready
                            </div>
                        `;
                    } else {
                        document.getElementById('liveTest').innerHTML = `
                            <div class="info">No sessions found for testing</div>
                        `;
                    }
                })
                .catch(error => {
                    document.getElementById('liveTest').innerHTML = `
                        <div style="background: #f8d7da; border-left: 4px solid #dc3545; padding: 10px;">
                            Error: ${error.message}
                        </div>
                    `;
                });
        }
        
        function testMultiplePlatforms() {
            const platforms = [
                { name: 'iPhone', agent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X)', expected: 'Mobile calendar app integration' },
                { name: 'Android', agent: 'Mozilla/5.0 (Linux; Android 11)', expected: 'Mobile calendar app integration' },
                { name: 'Windows', agent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)', expected: 'Download .ics file' },
                { name: 'Mac', agent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)', expected: 'Download .ics file' }
            ];
            
            let results = '<div class="success"><strong>Platform Simulation Results:</strong><br>';
            
            platforms.forEach(platform => {
                const isIOS = /iPhone|iPad|iPod/i.test(platform.agent);
                const isAndroid = /Android/i.test(platform.agent);
                const method = (isIOS || isAndroid) ? 'Mobile app integration' : 'File download';
                results += `${platform.name}: ${method} âœ…<br>`;
            });
            
            results += '</div>';
            document.getElementById('platformTest').innerHTML = results;
        }
        
        // Auto-run device detection on load
        window.onload = function() {
            testDeviceDetection();
        };
    </script>
</body>
</html>