<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Website Builder - Photography Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent-gold: #d4af37;
            --accent-blue: #007acc;
            --border-color: #333;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff3366;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
        }
        
        .builder-container {
            display: grid;
            grid-template-columns: 320px 1fr 300px;
            grid-template-rows: 60px 1fr;
            height: 100vh;
        }
        
        /* Mobile Responsive - CapCut Style - OVERRIDE ALL PREVIOUS */
        @media (max-width: 768px) {
            .builder-container {
                grid-template-columns: 1fr !important;
                grid-template-rows: 60px 1fr 60px !important;
                height: 100vh;
            }
            
            .left-sidebar,
            .right-sidebar {
                display: none !important;
            }
            
            .preview-area {
                grid-column: 1;
                background: var(--bg-primary);
                overflow: auto;
            }
            
            .mobile-preview-toggle {
                display: block !important;
            }
            
            .ai-panel {
                width: 100% !important;
                right: -100% !important;
                top: 0;
                height: 100vh;
            }
            
            .text-toolbar {
                max-width: 90vw;
                position: fixed;
                bottom: 80px;
                left: 50%;
                transform: translateX(-50%);
                top: auto;
            }
            
            .top-bar {
                padding: 0 10px !important;
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .project-info {
                gap: 10px;
            }
            
            .project-name {
                font-size: 12px !important;
                padding: 4px 8px !important;
                max-width: 120px;
            }
            
            .actions {
                gap: 5px !important;
                flex-wrap: wrap;
            }
            
            .actions .btn {
                padding: 6px 8px !important;
                font-size: 11px !important;
                min-width: auto;
            }
            
            .actions .btn i {
                margin-right: 4px;
            }
            
            /* Mobile toolbar at bottom with scrolling */
            .mobile-toolbar {
                order: 3;
                grid-column: 1;
                background: var(--bg-secondary);
                border-top: 1px solid var(--border-color);
                padding: 8px;
                display: flex !important;
                overflow-x: auto;
                overflow-y: hidden;
                gap: 8px;
                align-items: center;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .mobile-toolbar::-webkit-scrollbar {
                display: none;
            }
            
            .mobile-toolbar .btn {
                flex-shrink: 0;
                min-width: 60px;
                padding: 8px 6px;
                font-size: 10px;
                text-align: center;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2px;
                white-space: nowrap;
            }
            
            .canvas {
                padding: 10px !important;
                margin: 0 !important;
            }
        }
        
        /* Mobile Preview Toggle */
        .mobile-preview-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--accent-gold);
            color: var(--bg-primary);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        /* Full Screen Preview Mode - CapCut Style */
        .fullscreen-preview {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 1000;
            display: none;
        }
        
        .fullscreen-preview.active {
            display: block;
        }
        
        .fullscreen-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .fullscreen-title {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .fullscreen-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
        }
        
        .fullscreen-close:hover {
            background: var(--bg-tertiary);
        }
        
        .fullscreen-content {
            height: calc(100% - 70px);
            overflow: auto;
        }
        
        /* Top Bar */
        .top-bar {
            grid-column: 1 / -1;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        .project-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .project-name {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid transparent;
        }
        
        .project-name:focus {
            outline: none;
            border-color: var(--accent-gold);
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-ai {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        
        .btn-ai:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .btn-primary {
            background: var(--accent-gold);
            color: var(--bg-primary);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn:hover {
            transform: translateY(-1px);
            filter: brightness(1.1);
        }
        
        /* Left Sidebar - AI Tools */
        .left-sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .ai-prompt {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 15px;
        }
        
        .ai-prompt:focus {
            outline: none;
            border-color: var(--accent-gold);
        }
        
        .template-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .template-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .template-card:hover {
            border-color: var(--accent-gold);
            background: rgba(212, 175, 55, 0.1);
        }
        
        .template-card.selected {
            border-color: var(--accent-gold);
            background: rgba(212, 175, 55, 0.2);
        }
        
        .template-name {
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .template-desc {
            font-size: 10px;
            color: var(--text-secondary);
        }
        
        .page-manager {
            flex: 1;
        }
        
        .page-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .page-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .page-item:hover {
            background: rgba(212, 175, 55, 0.1);
        }
        
        .page-item.active {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid var(--accent-gold);
        }
        
        .page-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .add-page {
            background: var(--bg-tertiary);
            border: 1px dashed var(--border-color);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            color: var(--text-secondary);
            margin-top: 10px;
            transition: all 0.2s;
        }
        
        .add-page:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }
        
        /* Canvas Area */
        .canvas-area {
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .canvas-toolbar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .viewport-controls {
            display: flex;
            gap: 8px;
        }
        
        .viewport-btn {
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
        }
        
        .viewport-btn.active {
            background: var(--accent-gold);
            color: var(--bg-primary);
            border-color: var(--accent-gold);
        }
        
        .canvas-wrapper {
            flex: 1;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 40px;
            overflow: auto;
            background: #f0f0f0;
        }
        
        .canvas {
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            min-height: 600px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            cursor: crosshair;
        }
        
        /* Draggable Elements */
        .draggable-element {
            position: relative;
            cursor: move;
            border: 2px dashed transparent;
            transition: all 0.2s;
            user-select: none;
            touch-action: none;
            margin: 10px 0;
        }
        
        .draggable-element:hover {
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.2);
        }
        
        .draggable-element.dragging {
            border-color: var(--accent-gold);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            transform: rotate(1deg) scale(1.02);
            z-index: 1000;
            opacity: 0.9;
        }
        
        .element-controls {
            position: absolute;
            top: -35px;
            right: 5px;
            display: none;
            background: var(--bg-secondary);
            border-radius: 4px;
            padding: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            gap: 4px;
            z-index: 100;
        }
        
        .draggable-element:hover .element-controls {
            display: flex;
        }
        
        .control-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            background: var(--accent-gold);
            color: var(--bg-primary);
        }
        
        /* Drop zones */
        .drop-zone {
            min-height: 60px;
            border: 2px dashed #ddd;
            margin: 5px 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-style: italic;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .drop-zone.drag-over {
            border-color: var(--accent-gold);
            background: rgba(212, 175, 55, 0.1);
            color: var(--accent-gold);
        }
        
        .drag-handle {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 20px;
            height: 20px;
            background: var(--accent-gold);
            border-radius: 3px;
            cursor: grab;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
        }
        
        .draggable-element:hover .drag-handle {
            display: flex;
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        .canvas.desktop {
            width: 1200px;
            max-width: 100%;
        }
        
        .canvas.tablet {
            width: 768px;
            max-width: 100%;
        }
        
        .canvas.mobile {
            width: 375px;
        }
        
        .canvas-content {
            width: 100%;
            height: 100%;
            min-height: 600px;
        }
        
        .empty-canvas {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
            text-align: center;
            padding: 40px;
        }
        
        .empty-canvas i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        /* Right Sidebar - Properties */
        .right-sidebar {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .property-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .property-group {
            margin-bottom: 20px;
        }
        
        .property-label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .property-input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .property-input:focus {
            outline: none;
            border-color: var(--accent-gold);
        }
        
        .color-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
            margin-top: 10px;
        }
        
        .color-swatch {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .color-swatch:hover {
            transform: scale(1.1);
            border-color: var(--accent-gold);
        }
        
        /* Loading and Status */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .loading-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-message {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .status-detail {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* Text Editing Toolbar */
        .text-toolbar {
            position: fixed;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            gap: 8px;
            flex-wrap: wrap;
            max-width: 500px;
        }
        
        .text-toolbar.active {
            display: flex;
        }
        
        .toolbar-btn {
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .toolbar-btn:hover,
        .toolbar-btn.active {
            background: var(--accent-gold);
            color: var(--bg-primary);
        }
        
        .toolbar-select {
            padding: 4px 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* AI Assistant Panel */
        .ai-panel {
            position: fixed;
            top: 60px;
            right: -400px;
            width: 380px;
            height: calc(100vh - 60px);
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            transition: right 0.3s ease;
            z-index: 999;
            display: flex;
            flex-direction: column;
        }
        
        .ai-panel.active {
            right: 0;
        }
        
        .ai-panel-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ai-panel-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .ai-prompt-input {
            width: 100%;
            min-height: 100px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            font-size: 14px;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .ai-suggestions {
            margin-top: 20px;
        }
        
        .suggestion-item {
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border-color);
        }
        
        .suggestion-item:hover {
            background: var(--accent-gold);
            color: var(--bg-primary);
        }
        
        /* Mobile-First Responsive Design */
        @media (max-width: 1024px) {
            .builder-container {
                grid-template-columns: 280px 1fr 250px;
            }
        }
    </style>
</head>
<body>
    <div class="builder-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="project-info">
                <input type="text" class="project-name" value="My Photography Website" placeholder="Project Name">
                <span class="status-indicator">Ready</span>
            </div>
            
            <div class="actions">
                <button class="btn btn-secondary" onclick="addTextElement()">
                    <i class="fas fa-font"></i> Add Text
                </button>
                <button class="btn btn-secondary" onclick="triggerPhotoUpload()">
                    <i class="fas fa-camera"></i> Add Photo
                </button>
                <button class="btn btn-secondary" onclick="addLogoElement()">
                    <i class="fas fa-image"></i> Add Logo
                </button>
                <button class="btn btn-ai" onclick="toggleAIAssistant()">
                    <i class="fas fa-robot"></i> AI Assistant
                </button>
                <button class="btn btn-secondary" onclick="saveDraft()">
                    <i class="fas fa-save"></i> Save
                </button>
                <button class="btn btn-secondary" onclick="previewSite()">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button class="btn btn-primary" onclick="publishSite()">
                    <i class="fas fa-rocket"></i> Publish
                </button>
            </div>
        </div>
        
        <!-- Left Sidebar - AI Tools -->
        <div class="left-sidebar">
            <div class="sidebar-section">
                <div class="section-title">AI Website Generator</div>
                <textarea class="ai-prompt" placeholder="Describe your dream website... 

Examples:
‚Ä¢ A luxury wedding photography site with elegant galleries
‚Ä¢ Modern portrait studio with booking system
‚Ä¢ Editorial fashion photographer portfolio
‚Ä¢ Family photography with pricing packages"></textarea>
                
                <button class="btn btn-primary" style="width: 100%;" onclick="generateWebsite()">
                    <i class="fas fa-magic"></i> Generate Website
                </button>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">Quick Templates</div>
                <div class="template-grid">
                    <div class="template-card" data-template="wedding">
                        <div class="template-name">Wedding</div>
                        <div class="template-desc">Elegant & Romantic</div>
                    </div>
                    <div class="template-card" data-template="portrait">
                        <div class="template-name">Portrait</div>
                        <div class="template-desc">Professional & Clean</div>
                    </div>
                    <div class="template-card" data-template="fashion">
                        <div class="template-name">Fashion</div>
                        <div class="template-desc">Bold & Editorial</div>
                    </div>
                    <div class="template-card" data-template="commercial">
                        <div class="template-name">Commercial</div>
                        <div class="template-desc">Corporate & Modern</div>
                    </div>
                </div>
                
                <button class="btn btn-secondary" style="width: 100%;" onclick="applyTemplate()">
                    Apply Selected Template
                </button>
            </div>
            
            <div class="sidebar-section page-manager">
                <div class="section-title">Page Manager</div>
                <div class="page-list" id="pageList">
                    <div class="page-item active" data-page="home" onclick="switchToPage('home')">
                        <span class="page-name">Home</span>
                        <i class="fas fa-ellipsis-v"></i>
                    </div>
                    <div class="page-item" data-page="about" onclick="switchToPage('about')">
                        <span class="page-name">About</span>
                        <i class="fas fa-ellipsis-v"></i>
                    </div>
                    <div class="page-item" data-page="portfolio" onclick="switchToPage('portfolio')">
                        <span class="page-name">Portfolio</span>
                        <i class="fas fa-ellipsis-v"></i>
                    </div>
                    <div class="page-item" data-page="contact" onclick="switchToPage('contact')">
                        <span class="page-name">Contact</span>
                        <i class="fas fa-ellipsis-v"></i>
                    </div>
                </div>
                
                <div class="add-page" onclick="addNewPage()">
                    <i class="fas fa-plus"></i> Add New Page
                </div>
            </div>
        </div>
        
        <!-- Text Editing Toolbar -->
        <div id="textToolbar" class="text-toolbar">
            <select class="toolbar-select" onchange="changeFontFamily(this.value)">
                <option value="Arial">Arial</option>
                <option value="Georgia">Georgia</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Helvetica">Helvetica</option>
                <option value="Playfair Display">Playfair Display</option>
                <option value="Montserrat">Montserrat</option>
                <option value="Inter">Inter</option>
            </select>
            
            <select class="toolbar-select" onchange="changeFontSize(this.value)">
                <option value="12px">12px</option>
                <option value="14px">14px</option>
                <option value="16px">16px</option>
                <option value="18px">18px</option>
                <option value="20px">20px</option>
                <option value="24px">24px</option>
                <option value="32px">32px</option>
                <option value="48px">48px</option>
                <option value="64px">64px</option>
            </select>
            
            <button class="toolbar-btn" onclick="toggleBold()"><b>B</b></button>
            <button class="toolbar-btn" onclick="toggleItalic()"><i>I</i></button>
            <button class="toolbar-btn" onclick="toggleUnderline()"><u>U</u></button>
            
            <input type="color" class="toolbar-select" onchange="changeTextColor(this.value)" value="#000000">
            
            <button class="toolbar-btn" onclick="alignText('left')">‚óß</button>
            <button class="toolbar-btn" onclick="alignText('center')">‚ñ£</button>
            <button class="toolbar-btn" onclick="alignText('right')">‚ó®</button>
        </div>
        
        <!-- AI Assistant Panel -->
        <div id="aiPanel" class="ai-panel">
            <div class="ai-panel-header">
                <h3>ü§ñ AI Assistant</h3>
                <button class="btn btn-secondary" onclick="toggleAIAssistant()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="ai-panel-content">
                <!-- AI Credits Display -->
                <div class="ai-credits-display" style="
                    background: var(--bg-tertiary);
                    border: 1px solid var(--border-color);
                    border-radius: 8px;
                    padding: 12px;
                    margin-bottom: 20px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                ">
                    <div>
                        <span style="color: var(--text-secondary); font-size: 12px;">AI Credits:</span>
                        <span id="aiCreditsCount" style="
                            color: var(--accent-gold);
                            font-weight: bold;
                            font-size: 16px;
                            margin-left: 8px;
                        ">Loading...</span>
                    </div>
                    <button id="buyCreditsBtn" onclick="showCreditsPurchase()" style="
                        background: var(--accent-gold);
                        color: var(--bg-primary);
                        border: none;
                        padding: 6px 12px;
                        border-radius: 4px;
                        font-size: 11px;
                        cursor: pointer;
                        font-weight: 500;
                    ">Buy More</button>
                </div>
                
                <div class="section-title">Ask AI to modify your page:</div>
                
                <textarea class="ai-prompt-input" placeholder="Tell the AI what you want to change...

Examples:
‚Ä¢ Make the hero section more dramatic with dark colors
‚Ä¢ Add a pricing section with 3 packages
‚Ä¢ Change the about section to be more professional
‚Ä¢ Add a testimonials gallery
‚Ä¢ Make the contact form more elegant"></textarea>
                
                <button class="btn btn-primary" style="width: 100%;" onclick="processAIRequest()">
                    <i class="fas fa-magic"></i> Apply AI Changes
                </button>
                
                <div class="ai-suggestions">
                    <div class="section-title">Quick AI Actions:</div>
                    
                    <div class="suggestion-item" onclick="quickAIAction('luxury')">
                        ‚ú® Make it more luxury & elegant
                    </div>
                    
                    <div class="suggestion-item" onclick="quickAIAction('modern')">
                        üéØ Make it modern & minimal
                    </div>
                    
                    <div class="suggestion-item" onclick="quickAIAction('gallery')">
                        üñºÔ∏è Add a stunning photo gallery
                    </div>
                    
                    <div class="suggestion-item" onclick="quickAIAction('pricing')">
                        üí∞ Add pricing packages
                    </div>
                    
                    <div class="suggestion-item" onclick="quickAIAction('testimonials')">
                        ‚≠ê Add client testimonials
                    </div>
                    
                    <div class="suggestion-item" onclick="quickAIAction('contact')">
                        üìû Enhance contact section
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Canvas Area -->
        <div class="canvas-area">
            <div class="canvas-toolbar">
                <div class="viewport-controls">
                    <button class="viewport-btn active" data-viewport="desktop">
                        <i class="fas fa-desktop"></i> Desktop
                    </button>
                    <button class="viewport-btn" data-viewport="tablet">
                        <i class="fas fa-tablet"></i> Tablet
                    </button>
                    <button class="viewport-btn" data-viewport="mobile">
                        <i class="fas fa-mobile"></i> Mobile
                    </button>
                </div>
                
                <div class="canvas-info">
                    <span id="currentPage">Home Page</span>
                </div>
            </div>
            
            <div class="canvas-wrapper">
                <div class="canvas desktop" id="mainCanvas">
                    <div class="canvas-content">
                        <div class="empty-canvas">
                            <i class="fas fa-wand-magic-sparkles"></i>
                            <h3>Start Building Your Dream Website</h3>
                            <p>Use the AI generator on the left to describe your vision, or choose a template to get started quickly.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Sidebar - Properties -->
        <div class="right-sidebar">
            <div class="property-section">
                <div class="section-title">Site Settings</div>
                
                <div class="property-group">
                    <label class="property-label">Site Title</label>
                    <input type="text" class="property-input" value="Photography Studio" placeholder="Your Site Title">
                </div>
                
                <div class="property-group">
                    <label class="property-label">Primary Color</label>
                    <input type="color" class="property-input" value="#d4af37">
                    <div class="color-grid">
                        <div class="color-swatch" style="background: #d4af37;" data-color="#d4af37"></div>
                        <div class="color-swatch" style="background: #2c3e50;" data-color="#2c3e50"></div>
                        <div class="color-swatch" style="background: #e74c3c;" data-color="#e74c3c"></div>
                        <div class="color-swatch" style="background: #3498db;" data-color="#3498db"></div>
                        <div class="color-swatch" style="background: #2ecc71;" data-color="#2ecc71"></div>
                        <div class="color-swatch" style="background: #9b59b6;" data-color="#9b59b6"></div>
                    </div>
                </div>
                
                <div class="property-group">
                    <label class="property-label">Typography</label>
                    <select class="property-input">
                        <option value="inter">Inter (Modern)</option>
                        <option value="playfair">Playfair Display (Elegant)</option>
                        <option value="roboto">Roboto (Clean)</option>
                        <option value="montserrat">Montserrat (Versatile)</option>
                    </select>
                </div>
            </div>
            
            <div class="property-section">
                <div class="section-title">Page Properties</div>
                
                <div class="property-group">
                    <label class="property-label">Page Background</label>
                    <input type="color" class="property-input" value="#ffffff">
                </div>
                
                <div class="property-group">
                    <label class="property-label">Content Width</label>
                    <select class="property-input">
                        <option value="full">Full Width</option>
                        <option value="contained">Contained</option>
                        <option value="narrow">Narrow</option>
                    </select>
                </div>
            </div>
            
            <div class="property-section">
                <div class="section-title">SEO Settings</div>
                
                <div class="property-group">
                    <label class="property-label">Meta Title</label>
                    <input type="text" class="property-input" placeholder="Professional Photography Services">
                </div>
                
                <div class="property-group">
                    <label class="property-label">Meta Description</label>
                    <textarea class="property-input" rows="3" placeholder="Capturing your most precious moments with artistic vision and technical excellence..."></textarea>
                </div>
            </div>
        </div>
        
        <!-- Mobile Toolbar (only visible on mobile) - Scrollable -->
        <div class="mobile-toolbar" style="display: none;">
            <button class="btn btn-secondary" onclick="addTextElement()">
                <i class="fas fa-font"></i>
                <span>Text</span>
            </button>
            <button class="btn btn-secondary" onclick="triggerPhotoUpload()">
                <i class="fas fa-camera"></i>
                <span>Photo</span>
            </button>
            <button class="btn btn-secondary" onclick="addLogoElement()">
                <i class="fas fa-image"></i>
                <span>Logo</span>
            </button>
            <button class="btn btn-ai" onclick="toggleAIAssistant()">
                <i class="fas fa-robot"></i>
                <span>AI</span>
            </button>
            <button class="btn btn-secondary" onclick="applyTemplate()">
                <i class="fas fa-th-large"></i>
                <span>Templates</span>
            </button>
            <button class="btn btn-secondary" onclick="openColorPicker()">
                <i class="fas fa-palette"></i>
                <span>Colors</span>
            </button>
            <button class="btn btn-secondary" onclick="openTypography()">
                <i class="fas fa-text-height"></i>
                <span>Fonts</span>
            </button>
            <button class="btn btn-secondary" onclick="saveDraft()">
                <i class="fas fa-save"></i>
                <span>Save</span>
            </button>
            <button class="btn btn-secondary" onclick="toggleFullscreenPreview()">
                <i class="fas fa-expand"></i>
                <span>Preview</span>
            </button>
            <button class="btn btn-primary" onclick="publishSite()">
                <i class="fas fa-rocket"></i>
                <span>Publish</span>
            </button>
        </div>
    </div>

    <!-- Mobile Preview Toggle Button -->
    <button class="mobile-preview-toggle" onclick="toggleFullscreenPreview()">
        <i class="fas fa-expand"></i>
    </button>

    <!-- Fullscreen Preview Mode - CapCut Style -->
    <div class="fullscreen-preview" id="fullscreenPreview">
        <div class="fullscreen-header">
            <div class="fullscreen-title">
                <i class="fas fa-mobile-alt"></i> Full Preview
            </div>
            <button class="fullscreen-close" onclick="closeFullscreenPreview()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="fullscreen-content">
            <iframe id="fullscreenCanvas" style="width: 100%; height: 100%; border: none; background: white;"></iframe>
        </div>
    </div>

    <!-- Firebase config removed for now -->
    <script>
        console.log('AI Website Builder: Initializing...');
        
        // Core Builder State
        let currentProject = {
            name: 'My Photography Website',
            pages: ['home', 'about', 'portfolio', 'contact'],
            currentPage: 'home',
            settings: {
                primaryColor: '#d4af37',
                typography: 'inter',
                siteTitle: 'Photography Studio'
            },
            pageData: {}
        };
        
        let currentViewport = 'desktop';
        let isGenerating = false;
        let selectedTemplate = null;
        
        // Initialize Builder
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadProject();
            console.log('AI Website Builder: Ready');
        });
        
        function setupEventListeners() {
            // Template selection
            document.querySelectorAll('.template-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedTemplate = this.dataset.template;
                });
            });
            
            // Viewport controls
            document.querySelectorAll('.viewport-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.viewport-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const viewport = this.dataset.viewport;
                    const canvas = document.getElementById('mainCanvas');
                    canvas.className = `canvas ${viewport}`;
                    currentViewport = viewport;
                });
            });
            
            // Page switching - remove since we're using onclick in HTML
            
            // Color swatches
            document.querySelectorAll('.color-swatch').forEach(swatch => {
                swatch.addEventListener('click', function() {
                    const color = this.dataset.color;
                    document.querySelector('input[type="color"]').value = color;
                    updateSiteColor(color);
                });
            });
        }
        
        async function generateWebsite() {
            const prompt = document.querySelector('.ai-prompt').value.trim();
            
            if (!prompt) {
                showNotification('Please describe your dream website first', 'warning');
                return;
            }
            
            if (isGenerating) return;
            
            isGenerating = true;
            showLoading('Generating your dream website...', 'AI is analyzing your requirements and creating a custom design');
            
            try {
                // Generate website using intelligent template system
                const generatedSite = await intelligentGeneration(prompt);
                
                if (generatedSite) {
                    currentProject.pageData = generatedSite.pages;
                    currentProject.settings = { ...currentProject.settings, ...generatedSite.settings };
                    renderCurrentPage();
                    updateUIFromSettings();
                    showNotification('Website generated successfully!', 'success');
                } else {
                    throw new Error('Generation failed');
                }
                
            } catch (error) {
                console.error('Website generation error:', error);
                showNotification('Generated intelligent template based on your description', 'success');
                
                // Fallback to smart template selection
                const templateType = detectTemplateFromPrompt(prompt);
                selectedTemplate = templateType;
                applyTemplate();
            } finally {
                hideLoading();
                isGenerating = false;
            }
        }
        
        function applyTemplate() {
            if (!selectedTemplate) {
                showNotification('Please select a template first', 'warning');
                return;
            }
            
            showLoading('Applying template...', 'Customizing design for your photography business');
            
            // Template configurations
            const templates = {
                wedding: {
                    settings: {
                        primaryColor: '#d4af37',
                        typography: 'playfair',
                        style: 'elegant'
                    },
                    pages: {
                        home: generateTemplateContent('wedding', 'home'),
                        about: generateTemplateContent('wedding', 'about'),
                        portfolio: generateTemplateContent('wedding', 'portfolio'),
                        contact: generateTemplateContent('wedding', 'contact')
                    }
                },
                portrait: {
                    settings: {
                        primaryColor: '#2c3e50',
                        typography: 'inter',
                        style: 'modern'
                    },
                    pages: {
                        home: generateTemplateContent('portrait', 'home'),
                        about: generateTemplateContent('portrait', 'about'),
                        portfolio: generateTemplateContent('portrait', 'portfolio'),
                        contact: generateTemplateContent('portrait', 'contact')
                    }
                },
                fashion: {
                    settings: {
                        primaryColor: '#000000',
                        typography: 'montserrat',
                        style: 'bold'
                    },
                    pages: {
                        home: generateTemplateContent('fashion', 'home'),
                        about: generateTemplateContent('fashion', 'about'),
                        portfolio: generateTemplateContent('fashion', 'portfolio'),
                        contact: generateTemplateContent('fashion', 'contact')
                    }
                },
                commercial: {
                    settings: {
                        primaryColor: '#3498db',
                        typography: 'roboto',
                        style: 'corporate'
                    },
                    pages: {
                        home: generateTemplateContent('commercial', 'home'),
                        about: generateTemplateContent('commercial', 'about'),
                        portfolio: generateTemplateContent('commercial', 'portfolio'),
                        contact: generateTemplateContent('commercial', 'contact')
                    }
                }
            };
            
            const template = templates[selectedTemplate];
            if (template) {
                currentProject.settings = { ...currentProject.settings, ...template.settings };
                currentProject.pageData = template.pages;
                
                setTimeout(() => {
                    renderCurrentPage();
                    updateUIFromSettings();
                    hideLoading();
                    showNotification(`${selectedTemplate} template applied successfully!`, 'success');
                }, 1500);
            }
        }
        
        function generateTemplateContent(templateType, pageType) {
            const templates = {
                wedding: {
                    home: generateEditableContent('wedding', 'home'),
                    about: generateEditableContent('wedding', 'about'),
                    portfolio: generateEditableContent('wedding', 'portfolio'),
                    contact: generateEditableContent('wedding', 'contact')
                },
                portrait: {
                    home: generateEditableContent('portrait', 'home'),
                    about: generateEditableContent('portrait', 'about'),
                    portfolio: generateEditableContent('portrait', 'portfolio'),
                    contact: generateEditableContent('portrait', 'contact')
                },
                fashion: {
                    home: generateEditableContent('fashion', 'home'),
                    about: generateEditableContent('fashion', 'about'),
                    portfolio: generateEditableContent('fashion', 'portfolio'),
                    contact: generateEditableContent('fashion', 'contact')
                },
                commercial: {
                    home: generateEditableContent('commercial', 'home'),
                    about: generateEditableContent('commercial', 'about'),
                    portfolio: generateEditableContent('commercial', 'portfolio'),
                    contact: generateEditableContent('commercial', 'contact')
                }
            };
            
            return templates[templateType]?.[pageType] || generateEditableContent('default', pageType);
        }
        
        function generateEditableContent(templateType, pageType) {
            const contentLibrary = {
                wedding: {
                    home: `
                        <div class="editable-section hero-section" style="background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://images.unsplash.com/photo-1519741497674-611481863552?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80'); background-size: cover; background-position: center; height: 100vh; display: flex; align-items: center; justify-content: center; color: white; text-align: center; position: relative;">
                            <div class="photo-upload-overlay" onclick="uploadSectionPhoto(this)" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">üì∑ Change Photo</div>
                            <div>
                                <h1 contenteditable="true" style="font-size: 4rem; font-weight: 300; margin-bottom: 20px; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Eternal Moments</h1>
                                <p contenteditable="true" style="font-size: 1.5rem; margin-bottom: 30px; opacity: 0.9; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Capturing the magic of your special day</p>
                                <button style="padding: 15px 30px; background: #d4af37; color: white; border: none; font-size: 1.1rem; cursor: pointer; border-radius: 4px;">View Our Work</button>
                            </div>
                        </div>
                        
                        <div class="editable-section" style="padding: 100px 50px; text-align: center; background: #f8f8f8;">
                            <h2 contenteditable="true" style="font-size: 3rem; margin-bottom: 30px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Timeless Wedding Photography</h2>
                            <p contenteditable="true" style="font-size: 1.2rem; max-width: 800px; margin: 0 auto; line-height: 1.8; color: #666; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">We believe every love story deserves to be told beautifully. Our approach combines artistic vision with documentary storytelling to create images that will be treasured for generations.</p>
                        </div>
                        
                        <div class="gallery-section" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0;">
                            <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1606216794074-735e91aa2c92?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                            </div>
                            <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1583939003579-730e3918a45a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                            </div>
                            <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1537633552985-df8429e8048b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                            </div>
                        </div>
                    `,
                    about: `
                        <div class="editable-section" style="padding: 100px 50px; max-width: 1200px; margin: 0 auto;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 80px; align-items: center;">
                                <div>
                                    <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 30px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Our Story</h1>
                                    <p contenteditable="true" style="font-size: 1.2rem; line-height: 1.8; color: #666; margin-bottom: 30px; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">With over a decade of experience capturing love stories, we've had the privilege of documenting hundreds of weddings across the country. Our passion lies in creating timeless images that reflect the unique personality and emotion of each couple.</p>
                                    <p contenteditable="true" style="font-size: 1.2rem; line-height: 1.8; color: #666; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">We believe that your wedding day is one of the most important days of your life, and our goal is to capture every precious moment with artistry and authenticity.</p>
                                </div>
                                <div class="photo-section" onclick="uploadSectionPhoto(this)" style="background: url('https://images.unsplash.com/photo-1511285560929-80b456fea0bc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 500px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                            </div>
                        </div>
                    `,
                    portfolio: `
                        <div class="editable-section" style="padding: 100px 50px; text-align: center;">
                            <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 50px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Our Portfolio</h1>
                            <div class="portfolio-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto;">
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1519741497674-611481863552?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 300px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1606216794074-735e91aa2c92?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 300px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1583939003579-730e3918a45a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 300px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1537633552985-df8429e8048b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 300px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                            </div>
                        </div>
                    `,
                    contact: `
                        <div class="editable-section" style="padding: 100px 50px; max-width: 800px; margin: 0 auto; text-align: center;">
                            <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 30px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Let's Create Magic Together</h1>
                            <p contenteditable="true" style="font-size: 1.2rem; margin-bottom: 50px; color: #666; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Ready to start planning your dream wedding photography? We'd love to hear from you.</p>
                            
                            <form style="text-align: left;">
                                <div style="margin-bottom: 20px;">
                                    <input type="text" placeholder="Your Names" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <input type="email" placeholder="Email Address" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <input type="date" placeholder="Wedding Date" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                </div>
                                <div style="margin-bottom: 30px;">
                                    <textarea placeholder="Tell us about your vision..." rows="5" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"></textarea>
                                </div>
                                <button type="submit" style="width: 100%; padding: 15px; background: #d4af37; color: white; border: none; font-size: 1.1rem; cursor: pointer; border-radius: 4px;">Send Message</button>
                            </form>
                        </div>
                    `
                },
                portrait: {
                    home: `
                        <div class="editable-section hero-section" style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80'); background-size: cover; background-position: center; height: 100vh; display: flex; align-items: center; justify-content: center; color: white; text-align: center; position: relative;">
                            <div class="photo-upload-overlay" onclick="uploadSectionPhoto(this)" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">üì∑ Change Photo</div>
                            <div>
                                <h1 contenteditable="true" style="font-size: 4rem; font-weight: 400; margin-bottom: 20px; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Professional Portraits</h1>
                                <p contenteditable="true" style="font-size: 1.5rem; margin-bottom: 30px; opacity: 0.9; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Capturing your authentic self</p>
                                <button style="padding: 15px 30px; background: #2c3e50; color: white; border: none; font-size: 1.1rem; cursor: pointer; border-radius: 4px;">Book a Session</button>
                            </div>
                        </div>
                    `,
                    about: `
                        <div class="editable-section" style="padding: 100px 50px; max-width: 1200px; margin: 0 auto;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 80px; align-items: center;">
                                <div>
                                    <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 30px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Professional Portrait Photography</h1>
                                    <p contenteditable="true" style="font-size: 1.2rem; line-height: 1.8; color: #666; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Specializing in professional headshots and personal branding photography for executives, entrepreneurs, and creative professionals.</p>
                                </div>
                                <div class="photo-section" onclick="uploadSectionPhoto(this)" style="background: url('https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 500px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                            </div>
                        </div>
                    `,
                    portfolio: `
                        <div class="editable-section" style="padding: 100px 50px; text-align: center;">
                            <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 50px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Portrait Gallery</h1>
                            <div class="portfolio-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto;">
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1494790108755-2616b612b647?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                            </div>
                        </div>
                    `,
                    contact: `
                        <div class="editable-section" style="padding: 100px 50px; max-width: 800px; margin: 0 auto; text-align: center;">
                            <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 30px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Book Your Portrait Session</h1>
                            <p contenteditable="true" style="font-size: 1.2rem; margin-bottom: 50px; color: #666; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Professional headshots that make an impact.</p>
                            
                            <form style="text-align: left;">
                                <div style="margin-bottom: 20px;">
                                    <input type="text" placeholder="Full Name" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <input type="email" placeholder="Email Address" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <select style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                        <option>Headshots</option>
                                        <option>Personal Branding</option>
                                        <option>Corporate</option>
                                        <option>Creative Portraits</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 30px;">
                                    <textarea placeholder="Tell us about your goals..." rows="5" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"></textarea>
                                </div>
                                <button type="submit" style="width: 100%; padding: 15px; background: #2c3e50; color: white; border: none; font-size: 1.1rem; cursor: pointer; border-radius: 4px;">Schedule Consultation</button>
                            </form>
                        </div>
                    `
                },
                fashion: {
                    home: `
                        <div class="editable-section hero-section" style="background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1469334031218-e382a71b716b?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80'); background-size: cover; background-position: center; height: 100vh; display: flex; align-items: center; justify-content: center; color: white; text-align: center; position: relative;">
                            <div class="photo-upload-overlay" onclick="uploadSectionPhoto(this)" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">üì∑ Change Photo</div>
                            <div>
                                <h1 contenteditable="true" style="font-size: 4rem; font-weight: 700; margin-bottom: 20px; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Editorial Fashion</h1>
                                <p contenteditable="true" style="font-size: 1.5rem; margin-bottom: 30px; opacity: 0.9; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Bold. Creative. Unforgettable.</p>
                                <button style="padding: 15px 30px; background: #000; color: white; border: none; font-size: 1.1rem; cursor: pointer; border-radius: 4px;">View Portfolio</button>
                            </div>
                        </div>
                    `,
                    about: `
                        <div class="editable-section" style="padding: 100px 50px; max-width: 1200px; margin: 0 auto;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 80px; align-items: center;">
                                <div>
                                    <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 30px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Fashion Photography</h1>
                                    <p contenteditable="true" style="font-size: 1.2rem; line-height: 1.8; color: #666; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Creating striking editorial and commercial fashion imagery that captures the essence of style and beauty.</p>
                                </div>
                                <div class="photo-section" onclick="uploadSectionPhoto(this)" style="background: url('https://images.unsplash.com/photo-1469334031218-e382a71b716b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 500px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                            </div>
                        </div>
                    `,
                    portfolio: `
                        <div class="editable-section" style="padding: 100px 50px; text-align: center;">
                            <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 50px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Fashion Portfolio</h1>
                            <div class="portfolio-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto;">
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1469334031218-e382a71b716b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1509631179647-0177331693ae?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                            </div>
                        </div>
                    `,
                    contact: `
                        <div class="editable-section" style="padding: 100px 50px; max-width: 800px; margin: 0 auto; text-align: center;">
                            <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 30px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Let's Create Together</h1>
                            <p contenteditable="true" style="font-size: 1.2rem; margin-bottom: 50px; color: #666; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Ready to create bold, striking fashion imagery?</p>
                            
                            <form style="text-align: left;">
                                <div style="margin-bottom: 20px;">
                                    <input type="text" placeholder="Name / Brand" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <input type="email" placeholder="Email Address" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <select style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                        <option>Editorial Shoot</option>
                                        <option>Commercial Campaign</option>
                                        <option>Lookbook</option>
                                        <option>Creative Collaboration</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 30px;">
                                    <textarea placeholder="Tell us about your vision..." rows="5" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"></textarea>
                                </div>
                                <button type="submit" style="width: 100%; padding: 15px; background: #000; color: white; border: none; font-size: 1.1rem; cursor: pointer; border-radius: 4px;">Start Collaboration</button>
                            </form>
                        </div>
                    `
                },
                commercial: {
                    home: `
                        <div class="editable-section hero-section" style="background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80'); background-size: cover; background-position: center; height: 100vh; display: flex; align-items: center; justify-content: center; color: white; text-align: center; position: relative;">
                            <div class="photo-upload-overlay" onclick="uploadSectionPhoto(this)" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">üì∑ Change Photo</div>
                            <div>
                                <h1 contenteditable="true" style="font-size: 4rem; font-weight: 500; margin-bottom: 20px; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Commercial Photography</h1>
                                <p contenteditable="true" style="font-size: 1.5rem; margin-bottom: 30px; opacity: 0.9; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Professional imagery for your business</p>
                                <button style="padding: 15px 30px; background: #3498db; color: white; border: none; font-size: 1.1rem; cursor: pointer; border-radius: 4px;">Get Started</button>
                            </div>
                        </div>
                    `,
                    about: `
                        <div class="editable-section" style="padding: 100px 50px; max-width: 1200px; margin: 0 auto;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 80px; align-items: center;">
                                <div>
                                    <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 30px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Commercial Services</h1>
                                    <p contenteditable="true" style="font-size: 1.2rem; line-height: 1.8; color: #666; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Providing businesses with high-quality photography for marketing, advertising, and corporate communications.</p>
                                </div>
                                <div class="photo-section" onclick="uploadSectionPhoto(this)" style="background: url('https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 500px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                            </div>
                        </div>
                    `,
                    portfolio: `
                        <div class="editable-section" style="padding: 100px 50px; text-align: center;">
                            <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 50px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Commercial Work</h1>
                            <div class="portfolio-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto;">
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1553877522-43269d4ea984?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                                <div class="gallery-item" onclick="uploadGalleryPhoto(this)" style="background: url('https://images.unsplash.com/photo-1542744173-8e7e53415bb0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; height: 400px; border-radius: 8px; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center;">
                                    <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;">üì∑ Upload Photo</div>
                                </div>
                            </div>
                        </div>
                    `,
                    contact: `
                        <div class="editable-section" style="padding: 100px 50px; max-width: 800px; margin: 0 auto; text-align: center;">
                            <h1 contenteditable="true" style="font-size: 3.5rem; margin-bottom: 30px; color: #333; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Let's Work Together</h1>
                            <p contenteditable="true" style="font-size: 1.2rem; margin-bottom: 50px; color: #666; outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Professional photography solutions for your business needs.</p>
                            
                            <form style="text-align: left;">
                                <div style="margin-bottom: 20px;">
                                    <input type="text" placeholder="Company Name" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <input type="email" placeholder="Email Address" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <select style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                                        <option>Product Photography</option>
                                        <option>Corporate Events</option>
                                        <option>Marketing Campaign</option>
                                        <option>Architectural</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 30px;">
                                    <textarea placeholder="Project details..." rows="5" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; resize: vertical;"></textarea>
                                </div>
                                <button type="submit" style="width: 100%; padding: 15px; background: #3498db; color: white; border: none; font-size: 1.1rem; cursor: pointer; border-radius: 4px;">Request Quote</button>
                            </form>
                        </div>
                    `
                }
            };
            
            return contentLibrary[templateType]?.[pageType] || `
                <div class="editable-section" style="padding: 100px; text-align: center;">
                    <h1 contenteditable="true" style="outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">${pageType.charAt(0).toUpperCase() + pageType.slice(1)} Page</h1>
                    <p contenteditable="true" style="outline: none; border: 2px dashed transparent;" onclick="makeEditable(this)">Professional ${templateType} photography content coming soon.</p>
                </div>
            `;
        }
        
        function switchToPage(pageName) {
            currentProject.currentPage = pageName;
            document.getElementById('currentPage').textContent = pageName.charAt(0).toUpperCase() + pageName.slice(1) + ' Page';
            renderCurrentPage();
        }
        
        function renderCurrentPage() {
            const canvas = document.querySelector('.canvas-content');
            const pageContent = currentProject.pageData?.[currentProject.currentPage];
            
            if (pageContent) {
                canvas.innerHTML = pageContent;
            } else {
                canvas.innerHTML = `
                    <div class="empty-canvas">
                        <i class="fas fa-wand-magic-sparkles"></i>
                        <h3>Start Building Your ${currentProject.currentPage.charAt(0).toUpperCase() + currentProject.currentPage.slice(1)} Page</h3>
                        <p>Use the AI generator to create content for this page, or choose a template to get started.</p>
                    </div>
                `;
            }
        }
        
        function addNewPage() {
            const pageName = prompt('Enter page name:');
            if (pageName && !currentProject.pages.includes(pageName.toLowerCase())) {
                const pageId = pageName.toLowerCase().replace(/\s+/g, '-');
                currentProject.pages.push(pageId);
                
                const pageList = document.getElementById('pageList');
                const pageItem = document.createElement('div');
                pageItem.className = 'page-item';
                pageItem.dataset.page = pageId;
                pageItem.innerHTML = `
                    <span class="page-name">${pageName}</span>
                    <i class="fas fa-ellipsis-v"></i>
                `;
                
                pageItem.onclick = () => switchToPage(pageId);
                
                pageList.appendChild(pageItem);
            }
        }
        
        function updateSiteColor(color) {
            currentProject.settings.primaryColor = color;
            // Apply color changes to canvas content
            const canvas = document.querySelector('.canvas-content');
            const buttons = canvas.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.style.background = color;
            });
        }
        
        function updateUIFromSettings() {
            document.querySelector('input[type="color"]').value = currentProject.settings.primaryColor;
            document.querySelector('.project-name').value = currentProject.name;
        }
        
        function showLoading(message, detail) {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.innerHTML = `
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div class="status-message">${message}</div>
                    <div class="status-detail">${detail}</div>
                </div>
            `;
            document.body.appendChild(overlay);
        }
        
        function hideLoading() {
            const overlays = document.querySelectorAll('.loading-overlay');
            overlays.forEach(overlay => {
                if (overlay && overlay.parentNode) {
                    overlay.remove();
                }
            });
            
            // Also clean up any other stuck modals
            cleanupModals();
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--warning)'};
                color: white;
                border-radius: 6px;
                font-weight: 500;
                z-index: 10001;
                animation: slideIn 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function loadProject() {
            renderCurrentPage();
            updateUIFromSettings();
        }
        
        function saveDraft() {
            localStorage.setItem('ai_website_project', JSON.stringify(currentProject));
            showNotification('Project saved successfully!', 'success');
        }
        
        // Photo upload functionality
        function uploadSectionPhoto(element) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageUrl = e.target.result;
                        const section = element.closest('.editable-section') || element;
                        section.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('${imageUrl}')`;
                        showNotification('Photo uploaded successfully!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }
        
        function uploadGalleryPhoto(element) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageUrl = e.target.result;
                        element.style.backgroundImage = `url('${imageUrl}')`;
                        showNotification('Gallery photo uploaded successfully!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }
        
        function makeEditable(element) {
            element.style.border = '2px dashed #d4af37';
            element.focus();
            
            element.addEventListener('blur', function() {
                element.style.border = '2px dashed transparent';
            });
            
            element.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey && element.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    element.blur();
                }
            });
        }
        
        // Add Text Element
        function addTextElement() {
            const canvas = document.getElementById('mainCanvas');
            const textElement = document.createElement('div');
            textElement.className = 'draggable-element';
            textElement.innerHTML = `
                <div class="drag-handle"><i class="fas fa-grip-vertical"></i></div>
                <div class="element-controls">
                    <button class="control-btn" onclick="duplicateElement(this)" title="Duplicate"><i class="fas fa-copy"></i></button>
                    <button class="control-btn" onclick="deleteElement(this)" title="Delete"><i class="fas fa-trash"></i></button>
                </div>
                <h2 contenteditable="true" style="padding: 20px; font-size: 2rem; color: #333; text-align: center; outline: none; border: 2px dashed transparent;" onclick="showTextToolbar(this)">Click to edit this text</h2>
            `;
            textElement.style.cssText = 'margin: 20px 0; cursor: pointer;';
            
            const canvasContent = canvas.querySelector('.canvas-content') || canvas;
            canvasContent.appendChild(textElement);
            makeDraggable(textElement);
            
            showNotification('Text element added! Drag to reposition.', 'success');
        }
        
        // Add Logo Element
        function addLogoElement() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const canvas = document.getElementById('mainCanvas');
                        const logoElement = document.createElement('div');
                        logoElement.className = 'draggable-element';
                        logoElement.innerHTML = `
                            <div class="drag-handle"><i class="fas fa-grip-vertical"></i></div>
                            <div class="element-controls">
                                <button class="control-btn" onclick="duplicateElement(this)" title="Duplicate"><i class="fas fa-copy"></i></button>
                                <button class="control-btn" onclick="deleteElement(this)" title="Delete"><i class="fas fa-trash"></i></button>
                            </div>
                            <img src="${e.target.result}" style="max-width: 200px; height: auto; cursor: pointer;" onclick="replaceLogoImage(this)">
                        `;
                        logoElement.style.cssText = 'text-align: center; padding: 20px; margin: 20px 0;';
                        
                        const canvasContent = canvas.querySelector('.canvas-content') || canvas;
                        canvasContent.appendChild(logoElement);
                        makeDraggable(logoElement);
                        
                        showNotification('Logo added! Drag to reposition.', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }
        
        // Trigger Photo Upload
        function triggerPhotoUpload() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const canvas = document.getElementById('mainCanvas');
                        const photoElement = document.createElement('div');
                        photoElement.className = 'draggable-element';
                        photoElement.innerHTML = `
                            <div class="drag-handle"><i class="fas fa-grip-vertical"></i></div>
                            <div class="element-controls">
                                <button class="control-btn" onclick="duplicateElement(this)" title="Duplicate"><i class="fas fa-copy"></i></button>
                                <button class="control-btn" onclick="deleteElement(this)" title="Delete"><i class="fas fa-trash"></i></button>
                            </div>
                            <img src="${e.target.result}" style="max-width: 100%; height: auto; border-radius: 8px; cursor: pointer;" onclick="replaceImage(this)">
                        `;
                        photoElement.style.cssText = 'text-align: center; padding: 20px; margin: 20px 0;';
                        
                        const canvasContent = canvas.querySelector('.canvas-content') || canvas;
                        canvasContent.appendChild(photoElement);
                        makeDraggable(photoElement);
                        
                        showNotification('Photo added! Drag to reposition.', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }
        
        // Replace Logo Image
        function replaceLogoImage(img) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        img.src = e.target.result;
                        showNotification('Logo updated!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }
        
        // Replace Image
        function replaceImage(img) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        img.src = e.target.result;
                        showNotification('Image updated!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }
        
        // Text Toolbar Functions
        let currentEditingElement = null;
        
        function showTextToolbar(element) {
            currentEditingElement = element;
            const toolbar = document.getElementById('textToolbar');
            const rect = element.getBoundingClientRect();
            
            toolbar.style.top = (rect.top - 60) + 'px';
            toolbar.style.left = Math.min(rect.left, window.innerWidth - 520) + 'px';
            toolbar.classList.add('active');
            
            element.style.border = '2px solid #d4af37';
            element.focus();
        }
        
        function hideTextToolbar() {
            const toolbar = document.getElementById('textToolbar');
            toolbar.classList.remove('active');
            
            if (currentEditingElement) {
                currentEditingElement.style.border = '2px dashed transparent';
                currentEditingElement = null;
            }
        }
        
        function changeFontFamily(fontFamily) {
            if (currentEditingElement) {
                currentEditingElement.style.fontFamily = fontFamily;
            }
        }
        
        function changeFontSize(fontSize) {
            if (currentEditingElement) {
                currentEditingElement.style.fontSize = fontSize;
            }
        }
        
        function toggleBold() {
            if (currentEditingElement) {
                const current = currentEditingElement.style.fontWeight;
                currentEditingElement.style.fontWeight = current === 'bold' ? 'normal' : 'bold';
            }
        }
        
        function toggleItalic() {
            if (currentEditingElement) {
                const current = currentEditingElement.style.fontStyle;
                currentEditingElement.style.fontStyle = current === 'italic' ? 'normal' : 'italic';
            }
        }
        
        function toggleUnderline() {
            if (currentEditingElement) {
                const current = currentEditingElement.style.textDecoration;
                currentEditingElement.style.textDecoration = current.includes('underline') ? 'none' : 'underline';
            }
        }
        
        function changeTextColor(color) {
            if (currentEditingElement) {
                currentEditingElement.style.color = color;
            }
        }
        
        function alignText(alignment) {
            if (currentEditingElement) {
                currentEditingElement.style.textAlign = alignment;
            }
        }
        
        // Mobile Fullscreen Preview Functions - CapCut Style
        function toggleFullscreenPreview() {
            const fullscreen = document.getElementById('fullscreenPreview');
            const canvas = document.getElementById('mainCanvas');
            const fullscreenCanvas = document.getElementById('fullscreenCanvas');
            
            // Copy current canvas content to fullscreen iframe
            const canvasContent = canvas.innerHTML;
            fullscreenCanvas.srcdoc = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <style>
                        body { margin: 0; padding: 20px; font-family: Inter, sans-serif; background: white; }
                        * { box-sizing: border-box; }
                    </style>
                </head>
                <body>
                    ${canvasContent}
                </body>
                </html>
            `;
            
            fullscreen.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeFullscreenPreview() {
            const fullscreen = document.getElementById('fullscreenPreview');
            fullscreen.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        // Handle escape key to close fullscreen
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeFullscreenPreview();
            }
        });

        // AI Assistant Functions
        let userAiCredits = 0;
        
        async function loadAiCredits() {
            try {
                const auth = firebase.auth();
                if (!auth.currentUser) {
                    document.getElementById('aiCreditsCount').textContent = '0';
                    return;
                }
                
                const idToken = await auth.currentUser.getIdToken();
                const response = await fetch('/api/ai/credits', {
                    headers: {
                        'Authorization': `Bearer ${idToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    userAiCredits = data.credits;
                    document.getElementById('aiCreditsCount').textContent = userAiCredits;
                } else {
                    document.getElementById('aiCreditsCount').textContent = '0';
                }
            } catch (error) {
                console.error('Failed to load AI credits:', error);
                document.getElementById('aiCreditsCount').textContent = '0';
            }
        }
        
        function toggleAIAssistant() {
            const panel = document.getElementById('aiPanel');
            panel.classList.toggle('active');
            
            // Load credits when panel opens
            if (panel.classList.contains('active')) {
                loadAiCredits();
            }
        }
        
        async function showCreditsPurchase() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: var(--bg-primary);
                    border-radius: 12px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                ">
                    <h2 style="color: var(--accent-gold); margin-bottom: 20px; text-align: center;">
                        üí≥ Purchase AI Credits
                    </h2>
                    
                    <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                        <div class="credit-package" data-package="small" onclick="selectPackage(this, 'small')" style="
                            border: 2px solid var(--border-color);
                            border-radius: 12px;
                            padding: 25px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            position: relative;
                            background: var(--bg-secondary);
                        ">
                            <div style="
                                position: absolute;
                                top: -10px;
                                right: 15px;
                                background: var(--accent-gold);
                                color: white;
                                padding: 4px 12px;
                                border-radius: 20px;
                                font-size: 11px;
                                font-weight: 600;
                                opacity: 0;
                            ">STARTER</div>
                            <h3 style="color: var(--accent-gold); margin: 0 0 10px 0; font-size: 18px;">Starter Pack</h3>
                            <div style="font-size: 32px; font-weight: bold; margin: 15px 0; color: var(--text-primary);">50 Credits</div>
                            <div style="font-size: 20px; color: var(--accent-gold); font-weight: 600;">$5.00</div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">$0.10 per credit</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 10px; line-height: 1.4;">Perfect for trying out AI features</div>
                        </div>
                        
                        <div class="credit-package" data-package="medium" onclick="selectPackage(this, 'medium')" style="
                            border: 3px solid var(--accent-gold);
                            border-radius: 12px;
                            padding: 25px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            background: rgba(212, 175, 55, 0.08);
                            position: relative;
                            transform: scale(1.05);
                            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.3);
                        ">
                            <div style="
                                position: absolute;
                                top: -10px;
                                right: 15px;
                                background: var(--accent-gold);
                                color: white;
                                padding: 4px 12px;
                                border-radius: 20px;
                                font-size: 11px;
                                font-weight: 600;
                            ">POPULAR</div>
                            <h3 style="color: var(--accent-gold); margin: 0 0 10px 0; font-size: 18px;">Popular Choice</h3>
                            <div style="font-size: 32px; font-weight: bold; margin: 15px 0; color: var(--text-primary);">150 Credits</div>
                            <div style="font-size: 20px; color: var(--accent-gold); font-weight: 600;">$15.00</div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">$0.10 per credit</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 10px; line-height: 1.4;">Great for regular website building</div>
                        </div>
                        
                        <div class="credit-package" data-package="large" onclick="selectPackage(this, 'large')" style="
                            border: 2px solid var(--border-color);
                            border-radius: 12px;
                            padding: 25px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            background: var(--bg-secondary);
                            position: relative;
                        ">
                            <div style="
                                position: absolute;
                                top: -10px;
                                right: 15px;
                                background: #28a745;
                                color: white;
                                padding: 4px 12px;
                                border-radius: 20px;
                                font-size: 11px;
                                font-weight: 600;
                            ">BEST VALUE</div>
                            <h3 style="color: var(--accent-gold); margin: 0 0 10px 0; font-size: 18px;">Pro Pack</h3>
                            <div style="font-size: 32px; font-weight: bold; margin: 15px 0; color: var(--text-primary);">350 Credits</div>
                            <div style="font-size: 20px; color: var(--accent-gold); font-weight: 600;">$30.00</div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">$0.086 per credit</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 10px; line-height: 1.4;">Best deal for power users</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="modal.remove()" style="
                            background: var(--bg-secondary);
                            color: var(--text-primary);
                            border: 1px solid var(--border-color);
                            padding: 12px 24px;
                            border-radius: 6px;
                            cursor: pointer;
                        ">Cancel</button>
                        
                        <button id="purchaseBtn" onclick="purchaseCredits()" disabled style="
                            background: var(--accent-gold);
                            color: var(--bg-primary);
                            border: none;
                            padding: 12px 24px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 500;
                            opacity: 0.5;
                        ">Purchase Credits</button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal-overlay';
            document.body.appendChild(modal);
            
            // Make functions available to modal
            window.selectedPackage = null;
            window.selectPackage = function(element, packageType) {
                modal.querySelectorAll('.credit-package').forEach(p => {
                    p.style.background = 'transparent';
                    p.style.borderColor = 'var(--border-color)';
                });
                
                element.style.background = 'rgba(212, 175, 55, 0.2)';
                element.style.borderColor = 'var(--accent-gold)';
                
                const purchaseBtn = modal.querySelector('#purchaseBtn');
                purchaseBtn.disabled = false;
                purchaseBtn.style.opacity = '1';
                window.selectedPackage = packageType;
            };
            
            window.purchaseCredits = async function() {
                if (!window.selectedPackage) return;
                
                const purchaseBtn = document.getElementById('purchaseBtn');
                purchaseBtn.disabled = true;
                purchaseBtn.textContent = 'Processing...';
                
                try {
                    // Get Firebase token for authentication
                    const auth = firebase.auth();
                    if (!auth.currentUser) {
                        throw new Error('Please log in to purchase credits');
                    }
                    const idToken = await auth.currentUser.getIdToken();
                    
                    // Create payment intent
                    const response = await fetch('/api/ai/purchase-credits', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${idToken}`
                        },
                        body: JSON.stringify({ creditsPackage: window.selectedPackage })
                    });
                    
                    const data = await response.json();
                    console.log('Purchase response:', data);
                    
                    if (!response.ok) {
                        throw new Error(data.error || data.message || 'Purchase request failed');
                    }
                    
                    if (data.success && data.clientSecret) {
                        // Initialize Stripe if not already done
                        if (!window.stripe) {
                            // Load Stripe dynamically
                            const stripeScript = document.createElement('script');
                            stripeScript.src = 'https://js.stripe.com/v3/';
                            document.head.appendChild(stripeScript);
                            
                            await new Promise(resolve => {
                                stripeScript.onload = resolve;
                            });
                            
                            // Get the Stripe public key from the server
                            const keyResponse = await fetch('/api/stripe/public-key');
                            const keyData = await keyResponse.json();
                            window.stripe = Stripe(keyData.publicKey);
                        }
                        
                        // Redirect to Stripe Checkout
                        const { error } = await window.stripe.confirmPayment({
                            clientSecret: data.clientSecret,
                            confirmParams: {
                                return_url: window.location.origin + '/website-builder.html?payment=success'
                            }
                        });
                        
                        if (error) {
                            showNotification('Payment failed: ' + error.message, 'error');
                            purchaseBtn.disabled = false;
                            purchaseBtn.textContent = 'Purchase Credits';
                        }
                    } else {
                        showNotification('Payment setup failed. Please try again.', 'error');
                        purchaseBtn.disabled = false;
                        purchaseBtn.textContent = 'Purchase Credits';
                    }
                } catch (error) {
                    console.error('Payment error:', error);
                    let errorMessage = 'Payment error. Please try again.';
                    
                    if (error.message) {
                        errorMessage = error.message;
                    } else if (typeof error === 'string') {
                        errorMessage = error;
                    }
                    
                    showNotification(errorMessage, 'error');
                    purchaseBtn.disabled = false;
                    purchaseBtn.textContent = 'Purchase Credits';
                }
            };
        }
        
        async function processAIRequest() {
            const prompt = document.querySelector('.ai-prompt-input').value;
            if (!prompt.trim()) {
                showNotification('Please enter a request for the AI assistant.', 'warning');
                return;
            }
            
            // Check credits first
            if (userAiCredits < 1) {
                showNotification('You need AI credits to use this feature. Click "Buy More" to purchase credits.', 'error');
                return;
            }
            
            showLoading('AI is processing your request...');
            
            try {
                const auth = firebase.auth();
                if (!auth.currentUser) {
                    throw new Error('Please log in to use AI features');
                }
                const idToken = await auth.currentUser.getIdToken();
                
                const response = await fetch('/api/ai/process-page-request', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${idToken}`
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        currentPage: getCurrentPageContent(),
                        pageType: getCurrentPageType()
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    applyAIChanges(data.content);
                    
                    // Update credits display
                    userAiCredits = data.remainingCredits || (userAiCredits - 1);
                    document.getElementById('aiCreditsCount').textContent = userAiCredits;
                    
                    showNotification(`AI changes applied! ${userAiCredits} credits remaining.`, 'success');
                    document.querySelector('.ai-prompt-input').value = '';
                } else if (response.status === 402) {
                    showNotification('Insufficient AI credits. Purchase more credits to continue.', 'error');
                    loadAiCredits(); // Refresh credits display
                } else {
                    showNotification('AI request failed: ' + data.error, 'error');
                }
            } catch (error) {
                console.error('AI request error:', error);
                showNotification('AI request failed. Please try again.', 'error');
            }
            
            hideLoading();
        }
        
        function quickAIAction(action) {
            const prompts = {
                luxury: 'Make this page more luxury and elegant with premium styling, gold accents, and sophisticated typography',
                modern: 'Transform this page to be modern and minimal with clean lines, plenty of white space, and contemporary design',
                gallery: 'Add a stunning photo gallery section with grid layout and hover effects',
                pricing: 'Add a professional pricing section with 3 package tiers and call-to-action buttons',
                testimonials: 'Add a client testimonials section with quotes and star ratings',
                contact: 'Enhance the contact section with a professional form and contact information'
            };
            
            document.querySelector('.ai-prompt-input').value = prompts[action];
            processAIRequest();
        }
        
        function applyAIChanges(content) {
            const canvas = document.getElementById('mainCanvas');
            const canvasContent = canvas.querySelector('.canvas-content');
            canvasContent.innerHTML = content;
            
            // Re-enable editing for new content
            makeAllTextEditable();
        }
        
        function getCurrentPageContent() {
            const canvas = document.getElementById('mainCanvas');
            return canvas.innerHTML;
        }
        
        function getCurrentPageType() {
            const activePageItem = document.querySelector('.page-item.active');
            return activePageItem ? activePageItem.dataset.page : 'home';
        }
        
        function makeAllTextEditable() {
            const canvas = document.getElementById('mainCanvas');
            const textElements = canvas.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, div');
            
            textElements.forEach(element => {
                if (!element.querySelector('img') && !element.querySelector('button') && !element.querySelector('input')) {
                    element.setAttribute('contenteditable', 'true');
                    element.setAttribute('onclick', 'showTextToolbar(this)');
                    element.style.outline = 'none';
                    element.style.border = '2px dashed transparent';
                }
            });
        }
        
        // Close toolbar when clicking outside
        document.addEventListener('click', function(e) {
            const toolbar = document.getElementById('textToolbar');
            const aiPanel = document.getElementById('aiPanel');
            
            if (!toolbar.contains(e.target) && !e.target.matches('[contenteditable="true"]')) {
                hideTextToolbar();
            }
        });
        
        function previewSite() {
            const previewWindow = window.open('', '_blank');
            const previewHTML = generatePreviewHTML();
            previewWindow.document.write(previewHTML);
            previewWindow.document.close();
        }
        
        async function intelligentGeneration(prompt) {
            // Smart prompt analysis and content generation
            const templateType = detectTemplateFromPrompt(prompt);
            const style = detectStyleFromPrompt(prompt);
            const businessInfo = extractBusinessInfo(prompt);
            
            return {
                pages: generateIntelligentContent(templateType, style, businessInfo),
                settings: {
                    primaryColor: getColorFromStyle(style),
                    typography: getTypographyFromStyle(style),
                    siteTitle: businessInfo.name || 'Photography Studio'
                }
            };
        }
        
        function detectTemplateFromPrompt(prompt) {
            const lower = prompt.toLowerCase();
            if (lower.includes('wedding') || lower.includes('bride') || lower.includes('ceremony')) return 'wedding';
            if (lower.includes('portrait') || lower.includes('headshot') || lower.includes('professional')) return 'portrait';
            if (lower.includes('fashion') || lower.includes('editorial') || lower.includes('model')) return 'fashion';
            if (lower.includes('commercial') || lower.includes('business') || lower.includes('corporate')) return 'commercial';
            return 'portrait'; // default
        }
        
        function detectStyleFromPrompt(prompt) {
            const lower = prompt.toLowerCase();
            if (lower.includes('elegant') || lower.includes('luxury') || lower.includes('sophisticated')) return 'elegant';
            if (lower.includes('modern') || lower.includes('minimal') || lower.includes('clean')) return 'modern';
            if (lower.includes('bold') || lower.includes('dramatic') || lower.includes('striking')) return 'bold';
            if (lower.includes('natural') || lower.includes('organic') || lower.includes('earthy')) return 'natural';
            return 'elegant'; // default
        }
        
        function extractBusinessInfo(prompt) {
            // Simple extraction - could be enhanced with regex
            const lines = prompt.split('\n');
            return {
                name: lines.find(line => line.includes('called') || line.includes('named'))?.split(/called|named/)[1]?.trim() || 'Photography Studio',
                description: prompt.slice(0, 200) + '...'
            };
        }
        
        function getColorFromStyle(style) {
            const colors = {
                elegant: '#d4af37',
                modern: '#2c3e50',
                bold: '#e74c3c',
                natural: '#27ae60'
            };
            return colors[style] || '#d4af37';
        }
        
        function getTypographyFromStyle(style) {
            const fonts = {
                elegant: 'playfair',
                modern: 'inter',
                bold: 'montserrat',
                natural: 'lora'
            };
            return fonts[style] || 'inter';
        }
        
        function generateIntelligentContent(templateType, style, businessInfo) {
            const content = generateTemplateContent(templateType, 'home');
            const pages = {};
            
            // Generate content for all pages
            currentProject.pages.forEach(page => {
                pages[page] = generateTemplateContent(templateType, page);
            });
            
            return pages;
        }
        
        function publishSite() {
            showLoading('Publishing your website...', 'Optimizing and deploying to production servers');
            
            // Simulate publishing process
            setTimeout(() => {
                const publishedData = {
                    ...currentProject,
                    publishedAt: new Date().toISOString(),
                    url: `https://${currentProject.name.toLowerCase().replace(/\s+/g, '-')}.photomanagementsystem.com`
                };
                
                // Save to localStorage as published version
                localStorage.setItem('published_website', JSON.stringify(publishedData));
                
                hideLoading();
                showNotification('Website published successfully!', 'success');
                
                // Show publish success modal
                showPublishSuccess(publishedData.url);
            }, 3000);
        }
        
        function showPublishSuccess(url) {
            const modal = document.createElement('div');
            modal.className = 'loading-overlay';
            modal.innerHTML = `
                <div class="loading-content">
                    <i class="fas fa-check-circle" style="font-size: 48px; color: var(--success); margin-bottom: 20px;"></i>
                    <div class="status-message">Website Published Successfully!</div>
                    <div class="status-detail" style="margin: 20px 0;">Your website is now live at:</div>
                    <div style="background: var(--bg-tertiary); padding: 10px; border-radius: 4px; font-family: monospace; margin: 20px 0;">${url}</div>
                    <button class="btn btn-primary" onclick="this.closest('.loading-overlay').remove()" style="margin-top: 20px;">Continue Editing</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function generatePreviewHTML() {
            let fullHTML = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${currentProject.settings.siteTitle}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@300;400;700&display=swap" rel="stylesheet">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Inter', sans-serif; }
                        .page { display: none; }
                        .page.active { display: block; }
                    </style>
                </head>
                <body>
            `;
            
            currentProject.pages.forEach(page => {
                const content = currentProject.pageData?.[page] || `<div><h1>${page} Page</h1></div>`;
                fullHTML += `<div class="page ${page === 'home' ? 'active' : ''}" id="${page}">${content}</div>`;
            });
            
            fullHTML += `
                </body>
                </html>
            `;
            
            return fullHTML;
        }
        
        // Add hover effects for gallery items
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effects for photo upload areas
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
                
                .gallery-item:hover div,
                .photo-section:hover div {
                    opacity: 1 !important;
                }
                
                [contenteditable="true"]:hover {
                    border: 2px dashed #d4af37 !important;
                }
                
                [contenteditable="true"]:focus {
                    border: 2px solid #d4af37 !important;
                    outline: none;
                }
            `;
            document.head.appendChild(style);
        });
        
        // Mobile Toolbar Functions
        function openColorPicker() {
            // Create color picker modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            const currentColor = currentProject.settings.primaryColor || '#d4af37';
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; width: 90%;">
                    <h3 style="margin: 0 0 20px 0; color: #333;">Choose Primary Color</h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div class="color-option" data-color="#d4af37" style="width: 60px; height: 60px; background: #d4af37; border-radius: 8px; cursor: pointer; border: 3px solid ${currentColor === '#d4af37' ? '#333' : 'transparent'};"></div>
                        <div class="color-option" data-color="#2c3e50" style="width: 60px; height: 60px; background: #2c3e50; border-radius: 8px; cursor: pointer; border: 3px solid ${currentColor === '#2c3e50' ? '#333' : 'transparent'};"></div>
                        <div class="color-option" data-color="#e74c3c" style="width: 60px; height: 60px; background: #e74c3c; border-radius: 8px; cursor: pointer; border: 3px solid ${currentColor === '#e74c3c' ? '#333' : 'transparent'};"></div>
                        <div class="color-option" data-color="#27ae60" style="width: 60px; height: 60px; background: #27ae60; border-radius: 8px; cursor: pointer; border: 3px solid ${currentColor === '#27ae60' ? '#333' : 'transparent'};"></div>
                        <div class="color-option" data-color="#8e44ad" style="width: 60px; height: 60px; background: #8e44ad; border-radius: 8px; cursor: pointer; border: 3px solid ${currentColor === '#8e44ad' ? '#333' : 'transparent'};"></div>
                        <div class="color-option" data-color="#f39c12" style="width: 60px; height: 60px; background: #f39c12; border-radius: 8px; cursor: pointer; border: 3px solid ${currentColor === '#f39c12' ? '#333' : 'transparent'};"></div>
                        <div class="color-option" data-color="#34495e" style="width: 60px; height: 60px; background: #34495e; border-radius: 8px; cursor: pointer; border: 3px solid ${currentColor === '#34495e' ? '#333' : 'transparent'};"></div>
                        <div class="color-option" data-color="#95a5a6" style="width: 60px; height: 60px; background: #95a5a6; border-radius: 8px; cursor: pointer; border: 3px solid ${currentColor === '#95a5a6' ? '#333' : 'transparent'};"></div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="this.closest('.color-picker-modal').remove()" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 6px; cursor: pointer;">Cancel</button>
                        <button id="applyColorBtn" style="padding: 10px 20px; background: #d4af37; color: white; border: none; border-radius: 6px; cursor: pointer;">Apply</button>
                    </div>
                </div>
            `;
            
            modal.className = 'color-picker-modal';
            document.body.appendChild(modal);
            
            let selectedColor = currentColor;
            
            // Color selection logic
            modal.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    modal.querySelectorAll('.color-option').forEach(opt => opt.style.border = '3px solid transparent');
                    this.style.border = '3px solid #333';
                    selectedColor = this.dataset.color;
                });
            });
            
            // Apply button logic
            modal.querySelector('#applyColorBtn').addEventListener('click', function() {
                currentProject.settings.primaryColor = selectedColor;
                updateCanvasColors(selectedColor);
                showNotification('Color scheme updated!', 'success');
                modal.remove();
            });
            
            // Close on outside click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        function openTypography() {
            // Create typography modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            const currentFont = currentProject.settings.typography || 'inter';
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; width: 90%;">
                    <h3 style="margin: 0 0 20px 0; color: #333;">Choose Typography</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px;">
                        <div class="font-option" data-font="inter" style="padding: 15px; border: 2px solid ${currentFont === 'inter' ? '#d4af37' : '#ddd'}; border-radius: 8px; cursor: pointer; font-family: Inter, sans-serif;">
                            <div style="font-weight: 600; font-size: 18px;">Inter</div>
                            <div style="color: #666; font-size: 14px;">Modern & Clean</div>
                        </div>
                        <div class="font-option" data-font="playfair" style="padding: 15px; border: 2px solid ${currentFont === 'playfair' ? '#d4af37' : '#ddd'}; border-radius: 8px; cursor: pointer; font-family: 'Playfair Display', serif;">
                            <div style="font-weight: 600; font-size: 18px;">Playfair Display</div>
                            <div style="color: #666; font-size: 14px;">Elegant & Sophisticated</div>
                        </div>
                        <div class="font-option" data-font="montserrat" style="padding: 15px; border: 2px solid ${currentFont === 'montserrat' ? '#d4af37' : '#ddd'}; border-radius: 8px; cursor: pointer; font-family: Montserrat, sans-serif;">
                            <div style="font-weight: 600; font-size: 18px;">Montserrat</div>
                            <div style="color: #666; font-size: 14px;">Bold & Strong</div>
                        </div>
                        <div class="font-option" data-font="lora" style="padding: 15px; border: 2px solid ${currentFont === 'lora' ? '#d4af37' : '#ddd'}; border-radius: 8px; cursor: pointer; font-family: Lora, serif;">
                            <div style="font-weight: 600; font-size: 18px;">Lora</div>
                            <div style="color: #666; font-size: 14px;">Natural & Warm</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="this.closest('.typography-modal').remove()" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 6px; cursor: pointer;">Cancel</button>
                        <button id="applyFontBtn" style="padding: 10px 20px; background: #d4af37; color: white; border: none; border-radius: 6px; cursor: pointer;">Apply</button>
                    </div>
                </div>
            `;
            
            modal.className = 'typography-modal';
            document.body.appendChild(modal);
            
            let selectedFont = currentFont;
            
            // Font selection logic
            modal.querySelectorAll('.font-option').forEach(option => {
                option.addEventListener('click', function() {
                    modal.querySelectorAll('.font-option').forEach(opt => opt.style.border = '2px solid #ddd');
                    this.style.border = '2px solid #d4af37';
                    selectedFont = this.dataset.font;
                });
            });
            
            // Apply button logic
            modal.querySelector('#applyFontBtn').addEventListener('click', function() {
                currentProject.settings.typography = selectedFont;
                updateCanvasTypography(selectedFont);
                showNotification('Typography updated!', 'success');
                modal.remove();
            });
            
            // Close on outside click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        // Enhanced applyTemplate function for mobile
        function applyTemplate() {
            const selectedTemplate = document.querySelector('.template-card.selected');
            if (!selectedTemplate) {
                // If no template selected, show template options
                const templates = document.querySelectorAll('.template-card');
                templates.forEach(card => {
                    card.addEventListener('click', function() {
                        // Remove previous selection
                        templates.forEach(c => c.classList.remove('selected'));
                        // Add selection to clicked template
                        this.classList.add('selected');
                        this.style.background = 'var(--accent-gold)';
                        this.style.color = 'var(--bg-primary)';
                    });
                });
                showNotification('Please select a template first by clicking on it, then try again.', 'warning');
                return;
            }
            
            const templateType = selectedTemplate.dataset.template;
            
            // Use the template system from the other function
            const templates = {
                wedding: {
                    home: generateEditableContent('wedding', 'home'),
                    about: generateEditableContent('wedding', 'about'),
                    portfolio: generateEditableContent('wedding', 'portfolio'),
                    contact: generateEditableContent('wedding', 'contact')
                },
                portrait: {
                    home: generateEditableContent('portrait', 'home'),
                    about: generateEditableContent('portrait', 'about'),
                    portfolio: generateEditableContent('portrait', 'portfolio'),
                    contact: generateEditableContent('portrait', 'contact')
                },
                fashion: {
                    home: generateEditableContent('fashion', 'home'),
                    about: generateEditableContent('fashion', 'about'),
                    portfolio: generateEditableContent('fashion', 'portfolio'),
                    contact: generateEditableContent('fashion', 'contact')
                },
                commercial: {
                    home: generateEditableContent('commercial', 'home'),
                    about: generateEditableContent('commercial', 'about'),
                    portfolio: generateEditableContent('commercial', 'portfolio'),
                    contact: generateEditableContent('commercial', 'contact')
                }
            };
            
            if (templateType && templates[templateType]) {
                currentProject.pageData = templates[templateType];
                
                // Apply the template to the live canvas immediately
                const currentPage = getCurrentPageType();
                const pageContent = templates[templateType][currentPage];
                if (pageContent) {
                    const canvas = document.querySelector('.canvas-content');
                    if (canvas) {
                        canvas.innerHTML = pageContent;
                        makeAllTextEditable();
                        initializeDraggableElements();
                    }
                }
                
                showNotification(`${templateType.charAt(0).toUpperCase() + templateType.slice(1)} template applied successfully!`, 'success');
                console.log(`Applied ${templateType} template`);
            } else {
                showNotification('Template not found. Please try another template.', 'error');
            }
        }
        
        // Drag and Drop Functionality
        let draggedElement = null;
        let dragOffset = { x: 0, y: 0 };
        
        function makeDraggable(element) {
            const dragHandle = element.querySelector('.drag-handle');
            
            // Mouse events
            dragHandle.addEventListener('mousedown', startDrag);
            
            // Touch events for mobile
            dragHandle.addEventListener('touchstart', startDrag, { passive: false });
            
            function startDrag(e) {
                e.preventDefault();
                draggedElement = element;
                element.classList.add('dragging');
                
                const rect = element.getBoundingClientRect();
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                dragOffset.x = clientX - rect.left;
                dragOffset.y = clientY - rect.top;
                
                document.addEventListener('mousemove', handleDrag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchmove', handleDrag, { passive: false });
                document.addEventListener('touchend', stopDrag);
            }
            
            function handleDrag(e) {
                if (!draggedElement) return;
                e.preventDefault();
                
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                const canvas = document.querySelector('.canvas-content');
                const canvasRect = canvas.getBoundingClientRect();
                
                let newX = clientX - canvasRect.left - dragOffset.x;
                let newY = clientY - canvasRect.top - dragOffset.y;
                
                // Keep within canvas bounds
                newX = Math.max(0, Math.min(newX, canvasRect.width - draggedElement.offsetWidth));
                newY = Math.max(0, Math.min(newY, canvasRect.height - draggedElement.offsetHeight));
                
                draggedElement.style.position = 'absolute';
                draggedElement.style.left = newX + 'px';
                draggedElement.style.top = newY + 'px';
                draggedElement.style.margin = '0';
            }
            
            function stopDrag() {
                if (draggedElement) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                }
                
                document.removeEventListener('mousemove', handleDrag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', handleDrag);
                document.removeEventListener('touchend', stopDrag);
            }
        }
        
        // Element Control Functions
        function deleteElement(button) {
            const element = button.closest('.draggable-element');
            if (element && confirm('Delete this element?')) {
                element.remove();
                showNotification('Element deleted', 'success');
            }
        }
        
        function duplicateElement(button) {
            const element = button.closest('.draggable-element');
            if (element) {
                const clone = element.cloneNode(true);
                const rect = element.getBoundingClientRect();
                
                // Position slightly offset from original
                clone.style.position = 'absolute';
                clone.style.left = (element.offsetLeft + 20) + 'px';
                clone.style.top = (element.offsetTop + 20) + 'px';
                
                element.parentNode.appendChild(clone);
                makeDraggable(clone);
                showNotification('Element duplicated', 'success');
            }
        }
        
        // Make existing elements draggable on page load
        function initializeDraggableElements() {
            document.querySelectorAll('.draggable-element').forEach(element => {
                makeDraggable(element);
            });
        }
        
        // Initialize drag functionality when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDraggableElements();
            
            // Clean up any lingering modals on page load
            cleanupModals();
        });
        
        // Function to clean up any stuck modals
        function cleanupModals() {
            const modals = document.querySelectorAll('.color-picker-modal, .typography-modal, .loading-overlay');
            modals.forEach(modal => {
                if (modal && modal.parentNode) {
                    modal.remove();
                }
            });
        }
        
        // Add escape key handler to close stuck modals
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                cleanupModals();
            }
        });
        
        // Add click handler to clean up modals when clicking outside
        document.addEventListener('click', function(e) {
            // If clicked element has the modal background styles, remove it
            if (e.target.style.background && e.target.style.background.includes('rgba(0,0,0,0.8)')) {
                e.target.remove();
            }
            
            // Also check for any elements with high z-index that might be stuck overlays
            const style = window.getComputedStyle(e.target);
            if (style.position === 'fixed' && parseInt(style.zIndex) >= 10000 && 
                style.background && style.background.includes('rgba(0, 0, 0, 0.8)')) {
                e.target.remove();
            }
        });
        
        // Add missing updateCanvas function
        function updateCanvas() {
            const currentPage = getCurrentPageType();
            const canvas = document.querySelector('.canvas-content');
            
            if (currentProject.pageData && currentProject.pageData[currentPage] && canvas) {
                canvas.innerHTML = currentProject.pageData[currentPage];
                makeAllTextEditable();
                initializeDraggableElements();
            }
        }
        
        // Add page switching functionality
        function switchToPage(pageType) {
            // Save current page content
            const currentPage = getCurrentPageType();
            const canvas = document.querySelector('.canvas-content');
            if (canvas && currentProject.pageData) {
                currentProject.pageData[currentPage] = canvas.innerHTML;
            }
            
            // Update active page
            document.querySelectorAll('.page-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === pageType) {
                    item.classList.add('active');
                }
            });
            
            // Load new page content
            if (currentProject.pageData && currentProject.pageData[pageType] && canvas) {
                canvas.innerHTML = currentProject.pageData[pageType];
                makeAllTextEditable();
                initializeDraggableElements();
            } else {
                // Create default content if page doesn't exist
                canvas.innerHTML = generateEditableContent('default', pageType);
                makeAllTextEditable();
                initializeDraggableElements();
            }
        }
        
        // Additional helper functions for website builder
        function updateCanvasColors(color) {
            const canvas = document.querySelector('.canvas-content');
            if (!canvas) return;
            
            // Update button colors
            const buttons = canvas.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.style.backgroundColor = color;
            });
            
            // Update accent elements
            const accentElements = canvas.querySelectorAll('.accent, .highlight, .primary-color');
            accentElements.forEach(el => {
                el.style.color = color;
            });
            
            // Update border colors
            const borderElements = canvas.querySelectorAll('.border-accent');
            borderElements.forEach(el => {
                el.style.borderColor = color;
            });
        }
        
        function updateCanvasTypography(fontFamily) {
            const canvas = document.querySelector('.canvas-content');
            if (!canvas) return;
            
            const fontMap = {
                'inter': 'Inter, system-ui, sans-serif',
                'playfair': '"Playfair Display", serif',
                'montserrat': 'Montserrat, sans-serif',
                'lora': 'Lora, serif',
                'crimson': '"Crimson Text", serif'
            };
            
            const selectedFont = fontMap[fontFamily] || fontMap.inter;
            
            // Apply to headings
            const headings = canvas.querySelectorAll('h1, h2, h3, h4, h5, h6');
            headings.forEach(heading => {
                heading.style.fontFamily = selectedFont;
            });
            
            // Apply to body text
            const bodyTexts = canvas.querySelectorAll('p, span, div, li');
            bodyTexts.forEach(text => {
                if (!text.querySelector('h1, h2, h3, h4, h5, h6')) {
                    text.style.fontFamily = selectedFont;
                }
            });
        }
        
        function generateEditableContent(templateType, pageType) {
            const templates = {
                wedding: {
                    home: `
                        <div style="text-align: center; padding: 80px 20px; background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);">
                            <h1 style="font-size: 3.5rem; margin-bottom: 20px; color: #333; font-family: 'Playfair Display', serif;">Capturing Love Stories</h1>
                            <p style="font-size: 1.2rem; margin-bottom: 30px; color: #666; max-width: 600px; margin-left: auto; margin-right: auto;">Professional wedding photography that preserves your most precious moments with timeless elegance and artistry.</p>
                            <button style="background: #d4af37; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 1.1rem; cursor: pointer;">View Portfolio</button>
                        </div>
                        <div style="padding: 60px 20px; max-width: 1200px; margin: 0 auto;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px; align-items: center;">
                                <div>
                                    <h2 style="font-size: 2.5rem; margin-bottom: 20px; color: #333;">Your Perfect Day</h2>
                                    <p style="font-size: 1.1rem; line-height: 1.6; color: #666; margin-bottom: 20px;">From the intimate moments of preparation to the joyous celebration, we capture every emotion and detail that makes your wedding uniquely yours.</p>
                                    <ul style="list-style: none; padding: 0;">
                                        <li style="margin-bottom: 10px; color: #d4af37;">‚úì Full day wedding coverage</li>
                                        <li style="margin-bottom: 10px; color: #d4af37;">‚úì Engagement session included</li>
                                        <li style="margin-bottom: 10px; color: #d4af37;">‚úì Professional editing</li>
                                        <li style="margin-bottom: 10px; color: #d4af37;">‚úì Online gallery delivery</li>
                                    </ul>
                                </div>
                                <div style="text-align: center;">
                                    <div style="width: 100%; height: 300px; background: #f0f0f0; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #999;">
                                        Wedding Photo Gallery
                                    </div>
                                </div>
                            </div>
                        </div>
                    `,
                    about: `
                        <div style="padding: 80px 20px; max-width: 1000px; margin: 0 auto; text-align: center;">
                            <h1 style="font-size: 3rem; margin-bottom: 30px; color: #333;">About Our Studio</h1>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px; align-items: center; margin-top: 50px;">
                                <div style="text-align: center;">
                                    <div style="width: 250px; height: 250px; background: #f0f0f0; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; color: #999;">
                                        Studio Photo
                                    </div>
                                </div>
                                <div style="text-align: left;">
                                    <h2 style="font-size: 2rem; margin-bottom: 20px; color: #333;">Passionate About Love</h2>
                                    <p style="font-size: 1.1rem; line-height: 1.6; color: #666; margin-bottom: 20px;">With over 10 years of experience capturing love stories, we believe every couple deserves photography that reflects their unique journey together.</p>
                                    <p style="font-size: 1.1rem; line-height: 1.6; color: #666;">Our approach is natural, emotional, and timeless - creating images you'll treasure for generations to come.</p>
                                </div>
                            </div>
                        </div>
                    `,
                    portfolio: `
                        <div style="padding: 80px 20px; text-align: center;">
                            <h1 style="font-size: 3rem; margin-bottom: 50px; color: #333;">Wedding Portfolio</h1>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto;">
                                ${Array.from({length: 6}, (_, i) => `
                                    <div style="height: 300px; background: #f0f0f0; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #999; cursor: pointer;" onclick="openLightbox(this)">
                                        Wedding Photo ${i + 1}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `,
                    contact: `
                        <div style="padding: 80px 20px; max-width: 800px; margin: 0 auto;">
                            <h1 style="font-size: 3rem; margin-bottom: 30px; text-align: center; color: #333;">Let's Capture Your Story</h1>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px;">
                                <div>
                                    <h3 style="font-size: 1.5rem; margin-bottom: 20px; color: #333;">Get In Touch</h3>
                                    <div style="margin-bottom: 15px;">
                                        <strong>Email:</strong> hello@weddingphotography.com
                                    </div>
                                    <div style="margin-bottom: 15px;">
                                        <strong>Phone:</strong> (555) 123-4567
                                    </div>
                                    <div style="margin-bottom: 15px;">
                                        <strong>Studio:</strong> Downtown Photography District
                                    </div>
                                </div>
                                <div>
                                    <form style="display: flex; flex-direction: column; gap: 15px;">
                                        <input type="text" placeholder="Your Name" style="padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
                                        <input type="email" placeholder="Your Email" style="padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
                                        <input type="date" placeholder="Wedding Date" style="padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
                                        <textarea placeholder="Tell us about your vision..." rows="4" style="padding: 15px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
                                        <button type="submit" style="background: #d4af37; color: white; padding: 15px; border: none; border-radius: 5px; cursor: pointer;">Send Message</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    `
                },
                portrait: {
                    home: `
                        <div style="text-align: center; padding: 80px 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                            <h1 style="font-size: 3.5rem; margin-bottom: 20px; color: #2c3e50; font-family: Inter, sans-serif;">Professional Portraits</h1>
                            <p style="font-size: 1.2rem; margin-bottom: 30px; color: #6c757d; max-width: 600px; margin-left: auto; margin-right: auto;">Modern portrait photography that captures your authentic self with confidence and style.</p>
                            <button style="background: #2c3e50; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 1.1rem; cursor: pointer;">Book Session</button>
                        </div>
                    `,
                    about: `
                        <div style="padding: 80px 20px; max-width: 1000px; margin: 0 auto; text-align: center;">
                            <h1 style="font-size: 3rem; margin-bottom: 30px; color: #2c3e50;">About the Photographer</h1>
                            <p style="font-size: 1.2rem; line-height: 1.6; color: #6c757d;">Specializing in contemporary portrait photography with a focus on bringing out the best in every individual.</p>
                        </div>
                    `,
                    portfolio: `
                        <div style="padding: 80px 20px; text-align: center;">
                            <h1 style="font-size: 3rem; margin-bottom: 50px; color: #2c3e50;">Portrait Gallery</h1>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; max-width: 1000px; margin: 0 auto;">
                                ${Array.from({length: 8}, (_, i) => `
                                    <div style="height: 300px; background: #f8f9fa; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #adb5bd;">
                                        Portrait ${i + 1}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `,
                    contact: `
                        <div style="padding: 80px 20px; max-width: 600px; margin: 0 auto; text-align: center;">
                            <h1 style="font-size: 3rem; margin-bottom: 30px; color: #2c3e50;">Let's Create</h1>
                            <p style="margin-bottom: 30px; color: #6c757d;">Ready to capture your professional image? Let's discuss your vision.</p>
                            <div style="margin-bottom: 20px;">
                                <strong>Email:</strong> portraits@studio.com
                            </div>
                            <div style="margin-bottom: 20px;">
                                <strong>Phone:</strong> (555) 987-6543
                            </div>
                        </div>
                    `
                },
                fashion: {
                    home: `
                        <div style="text-align: center; padding: 100px 20px; background: linear-gradient(135deg, #000000 0%, #434343 100%); color: white;">
                            <h1 style="font-size: 4rem; margin-bottom: 20px; font-family: 'Montserrat', sans-serif; font-weight: 700;">FASHION FORWARD</h1>
                            <p style="font-size: 1.3rem; margin-bottom: 40px; max-width: 600px; margin-left: auto; margin-right: auto;">Bold, editorial fashion photography that pushes creative boundaries and defines tomorrow's trends.</p>
                            <button style="background: #e74c3c; color: white; padding: 18px 35px; border: none; border-radius: 0; font-size: 1.1rem; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">View Collections</button>
                        </div>
                    `,
                    about: `
                        <div style="padding: 80px 20px; max-width: 1000px; margin: 0 auto;">
                            <h1 style="font-size: 3.5rem; margin-bottom: 30px; color: #000; text-align: center; font-weight: 700;">EDITORIAL VISION</h1>
                            <p style="font-size: 1.2rem; line-height: 1.6; color: #333; text-align: center;">Creating striking visual narratives that blur the line between fashion and art.</p>
                        </div>
                    `,
                    portfolio: `
                        <div style="padding: 80px 20px; background: #000; color: white;">
                            <h1 style="font-size: 3.5rem; margin-bottom: 50px; text-align: center; font-weight: 700;">COLLECTIONS</h1>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 5px; max-width: 1200px; margin: 0 auto;">
                                ${Array.from({length: 6}, (_, i) => `
                                    <div style="height: 400px; background: #333; display: flex; align-items: center; justify-content: center; color: #999;">
                                        Fashion ${i + 1}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `,
                    contact: `
                        <div style="padding: 80px 20px; max-width: 600px; margin: 0 auto; text-align: center; background: #000; color: white;">
                            <h1 style="font-size: 3rem; margin-bottom: 30px; font-weight: 700;">COLLABORATE</h1>
                            <p style="margin-bottom: 30px;">Ready to create something extraordinary? Let's push boundaries together.</p>
                            <div style="margin-bottom: 20px;">
                                <strong>Email:</strong> fashion@studio.com
                            </div>
                        </div>
                    `
                },
                commercial: {
                    home: `
                        <div style="text-align: center; padding: 80px 20px; background: #f8f9fa;">
                            <h1 style="font-size: 3.5rem; margin-bottom: 20px; color: #27ae60; font-family: 'Lora', serif;">Commercial Photography</h1>
                            <p style="font-size: 1.2rem; margin-bottom: 30px; color: #495057; max-width: 600px; margin-left: auto; margin-right: auto;">Professional commercial photography services that elevate your brand and connect with your audience.</p>
                            <button style="background: #27ae60; color: white; padding: 15px 30px; border: none; border-radius: 25px; font-size: 1.1rem; cursor: pointer;">Start Project</button>
                        </div>
                    `,
                    about: `
                        <div style="padding: 80px 20px; max-width: 1000px; margin: 0 auto; text-align: center;">
                            <h1 style="font-size: 3rem; margin-bottom: 30px; color: #27ae60;">Brand Storytelling</h1>
                            <p style="font-size: 1.2rem; line-height: 1.6; color: #495057;">We create compelling visual content that brings your brand story to life.</p>
                        </div>
                    `,
                    portfolio: `
                        <div style="padding: 80px 20px; text-align: center;">
                            <h1 style="font-size: 3rem; margin-bottom: 50px; color: #27ae60;">Our Work</h1>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; max-width: 1000px; margin: 0 auto;">
                                ${Array.from({length: 6}, (_, i) => `
                                    <div style="height: 250px; background: #e9ecef; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #6c757d;">
                                        Commercial ${i + 1}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `,
                    contact: `
                        <div style="padding: 80px 20px; max-width: 600px; margin: 0 auto; text-align: center;">
                            <h1 style="font-size: 3rem; margin-bottom: 30px; color: #27ae60;">Let's Connect</h1>
                            <p style="margin-bottom: 30px; color: #495057;">Ready to elevate your brand with professional photography?</p>
                            <div style="margin-bottom: 20px;">
                                <strong>Email:</strong> commercial@studio.com
                            </div>
                            <div style="margin-bottom: 20px;">
                                <strong>Phone:</strong> (555) 456-7890
                            </div>
                        </div>
                    `
                }
            };
            
            return templates[templateType]?.[pageType] || '<div style="padding: 80px 20px; text-align: center;"><h1>Page Content</h1><p>This page is ready for your content.</p></div>';
        }
        
        // Initialize Firebase Auth and load user data
        let currentUser = null;
        let userAiCredits = 0;
        
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                currentUser = user;
                loadAiCredits();
                console.log('User signed in:', user.email);
            } else {
                currentUser = null;
                console.log('User not signed in');
                // Don't redirect - let user work with limited functionality
                const creditsElement = document.getElementById('aiCreditsCount');
                if (creditsElement) {
                    creditsElement.textContent = '0';
                }
            }
        });
        
        // Add missing deletePage function
        function deletePage(pageName) {
            if (confirm(`Delete the "${pageName}" page? This cannot be undone.`)) {
                // Remove from currentProject.pages array
                const index = currentProject.pages.indexOf(pageName);
                if (index > -1) {
                    currentProject.pages.splice(index, 1);
                }
                
                // Remove page data
                if (currentProject.pageData && currentProject.pageData[pageName]) {
                    delete currentProject.pageData[pageName];
                }
                
                // Remove from UI
                const pageItem = document.querySelector(`[data-page="${pageName}"]`);
                if (pageItem) {
                    pageItem.remove();
                }
                
                // Switch to home page if deleted page was active
                if (currentProject.currentPage === pageName) {
                    switchToPage('home');
                }
                
                showNotification(`Page "${pageName}" deleted`, 'success');
            }
        }

        // Add missing openTypographyModal function
        function openTypographyModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg-secondary); border-radius: 12px; padding: 30px; max-width: 500px; width: 90%;">
                    <h3 style="margin-bottom: 20px; color: var(--text-primary);">Choose Typography</h3>
                    <div style="display: grid; gap: 15px;">
                        <div class="font-option" data-font="inter" style="padding: 15px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; font-family: Inter;">
                            <h4>Inter</h4>
                            <p>Modern & clean sans-serif</p>
                        </div>
                        <div class="font-option" data-font="playfair" style="padding: 15px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; font-family: 'Playfair Display';">
                            <h4>Playfair Display</h4>
                            <p>Elegant serif for luxury brands</p>
                        </div>
                        <div class="font-option" data-font="montserrat" style="padding: 15px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; font-family: Montserrat;">
                            <h4>Montserrat</h4>
                            <p>Versatile sans-serif</p>
                        </div>
                    </div>
                    <button id="applyFontBtn" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Apply Font</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle font selection
            modal.querySelectorAll('.font-option').forEach(option => {
                option.addEventListener('click', function() {
                    modal.querySelectorAll('.font-option').forEach(opt => opt.style.border = '2px solid #ddd');
                    this.style.border = '2px solid #d4af37';
                });
            });
            
            // Handle apply button
            modal.querySelector('#applyFontBtn').addEventListener('click', function() {
                const selected = modal.querySelector('.font-option[style*="border: 2px solid rgb(212, 175, 55)"]');
                if (selected) {
                    const fontFamily = selected.dataset.font;
                    updateCanvasTypography(fontFamily);
                    showNotification('Typography updated!', 'success');
                }
                modal.remove();
            });
            
            // Close on background click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Make ALL functions globally available for onclick handlers
        window.addTextElement = addTextElement;
        window.addLogoElement = addLogoElement;
        window.triggerPhotoUpload = triggerPhotoUpload;
        window.toggleAIAssistant = toggleAIAssistant;
        window.saveDraft = saveDraft;
        window.previewSite = previewSite;
        window.publishSite = publishSite;
        window.showCreditsPurchase = showCreditsPurchase;
        window.processAIRequest = processAIRequest;
        window.quickAIAction = quickAIAction;
        window.deleteElement = deleteElement;
        window.duplicateElement = duplicateElement;
        window.generateWebsite = generateWebsite;
        window.applyTemplate = applyTemplate;
        window.switchToPage = switchToPage;
        window.addNewPage = addNewPage;
        window.deletePage = deletePage;
        window.initializeDraggableElements = initializeDraggableElements;
        window.makeDraggable = makeDraggable;
        window.makeAllTextEditable = makeAllTextEditable;
        window.showTextToolbar = showTextToolbar;
        window.openTypographyModal = openTypographyModal;
        
        // Initialize page functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Website builder loaded successfully');
            console.log('Functions available:', {
                addTextElement: typeof window.addTextElement,
                toggleAIAssistant: typeof window.toggleAIAssistant,
                saveDraft: typeof window.saveDraft
            });
            
            // COMPREHENSIVE BUTTON DEBUGGING
            console.log('BUTTON TEST: Testing if buttons respond to clicks...');
            setTimeout(() => {
                // Test multiple buttons
                const buttons = document.querySelectorAll('button[onclick]');
                console.log(`BUTTON TEST: Found ${buttons.length} buttons with onclick handlers`);
                
                buttons.forEach((btn, index) => {
                    const onclick = btn.getAttribute('onclick');
                    console.log(`Button ${index}: ${onclick}`);
                    
                    // Check if button is clickable
                    const rect = btn.getBoundingClientRect();
                    const computedStyle = window.getComputedStyle(btn);
                    console.log(`Button ${index} - Position: ${rect.x}, ${rect.y}, Size: ${rect.width}x${rect.height}`);
                    console.log(`Button ${index} - z-index: ${computedStyle.zIndex}, pointer-events: ${computedStyle.pointerEvents}`);
                    
                    // Add visual indicator
                    if (index === 0) {
                        btn.style.border = '3px solid red';
                        btn.style.background = 'yellow';
                    }
                });
                
                // Test if onclick functions exist
                console.log('Function existence check:');
                console.log('addTextElement:', typeof window.addTextElement);
                console.log('toggleAIAssistant:', typeof window.toggleAIAssistant);
                console.log('saveDraft:', typeof window.saveDraft);
                
                // Try calling a function directly
                try {
                    if (typeof window.addTextElement === 'function') {
                        console.log('TESTING: Calling addTextElement directly...');
                        window.addTextElement();
                        console.log('SUCCESS: addTextElement executed!');
                    }
                } catch (error) {
                    console.error('ERROR calling addTextElement:', error);
                }
            }, 1000);
            
            // Initialize drag and drop
            if (typeof initializeDraggableElements === 'function') {
                initializeDraggableElements();
            }
            
            // Check for payment success
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('payment') === 'success') {
                setTimeout(() => {
                    showNotification('AI Credits purchased successfully!', 'success');
                    window.history.replaceState({}, document.title, '/website-builder.html');
                    if (typeof loadAiCredits === 'function') {
                        loadAiCredits();
                    }
                }, 1000);
            }
        });
    </script>
</body>
</html>